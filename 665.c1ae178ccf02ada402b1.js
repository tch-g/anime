"use strict";(self.webpackChunkmy_anime=self.webpackChunkmy_anime||[]).push([[665],{6665:(My,ja,k)=>{k.r(ja),k.d(ja,{CatalogueModule:()=>Ry});var Vt=k(8583),bn=k(4402),h=k(3018),dd=k(3637),fd=k(8891),Ps=k(5917),Ne=k(6643),Us=k(9761),Za=k(7393);function qs(){return n=>n.lift(new md)}class md{call(e,t){return t.subscribe(new gd(e))}}class gd extends Za.L{constructor(e){super(e),this.hasPrev=!1}_next(e){let t;this.hasPrev?t=[this.prev,e]:this.hasPrev=!0,this.prev=e,t&&this.destination.next(t)}}var Fe=k(8002),Vs=k(2145);class yd{constructor(e,t){this.compare=e,this.keySelector=t}call(e,t){return t.subscribe(new vd(e,this.compare,this.keySelector))}}class vd extends Za.L{constructor(e,t,r){super(e),this.keySelector=r,this.hasKey=!1,"function"==typeof t&&(this.compare=t)}compare(e,t){return e===t}_next(e){let t;try{const{keySelector:s}=this;t=s?s(e):e}catch(s){return this.destination.error(s)}let r=!1;if(this.hasKey)try{const{compare:s}=this;r=s(this.key,t)}catch(s){return this.destination.error(s)}else this.hasKey=!0;r||(this.key=t,this.destination.next(e))}}var I,Er=k(5435),xr=k(8747),wd=(k(6096),k(4486)),g=k(8239),Sr=k(5452),Ka=k(6034),pt=k(5601),M=k(3854),_d="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},je={},Bs=Bs||{},A=_d||self;function br(){}function js(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function An(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var Zs="closure_uid_"+(1e9*Math.random()>>>0),Id=0;function Ed(n,e,t){return n.call.apply(n.bind,arguments)}function xd(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,r),n.apply(e,s)}}return function(){return n.apply(e,arguments)}}function se(n,e,t){return(se=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Ed:xd).apply(null,arguments)}function Ar(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function ie(n,e){function t(){}t.prototype=e.prototype,n.Z=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.Vb=function(r,s,i){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[s].apply(r,o)}}function Je(){this.s=this.s,this.o=this.o}var bd={};Je.prototype.s=!1,Je.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var n=function(n){return Object.prototype.hasOwnProperty.call(n,Zs)&&n[Zs]||(n[Zs]=++Id)}(this);delete bd[n]}},Je.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const $a=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1},Ga=Array.prototype.forEach?function(n,e,t){Array.prototype.forEach.call(n,e,t)}:function(n,e,t){const r=n.length,s="string"==typeof n?n.split(""):n;for(let i=0;i<r;i++)i in s&&e.call(t,s[i],i,n)};function za(n){return Array.prototype.concat.apply([],arguments)}function Ks(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function Nr(n){return/^[\s\xa0]*$/.test(n)}var pe,Ha=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]};function ge(n,e){return-1!=n.indexOf(e)}function $s(n,e){return n<e?-1:n>e?1:0}e:{var Qa=A.navigator;if(Qa){var Wa=Qa.userAgent;if(Wa){pe=Wa;break e}}pe=""}function Gs(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function Ya(n){const e={};for(const t in n)e[t]=n[t];return e}var Xa="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ja(n,e){let t,r;for(let s=1;s<arguments.length;s++){for(t in r=arguments[s],r)n[t]=r[t];for(let i=0;i<Xa.length;i++)t=Xa[i],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function zs(n){return zs[" "](n),n}zs[" "]=br;var Dr,n,Dd=ge(pe,"Opera"),Bt=ge(pe,"Trident")||ge(pe,"MSIE"),eu=ge(pe,"Edge"),Hs=eu||Bt,tu=ge(pe,"Gecko")&&!(ge(pe.toLowerCase(),"webkit")&&!ge(pe,"Edge"))&&!(ge(pe,"Trident")||ge(pe,"MSIE"))&&!ge(pe,"Edge"),Cd=ge(pe.toLowerCase(),"webkit")&&!ge(pe,"Edge");function nu(){var n=A.document;return n?n.documentMode:void 0}e:{var Qs="",Ws=(n=pe,tu?/rv:([^\);]+)(\)|;)/.exec(n):eu?/Edge\/([\d\.]+)/.exec(n):Bt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):Cd?/WebKit\/(\S+)/.exec(n):Dd?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(Ws&&(Qs=Ws?Ws[1]:""),Bt){var Ys=nu();if(null!=Ys&&Ys>parseFloat(Qs)){Dr=String(Ys);break e}}Dr=Qs}var kd={};function Rd(){return e=kd,Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=function(){let n=0;const e=Ha(String(Dr)).split("."),t=Ha("9").split("."),r=Math.max(e.length,t.length);for(let o=0;0==n&&o<r;o++){var s=e[o]||"",i=t[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],0==s[0].length&&0==i[0].length)break;n=$s(0==s[1].length?0:parseInt(s[1],10),0==i[1].length?0:parseInt(i[1],10))||$s(0==s[2].length,0==i[2].length)||$s(s[2],i[2]),s=s[3],i=i[3]}while(0==n)}return 0<=n}();var e}var Ld=A.document&&Bt&&(nu()||parseInt(Dr,10))||void 0,Md=function(){if(!A.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{A.addEventListener("test",br,e),A.removeEventListener("test",br,e)}catch(t){}return n}();function le(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}function Nn(n,e){if(le.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(tu){e:{try{zs(e.nodeName);var s=!0;break e}catch(i){}s=!1}s||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:Fd[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Nn.Z.h.call(this)}}le.prototype.h=function(){this.defaultPrevented=!0},ie(Nn,le);var Fd={2:"touch",3:"pen",4:"mouse"};Nn.prototype.h=function(){Nn.Z.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Dn="closure_listenable_"+(1e6*Math.random()|0),Od=0;function Pd(n,e,t,r,s){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.ia=s,this.key=++Od,this.ca=this.fa=!1}function Cr(n){n.ca=!0,n.listener=null,n.proxy=null,n.src=null,n.ia=null}function kr(n){this.src=n,this.g={},this.h=0}function Js(n,e){var t=e.type;if(t in n.g){var i,r=n.g[t],s=$a(r,e);(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(Cr(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function ei(n,e,t,r){for(var s=0;s<n.length;++s){var i=n[s];if(!i.ca&&i.listener==e&&i.capture==!!t&&i.ia==r)return s}return-1}kr.prototype.add=function(n,e,t,r,s){var i=n.toString();(n=this.g[i])||(n=this.g[i]=[],this.h++);var o=ei(n,e,r,s);return-1<o?(e=n[o],t||(e.fa=!1)):((e=new Pd(e,this.src,i,!!r,s)).fa=t,n.push(e)),e};var ti="closure_lm_"+(1e6*Math.random()|0),ni={};function su(n,e,t,r,s){if(r&&r.once)return ou(n,e,t,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)su(n,e[i],t,r,s);return null}return t=oi(t),n&&n[Dn]?n.N(e,t,An(r)?!!r.capture:!!r,s):iu(n,e,t,!1,r,s)}function iu(n,e,t,r,s,i){if(!e)throw Error("Invalid event type");var o=An(s)?!!s.capture:!!s,a=si(n);if(a||(n[ti]=a=new kr(n)),(t=a.add(e,t,r,o,i)).proxy)return t;if(r=function(){var e=qd;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)Md||(s=o),void 0===s&&(s=!1),n.addEventListener(e.toString(),r,s);else if(n.attachEvent)n.attachEvent(uu(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function ou(n,e,t,r,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)ou(n,e[i],t,r,s);return null}return t=oi(t),n&&n[Dn]?n.O(e,t,An(r)?!!r.capture:!!r,s):iu(n,e,t,!0,r,s)}function au(n,e,t,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)au(n,e[i],t,r,s);else r=An(r)?!!r.capture:!!r,t=oi(t),n&&n[Dn]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=ei(i=n.g[e],t,r,s))&&(Cr(i[t]),Array.prototype.splice.call(i,t,1),0==i.length&&(delete n.g[e],n.h--))):n&&(n=si(n))&&(e=n.g[e.toString()],n=-1,e&&(n=ei(e,t,r,s)),(t=-1<n?e[n]:null)&&ri(t))}function ri(n){if("number"!=typeof n&&n&&!n.ca){var e=n.src;if(e&&e[Dn])Js(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(uu(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=si(e))?(Js(t,n),0==t.h&&(t.src=null,e[ti]=null)):Cr(n)}}}function uu(n){return n in ni?ni[n]:ni[n]="on"+n}function qd(n,e){if(n.ca)n=!0;else{e=new Nn(e,this);var t=n.listener,r=n.ia||n.src;n.fa&&ri(n),n=t.call(r,e)}return n}function si(n){return(n=n[ti])instanceof kr?n:null}var ii="__closure_events_fn_"+(1e9*Math.random()>>>0);function oi(n){return"function"==typeof n?n:(n[ii]||(n[ii]=function(e){return n.handleEvent(e)}),n[ii])}function X(){Je.call(this),this.i=new kr(this),this.P=this,this.I=null}function oe(n,e){var t,r=n.I;if(r)for(t=[];r;r=r.I)t.push(r);if(n=n.P,r=e.type||e,"string"==typeof e)e=new le(e,n);else if(e instanceof le)e.target=e.target||n;else{var s=e;Ja(e=new le(r,n),s)}if(s=!0,t)for(var i=t.length-1;0<=i;i--){var o=e.g=t[i];s=Rr(o,r,!0,e)&&s}if(s=Rr(o=e.g=n,r,!0,e)&&s,s=Rr(o,r,!1,e)&&s,t)for(i=0;i<t.length;i++)s=Rr(o=e.g=t[i],r,!1,e)&&s}function Rr(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.ca&&o.capture==t){var a=o.listener,u=o.ia||o.src;o.fa&&Js(n.i,o),s=!1!==a.call(u,r)&&s}}return s&&!r.defaultPrevented}ie(X,Je),X.prototype[Dn]=!0,X.prototype.removeEventListener=function(n,e,t,r){au(this,n,e,t,r)},X.prototype.M=function(){if(X.Z.M.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)Cr(t[r]);delete n.g[e],n.h--}}this.I=null},X.prototype.N=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},X.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var ai=A.JSON.stringify;function Vd(){var n=hu;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var ci,cu=new class{constructor(n,e){this.i=n,this.j=e,this.h=0,this.g=null}get(){let n;return 0<this.h?(this.h--,n=this.g,this.g=n.next,n.next=null):n=this.i(),n}}(()=>new jd,n=>n.reset());class jd{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Zd(n){A.setTimeout(()=>{throw n},0)}function ui(n,e){ci||function(){var n=A.Promise.resolve(void 0);ci=function(){n.then($d)}}(),hi||(ci(),hi=!0),hu.add(n,e)}var hi=!1,hu=new class{constructor(){this.h=this.g=null}add(e,t){const r=cu.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}};function $d(){for(var n;n=Vd();){try{n.h.call(n.g)}catch(t){Zd(t)}var e=cu;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}hi=!1}function Lr(n,e){X.call(this),this.h=n||1,this.g=e||A,this.j=se(this.kb,this),this.l=Date.now()}function li(n){n.da=!1,n.S&&(n.g.clearTimeout(n.S),n.S=null)}function di(n,e,t){if("function"==typeof n)t&&(n=se(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=se(n.handleEvent,n)}return 2147483647<Number(e)?-1:A.setTimeout(n,e||0)}function lu(n){n.g=di(()=>{n.g=null,n.i&&(n.i=!1,lu(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}ie(Lr,X),(I=Lr.prototype).da=!1,I.S=null,I.kb=function(){if(this.da){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-n):(this.S&&(this.g.clearTimeout(this.S),this.S=null),oe(this,"tick"),this.da&&(li(this),this.start()))}},I.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},I.M=function(){Lr.Z.M.call(this),li(this),delete this.g};class Gd extends Je{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:lu(this)}M(){super.M(),this.g&&(A.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Cn(n){Je.call(this),this.h=n,this.g={}}ie(Cn,Je);var du=[];function fu(n,e,t,r){Array.isArray(t)||(t&&(du[0]=t.toString()),t=du);for(var s=0;s<t.length;s++){var i=su(e,t[s],r||n.handleEvent,!1,n.h||n);if(!i)break;n.g[i.key]=i}}function mu(n){Gs(n.g,function(e,t){this.g.hasOwnProperty(t)&&ri(e)},n),n.g={}}function Mr(){this.g=!0}function jt(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return ai(t)}catch(a){return e}}(n,t)+(r?" "+r:"")})}Cn.prototype.M=function(){Cn.Z.M.call(this),mu(this)},Cn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Mr.prototype.Aa=function(){this.g=!1},Mr.prototype.info=function(){};var yt={},gu=null;function Fr(){return gu=gu||new X}function pu(n){le.call(this,yt.Ma,n)}function kn(n){const e=Fr();oe(e,new pu(e,n))}function yu(n,e){le.call(this,yt.STAT_EVENT,n),this.stat=e}function ye(n){const e=Fr();oe(e,new yu(e,n))}function vu(n,e){le.call(this,yt.Na,n),this.size=e}function Rn(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return A.setTimeout(function(){n()},e)}yt.Ma="serverreachability",ie(pu,le),yt.STAT_EVENT="statevent",ie(yu,le),yt.Na="timingevent",ie(vu,le);var Or={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},wu={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function fi(){}function Tu(){}fi.prototype.h=null;var pi,Ln={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function mi(){le.call(this,"d")}function gi(){le.call(this,"c")}function Pr(){}function Mn(n,e,t,r){this.l=n,this.j=e,this.m=t,this.X=r||1,this.V=new Cn(this),this.P=Yd,this.W=new Lr(n=Hs?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Iu}function Iu(){this.i=null,this.g="",this.h=!1}ie(mi,le),ie(gi,le),ie(Pr,fi),Pr.prototype.g=function(){return new XMLHttpRequest},Pr.prototype.i=function(){return{}},pi=new Pr;var Yd=45e3,yi={},Ur={};function vi(n,e,t){n.K=1,n.v=Zr(Ze(e)),n.s=t,n.U=!0,Eu(n,null)}function Eu(n,e){n.F=Date.now(),Fn(n),n.A=Ze(n.v);var t=n.A,r=n.X;Array.isArray(r)||(r=[String(r)]),Ru(t.h,"t",r),n.C=0,t=n.l.H,n.h=new Iu,n.g=tc(n.l,t?e:null,!n.s),0<n.O&&(n.L=new Gd(se(n.Ia,n,n.g),n.O)),fu(n.V,n.g,"readystatechange",n.gb),e=n.H?Ya(n.H):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ea(n.A,n.u,n.s,e)):(n.u="GET",n.g.ea(n.A,n.u,null,e)),kn(1),function(n,e,t,r,s,i){n.info(function(){if(n.g)if(i)for(var o="",a=i.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var d=l.split("_");o=2<=d.length&&"type"==d[1]?o+(l+"=")+c+"&":o+(l+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+t+"\n"+o})}(n.j,n.u,n.A,n.m,n.X,n.s)}function xu(n){return!!n.g&&"GET"==n.u&&2!=n.K&&n.l.Ba}function Su(n,e,t){let s,r=!0;for(;!n.I&&n.C<t.length;){if(s=Xd(n,t),s==Ur){4==e&&(n.o=4,ye(14),r=!1),jt(n.j,n.m,null,"[Incomplete Response]");break}if(s==yi){n.o=4,ye(15),jt(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}jt(n.j,n.m,s,null),wi(n,s)}xu(n)&&s!=Ur&&s!=yi&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,ye(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.aa&&(n.aa=!0,(e=n.l).g==n&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+t.length),Ci(e),e.L=!0,ye(11))):(jt(n.j,n.m,t,"[Invalid Chunked Response]"),vt(n),On(n))}function Xd(n,e){var t=n.C,r=e.indexOf("\n",t);return-1==r?Ur:(t=Number(e.substring(t,r)),isNaN(t)?yi:(r+=1)+t>e.length?Ur:(e=e.substr(r,t),n.C=r+t,e))}function Fn(n){n.Y=Date.now()+n.P,bu(n,n.P)}function bu(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=Rn(se(n.eb,n),e)}function qr(n){n.B&&(A.clearTimeout(n.B),n.B=null)}function On(n){0==n.l.G||n.I||Yu(n.l,n)}function vt(n){qr(n);var e=n.L;e&&"function"==typeof e.na&&e.na(),n.L=null,li(n.W),mu(n.V),n.g&&(e=n.g,n.g=null,e.abort(),e.na())}function wi(n,e){try{var t=n.l;if(0!=t.G&&(t.g==n||Ii(t.i,n)))if(t.I=n.N,!n.J&&Ii(t.i,n)&&3==t.G){try{var r=t.Ca.g.parse(e)}catch(c){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0])e:if(t.u)t.ta=s[1],0<t.ta-t.U&&37500>s[2]&&t.N&&0==t.A&&!t.v&&(t.v=Rn(se(t.ab,t),6e3));else{if(t.g){if(!(t.g.F+3e3<n.F))break e;Qr(t),zr(t)}Di(t),ye(18)}if(1>=Fu(t.i)&&t.ka){try{t.ka()}catch(c){}t.ka=void 0}}else Tt(t,11)}else if((n.J||t.g==n)&&Qr(t),!Nr(e))for(s=t.Ca.g.parse(e),e=0;e<s.length;e++){let c=s[e];if(t.U=c[0],c=c[1],2==t.G)if("c"==c[0]){t.J=c[1],t.la=c[2];const l=c[3];null!=l&&(t.ma=l,t.h.info("VER="+t.ma));const d=c[4];null!=d&&(t.za=d,t.h.info("SVER="+t.za));const m=c[5];null!=m&&"number"==typeof m&&0<m&&(t.K=r=1.5*m,t.h.info("backChannelRequestTimeoutMs_="+r)),r=t;const p=n.g;if(p){const _=p.g?p.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(_){var i=r.i;!i.g&&(ge(_,"spdy")||ge(_,"quic")||ge(_,"h2"))&&(i.j=i.l,i.g=new Set,i.h&&(Ei(i,i.h),i.h=null))}if(r.D){const S=p.g?p.g.getResponseHeader("X-HTTP-Session-Id"):null;S&&(r.sa=S,q(r.F,r.D,S))}}t.G=3,t.j&&t.j.xa(),t.$&&(t.O=Date.now()-n.F,t.h.info("Handshake RTT: "+t.O+"ms"));var o=n;if((r=t).oa=ec(r,r.H?r.la:null,r.W),o.J){Ou(r.i,o);var a=o,u=r.K;u&&a.setTimeout(u),a.B&&(qr(a),Fn(a)),r.g=o}else Qu(r);0<t.l.length&&Hr(t)}else"stop"!=c[0]&&"close"!=c[0]||Tt(t,7);else 3==t.G&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?Tt(t,7):Ai(t):"noop"!=c[0]&&t.j&&t.j.wa(c),t.A=0)}kn(4)}catch(c){}}function _i(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(js(n)||"string"==typeof n)Ga(n,e,void 0);else{if(n.T&&"function"==typeof n.T)var t=n.T();else if(n.R&&"function"==typeof n.R)t=void 0;else if(js(n)||"string"==typeof n){t=[];for(var r=n.length,s=0;s<r;s++)t.push(s)}else for(s in t=[],r=0,n)t[r++]=s;s=(r=function(n){if(n.R&&"function"==typeof n.R)return n.R();if("string"==typeof n)return n.split("");if(js(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n)).length;for(var i=0;i<s;i++)e.call(void 0,r[i],t&&t[i],n)}}function Zt(n,e){this.h={},this.g=[],this.i=0;var t=arguments.length;if(1<t){if(t%2)throw Error("Uneven number of arguments");for(var r=0;r<t;r+=2)this.set(arguments[r],arguments[r+1])}else if(n)if(n instanceof Zt)for(t=n.T(),r=0;r<t.length;r++)this.set(t[r],n.get(t[r]));else for(r in n)this.set(r,n[r])}function Ti(n){if(n.i!=n.g.length){for(var e=0,t=0;e<n.g.length;){var r=n.g[e];wt(n.h,r)&&(n.g[t++]=r),e++}n.g.length=t}if(n.i!=n.g.length){var s={};for(t=e=0;e<n.g.length;)wt(s,r=n.g[e])||(n.g[t++]=r,s[r]=1),e++;n.g.length=t}}function wt(n,e){return Object.prototype.hasOwnProperty.call(n,e)}(I=Mn.prototype).setTimeout=function(n){this.P=n},I.gb=function(n){n=n.target;const e=this.L;e&&3==Ke(n)?e.l():this.Ia(n)},I.Ia=function(n){try{if(n==this.g)e:{const l=Ke(this.g);var e=this.g.Da();const d=this.g.ba();if(!(3>l)&&(3!=l||Hs||this.g&&(this.h.h||this.g.ga()||Ku(this.g)))){this.I||4!=l||7==e||kn(8==e||0>=d?3:2),qr(this);var t=this.g.ba();this.N=t;t:if(xu(this)){var r=Ku(this.g);n="";var s=r.length,i=4==Ke(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){vt(this),On(this);var o="";break t}this.h.i=new A.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:i&&e==s-1});r.splice(0,s),this.h.g+=n,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==t,function(n,e,t,r,s,i,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+t+"\n"+i+" "+o})}(this.j,this.u,this.A,this.m,this.X,l,t),this.i){if(this.$&&!this.J){t:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Nr(a)){var c=a;break t}}c=null}if(!(t=c)){this.i=!1,this.o=3,ye(12),vt(this),On(this);break e}jt(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,wi(this,t)}this.U?(Su(this,l,o),Hs&&this.i&&3==l&&(fu(this.V,this.W,"tick",this.fb),this.W.start())):(jt(this.j,this.m,o,null),wi(this,o)),4==l&&vt(this),this.i&&!this.I&&(4==l?Yu(this.l,this):(this.i=!1,Fn(this)))}else 400==t&&0<o.indexOf("Unknown SID")?(this.o=3,ye(12)):(this.o=0,ye(13)),vt(this),On(this)}}}catch(l){}},I.fb=function(){if(this.g){var n=Ke(this.g),e=this.g.ga();this.C<e.length&&(qr(this),Su(this,n,e),this.i&&4!=n&&Fn(this))}},I.cancel=function(){this.I=!0,vt(this)},I.eb=function(){this.B=null;const n=Date.now();0<=n-this.Y?(function(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(kn(3),ye(17)),vt(this),this.o=2,On(this)):bu(this,this.Y-n)},(I=Zt.prototype).R=function(){Ti(this);for(var n=[],e=0;e<this.g.length;e++)n.push(this.h[this.g[e]]);return n},I.T=function(){return Ti(this),this.g.concat()},I.get=function(n,e){return wt(this.h,n)?this.h[n]:e},I.set=function(n,e){wt(this.h,n)||(this.i++,this.g.push(n)),this.h[n]=e},I.forEach=function(n,e){for(var t=this.T(),r=0;r<t.length;r++){var s=t[r],i=this.get(s);n.call(e,i,s,this)}};var Au=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function _t(n,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,n instanceof _t){this.g=void 0!==e?e:n.g,Vr(this,n.j),this.s=n.s,Br(this,n.i),jr(this,n.m),this.l=n.l,e=n.h;var t=new qn;t.i=e.i,e.g&&(t.g=new Zt(e.g),t.h=e.h),Nu(this,t),this.o=n.o}else n&&(t=String(n).match(Au))?(this.g=!!e,Vr(this,t[1]||"",!0),this.s=Pn(t[2]||""),Br(this,t[3]||"",!0),jr(this,t[4]),this.l=Pn(t[5]||"",!0),Nu(this,t[6]||"",!0),this.o=Pn(t[7]||"")):(this.g=!!e,this.h=new qn(null,this.g))}function Ze(n){return new _t(n)}function Vr(n,e,t){n.j=t?Pn(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Br(n,e,t){n.i=t?Pn(e,!0):e}function jr(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function Nu(n,e,t){e instanceof qn?(n.h=e,function(n,e){e&&!n.j&&(et(n),n.i=null,n.g.forEach(function(t,r){var s=r.toLowerCase();r!=s&&(Cu(this,r),Ru(this,s,t))},n)),n.j=e}(n.h,n.g)):(t||(e=Un(e,af)),n.h=new qn(e,n.g))}function q(n,e,t){n.h.set(e,t)}function Zr(n){return q(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Pn(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Un(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,rf),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function rf(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}_t.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Un(e,Du,!0),":");var t=this.i;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(Un(e,Du,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.i&&"/"!=t.charAt(0)&&n.push("/"),n.push(Un(t,"/"==t.charAt(0)?of:sf,!0))),(t=this.h.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Un(t,uf)),n.join("")};var Du=/[#\/\?@]/g,sf=/[#\?:]/g,of=/[#\?]/g,af=/[#\?@]/g,uf=/#/g;function qn(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function et(n){n.g||(n.g=new Zt,n.h=0,n.i&&function(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),s=null;if(0<=r){var i=n[t].substring(0,r);s=n[t].substring(r+1)}else i=n[t];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function Cu(n,e){et(n),e=Kt(n,e),wt(n.g.h,e)&&(n.i=null,n.h-=n.g.get(e).length,wt((n=n.g).h,e)&&(delete n.h[e],n.i--,n.g.length>2*n.i&&Ti(n)))}function ku(n,e){return et(n),e=Kt(n,e),wt(n.g.h,e)}function Ru(n,e,t){Cu(n,e),0<t.length&&(n.i=null,n.g.set(Kt(n,e),Ks(t)),n.h+=t.length)}function Kt(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function Lu(n){this.l=n||lf,n=A.PerformanceNavigationTiming?0<(n=A.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(A.g&&A.g.Ea&&A.g.Ea()&&A.g.Ea().Zb),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(I=qn.prototype).add=function(n,e){et(this),this.i=null,n=Kt(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},I.forEach=function(n,e){et(this),this.g.forEach(function(t,r){Ga(t,function(s){n.call(e,s,r,this)},this)},this)},I.T=function(){et(this);for(var n=this.g.R(),e=this.g.T(),t=[],r=0;r<e.length;r++)for(var s=n[r],i=0;i<s.length;i++)t.push(e[r]);return t},I.R=function(n){et(this);var e=[];if("string"==typeof n)ku(this,n)&&(e=za(e,this.g.get(Kt(this,n))));else{n=this.g.R();for(var t=0;t<n.length;t++)e=za(e,n[t])}return e},I.set=function(n,e){return et(this),this.i=null,ku(this,n=Kt(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},I.get=function(n,e){return n&&0<(n=this.R(n)).length?String(n[0]):e},I.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var n=[],e=this.g.T(),t=0;t<e.length;t++){var r=e[t],s=encodeURIComponent(String(r));r=this.R(r);for(var i=0;i<r.length;i++){var o=s;""!==r[i]&&(o+="="+encodeURIComponent(String(r[i]))),n.push(o)}}return this.i=n.join("&")};var lf=10;function Mu(n){return!!n.h||!!n.g&&n.g.size>=n.j}function Fu(n){return n.h?1:n.g?n.g.size:0}function Ii(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function Ei(n,e){n.g?n.g.add(e):n.h=e}function Ou(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function Pu(n){if(null!=n.h)return n.i.concat(n.h.D);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.D);return e}return Ks(n.i)}function xi(){}function df(){this.g=new xi}function ff(n,e,t){const r=t||"";try{_i(n,function(s,i){let o=s;An(s)&&(o=ai(s)),e.push(r+i+"="+encodeURIComponent(o))})}catch(s){throw e.push(r+"type="+encodeURIComponent("_badmap")),s}}function Kr(n,e,t,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch(i){}}function Vn(n){this.l=n.$b||null,this.j=n.ib||!1}function $r(n,e){X.call(this),this.D=n,this.u=e,this.m=void 0,this.readyState=Si,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Lu.prototype.cancel=function(){if(this.i=Pu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}},xi.prototype.stringify=function(n){return A.JSON.stringify(n,void 0)},xi.prototype.parse=function(n){return A.JSON.parse(n,void 0)},ie(Vn,fi),Vn.prototype.g=function(){return new $r(this.l,this.j)},Vn.prototype.i=function(n){return function(){return n}}({}),ie($r,X);var Si=0;function Uu(n){n.j.read().then(n.Sa.bind(n)).catch(n.ha.bind(n))}function Bn(n){n.readyState=4,n.l=null,n.j=null,n.A=null,jn(n)}function jn(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(I=$r.prototype).open=function(n,e){if(this.readyState!=Si)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,jn(this)},I.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.D||A).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},I.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Bn(this)),this.readyState=Si},I.Va=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,jn(this)),this.g&&(this.readyState=3,jn(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==A.ReadableStream&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Uu(this)}else n.text().then(this.Ua.bind(this),this.ha.bind(this))},I.Sa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?Bn(this):jn(this),3==this.readyState&&Uu(this)}},I.Ua=function(n){this.g&&(this.response=this.responseText=n,Bn(this))},I.Ta=function(n){this.g&&(this.response=n,Bn(this))},I.ha=function(){this.g&&Bn(this)},I.setRequestHeader=function(n,e){this.v.append(n,e)},I.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},I.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty($r.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var gf=A.JSON.parse;function $(n){X.call(this),this.headers=new Zt,this.u=n||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=qu,this.K=this.L=!1}ie($,X);var qu="",pf=/^https?$/i,yf=["POST","PUT"];function wf(n){return"content-type"==n.toLowerCase()}function Vu(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Bu(n),Gr(n)}function Bu(n){n.D||(n.D=!0,oe(n,"complete"),oe(n,"error"))}function ju(n){if(n.h&&void 0!==Bs&&(!n.C[1]||4!=Ke(n)||2!=n.ba()))if(n.v&&4==Ke(n))di(n.Fa,0,n);else if(oe(n,"readystatechange"),4==Ke(n)){n.h=!1;try{const a=n.ba();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===a){var s=String(n.H).match(Au)[1]||null;if(!s&&A.self&&A.self.location){var i=A.self.location.protocol;s=i.substr(0,i.length-1)}r=!pf.test(s?s.toLowerCase():"")}t=r}if(t)oe(n,"complete"),oe(n,"success");else{n.m=6;try{var o=2<Ke(n)?n.g.statusText:""}catch(u){o=""}n.j=o+" ["+n.ba()+"]",Bu(n)}}finally{Gr(n)}}}function Gr(n,e){if(n.g){Zu(n);const t=n.g,r=n.C[0]?br:null;n.g=null,n.C=null,e||oe(n,"ready");try{t.onreadystatechange=r}catch(s){}}}function Zu(n){n.g&&n.K&&(n.g.ontimeout=null),n.A&&(A.clearTimeout(n.A),n.A=null)}function Ke(n){return n.g?n.g.readyState:0}function Ku(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.J){case qu:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch(e){return null}}function bi(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=function(n){let e="";return Gs(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):q(n,e,t))}function Zn(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function $u(n){this.za=0,this.l=[],this.h=new Mr,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Zn("failFast",!1,n),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Zn("baseRetryDelayMs",5e3,n),this.$a=Zn("retryDelaySeedMs",1e4,n),this.Ya=Zn("forwardChannelMaxRetries",2,n),this.ra=Zn("forwardChannelRequestTimeoutMs",2e4,n),this.qa=n&&n.xmlHttpFactory||void 0,this.Ba=n&&n.Yb||!1,this.K=void 0,this.H=n&&n.supportsCrossDomainXhr||!1,this.J="",this.i=new Lu(n&&n.concurrentRequestLimit),this.Ca=new df,this.ja=n&&n.fastHandshake||!1,this.Ra=n&&n.Wb||!1,n&&n.Aa&&this.h.Aa(),n&&n.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&n&&n.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!n||!1!==n.Xb}function Ai(n){if(Gu(n),3==n.G){var e=n.V++,t=Ze(n.F);q(t,"SID",n.J),q(t,"RID",e),q(t,"TYPE","terminate"),Kn(n,t),(e=new Mn(n,n.h,e,void 0)).K=2,e.v=Zr(Ze(t)),t=!1,A.navigator&&A.navigator.sendBeacon&&(t=A.navigator.sendBeacon(e.v.toString(),"")),!t&&A.Image&&((new Image).src=e.v,t=!0),t||(e.g=tc(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Fn(e)}Ju(n)}function zr(n){n.g&&(Ci(n),n.g.cancel(),n.g=null)}function Gu(n){zr(n),n.u&&(A.clearTimeout(n.u),n.u=null),Qr(n),n.i.cancel(),n.m&&("number"==typeof n.m&&A.clearTimeout(n.m),n.m=null)}function Ni(n,e){n.l.push(new class{constructor(n,e){this.h=n,this.g=e}}(n.Za++,e)),3==n.G&&Hr(n)}function Hr(n){Mu(n.i)||n.m||(n.m=!0,ui(n.Ha,n),n.C=0)}function zu(n,e){var t;t=e?e.m:n.V++;const r=Ze(n.F);q(r,"SID",n.J),q(r,"RID",t),q(r,"AID",n.U),Kn(n,r),n.o&&n.s&&bi(r,n.o,n.s),t=new Mn(n,n.h,t,n.C+1),null===n.o&&(t.H=n.s),e&&(n.l=e.D.concat(n.l)),e=Hu(n,t,1e3),t.setTimeout(Math.round(.5*n.ra)+Math.round(.5*n.ra*Math.random())),Ei(n.i,t),vi(t,r,e)}function Kn(n,e){n.j&&_i({},function(t,r){q(e,r,t)})}function Hu(n,e,t){t=Math.min(n.l.length,t);var r=n.j?se(n.j.Oa,n.j,n):null;e:{var s=n.l;let i=-1;for(;;){const o=["count="+t];-1==i?0<t?(i=s[0].h,o.push("ofs="+i)):i=0:o.push("ofs="+i);let a=!0;for(let u=0;u<t;u++){let c=s[u].h;const l=s[u].g;if(c-=i,0>c)i=Math.max(0,s[u].h-100),a=!1;else try{ff(l,o,"req"+c+"_")}catch(d){r&&r(l)}}if(a){r=o.join("&");break e}}}return n=n.l.splice(0,t),e.D=n,r}function Qu(n){n.g||n.u||(n.Y=1,ui(n.Ga,n),n.A=0)}function Di(n){return!(n.g||n.u||3<=n.A||(n.Y++,n.u=Rn(se(n.Ga,n),Xu(n,n.A)),n.A++,0))}function Ci(n){null!=n.B&&(A.clearTimeout(n.B),n.B=null)}function Wu(n){n.g=new Mn(n,n.h,"rpc",n.Y),null===n.o&&(n.g.H=n.s),n.g.O=0;var e=Ze(n.oa);q(e,"RID","rpc"),q(e,"SID",n.J),q(e,"CI",n.N?"0":"1"),q(e,"AID",n.U),Kn(n,e),q(e,"TYPE","xmlhttp"),n.o&&n.s&&bi(e,n.o,n.s),n.K&&n.g.setTimeout(n.K);var t=n.g;n=n.la,t.K=1,t.v=Zr(Ze(e)),t.s=null,t.U=!0,Eu(t,n)}function Qr(n){null!=n.v&&(A.clearTimeout(n.v),n.v=null)}function Yu(n,e){var t=null;if(n.g==e){Qr(n),Ci(n),n.g=null;var r=2}else{if(!Ii(n.i,e))return;t=e.D,Ou(n.i,e),r=1}if(n.I=e.N,0!=n.G)if(e.i)if(1==r){t=e.s?e.s.length:0,e=Date.now()-e.F;var s=n.C;oe(r=Fr(),new vu(r,t,e,s)),Hr(n)}else Qu(n);else if(3==(s=e.o)||0==s&&0<n.I||!(1==r&&function(n,e){return!(Fu(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.l=e.D.concat(n.l),0):1==n.G||2==n.G||n.C>=(n.Xa?0:n.Ya)||(n.m=Rn(se(n.Ha,n,e),Xu(n,n.C)),n.C++,0)))}(n,e)||2==r&&Di(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),s){case 1:Tt(n,5);break;case 4:Tt(n,10);break;case 3:Tt(n,6);break;default:Tt(n,2)}}function Xu(n,e){let t=n.Pa+Math.floor(Math.random()*n.$a);return n.j||(t*=2),t*e}function Tt(n,e){if(n.h.info("Error code "+e),2==e){var t=null;n.j&&(t=null);var r=se(n.jb,n);t||(t=new _t("//www.google.com/images/cleardot.gif"),A.location&&"http"==A.location.protocol||Vr(t,"https"),Zr(t)),function(n,e){const t=new Mr;if(A.Image){const r=new Image;r.onload=Ar(Kr,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Ar(Kr,t,r,"TestLoadImage: error",!1,e),r.onabort=Ar(Kr,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Ar(Kr,t,r,"TestLoadImage: timeout",!1,e),A.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else ye(2);n.G=0,n.j&&n.j.va(e),Ju(n),Gu(n)}function Ju(n){n.G=0,n.I=-1,n.j&&((0!=Pu(n.i).length||0!=n.l.length)&&(n.i.i.length=0,Ks(n.l),n.l.length=0),n.j.ua())}function ec(n,e,t){let r=function(n){return n instanceof _t?Ze(n):new _t(n,void 0)}(t);if(""!=r.i)e&&Br(r,e+"."+r.i),jr(r,r.m);else{const s=A.location;r=function(n,e,t,r){var s=new _t(null,void 0);return n&&Vr(s,n),e&&Br(s,e),t&&jr(s,t),r&&(s.l=r),s}(s.protocol,e?e+"."+s.hostname:s.hostname,+s.port,t)}return n.aa&&Gs(n.aa,function(s,i){q(r,i,s)}),t=n.sa,(e=n.D)&&t&&q(r,e,t),q(r,"VER",n.ma),Kn(n,r),r}function tc(n,e,t){if(e&&!n.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new $(t&&n.Ba&&!n.qa?new Vn({ib:!0}):n.qa)).L=n.H,e}function nc(){}function Wr(){if(Bt&&!(10<=Number(Ld)))throw Error("Environmental error: no available transport.")}function xe(n,e){X.call(this),this.g=new $u(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(n?n["X-WebChannel-Client-Profile"]=e.ya:n={"X-WebChannel-Client-Profile":e.ya}),this.g.P=n,(n=e&&e.httpHeadersOverwriteParam)&&!Nr(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Nr(e)&&(this.g.D=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new $t(this)}function rc(n){mi.call(this);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function sc(){gi.call(this),this.status=1}function $t(n){this.g=n}(I=$.prototype).ea=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+n);e=e?e.toUpperCase():"GET",this.H=n,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():pi.g(),this.C=function(n){return n.h||(n.h=n.i())}(this.u?this.u:pi),this.g.onreadystatechange=se(this.Fa,this);try{this.F=!0,this.g.open(e,String(n),!0),this.F=!1}catch(i){return void Vu(this,i)}n=t||"";const s=new Zt(this.headers);r&&_i(r,function(i,o){s.set(o,i)}),r=function(n){e:{var e=wf;const t=n.length,r="string"==typeof n?n.split(""):n;for(let s=0;s<t;s++)if(s in r&&e.call(void 0,r[s],s,n)){e=s;break e}e=-1}return 0>e?null:"string"==typeof n?n.charAt(e):n[e]}(s.T()),t=A.FormData&&n instanceof A.FormData,!(0<=$a(yf,e))||r||t||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach(function(i,o){this.g.setRequestHeader(o,i)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Zu(this),0<this.B&&((this.K=function(n){return Bt&&Rd()&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=se(this.pa,this)):this.A=di(this.pa,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(i){Vu(this,i)}},I.pa=function(){void 0!==Bs&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,oe(this,"timeout"),this.abort(8))},I.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,oe(this,"complete"),oe(this,"abort"),Gr(this))},I.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Gr(this,!0)),$.Z.M.call(this)},I.Fa=function(){this.s||(this.F||this.v||this.l?ju(this):this.cb())},I.cb=function(){ju(this)},I.ba=function(){try{return 2<Ke(this)?this.g.status:-1}catch(n){return-1}},I.ga=function(){try{return this.g?this.g.responseText:""}catch(n){return""}},I.Qa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),gf(e)}},I.Da=function(){return this.m},I.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(I=$u.prototype).ma=8,I.G=1,I.hb=function(n){try{this.h.info("Origin Trials invoked: "+n)}catch(e){}},I.Ha=function(n){if(this.m)if(this.m=null,1==this.G){if(!n){this.V=Math.floor(1e5*Math.random()),n=this.V++;const s=new Mn(this,this.h,n,void 0);let i=this.s;if(this.P&&(i?(i=Ya(i),Ja(i,this.P)):i=this.P),null===this.o&&(s.H=i),this.ja)e:{for(var e=0,t=0;t<this.l.length;t++){var r=this.l[t];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.l.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=Hu(this,s,e),q(t=Ze(this.F),"RID",n),q(t,"CVER",22),this.D&&q(t,"X-HTTP-Session-Id",this.D),Kn(this,t),this.o&&i&&bi(t,this.o,i),Ei(this.i,s),this.Ra&&q(t,"TYPE","init"),this.ja?(q(t,"$req",e),q(t,"SID","null"),s.$=!0,vi(s,t,null)):vi(s,t,e),this.G=2}}else 3==this.G&&(n?zu(this,n):0==this.l.length||Mu(this.i)||zu(this))},I.Ga=function(){if(this.u=null,Wu(this),this.$&&!(this.L||null==this.g||0>=this.O)){var n=2*this.O;this.h.info("BP detection timer enabled: "+n),this.B=Rn(se(this.bb,this),n)}},I.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,ye(10),zr(this),Wu(this))},I.ab=function(){null!=this.v&&(this.v=null,zr(this),Di(this),ye(19))},I.jb=function(n){n?(this.h.info("Successfully pinged google.com"),ye(2)):(this.h.info("Failed to ping google.com"),ye(1))},(I=nc.prototype).xa=function(){},I.wa=function(){},I.va=function(){},I.ua=function(){},I.Oa=function(){},Wr.prototype.g=function(n,e){return new xe(n,e)},ie(xe,X),xe.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var n=this.g,e=this.l,t=this.h||void 0;n.Wa&&(n.h.info("Origin Trials enabled."),ui(se(n.hb,n,e))),ye(0),n.W=e,n.aa=t||{},n.N=n.X,n.F=ec(n,null,n.W),Hr(n)},xe.prototype.close=function(){Ai(this.g)},xe.prototype.u=function(n){if("string"==typeof n){var e={};e.__data__=n,Ni(this.g,e)}else this.v?((e={}).__data__=ai(n),Ni(this.g,e)):Ni(this.g,n)},xe.prototype.M=function(){this.g.j=null,delete this.j,Ai(this.g),delete this.g,xe.Z.M.call(this)},ie(rc,mi),ie(sc,gi),ie($t,nc),$t.prototype.xa=function(){oe(this.g,"a")},$t.prototype.wa=function(n){oe(this.g,new rc(n))},$t.prototype.va=function(n){oe(this.g,new sc(n))},$t.prototype.ua=function(){oe(this.g,"b")},Wr.prototype.createWebChannel=Wr.prototype.g,xe.prototype.send=xe.prototype.u,xe.prototype.open=xe.prototype.m,xe.prototype.close=xe.prototype.close,Or.NO_ERROR=0,Or.TIMEOUT=8,Or.HTTP_ERROR=6,wu.COMPLETE="complete",Tu.EventType=Ln,Ln.OPEN="a",Ln.CLOSE="b",Ln.ERROR="c",Ln.MESSAGE="d",X.prototype.listen=X.prototype.N,$.prototype.listenOnce=$.prototype.O,$.prototype.getLastError=$.prototype.La,$.prototype.getLastErrorCode=$.prototype.Da,$.prototype.getStatus=$.prototype.ba,$.prototype.getResponseJson=$.prototype.Qa,$.prototype.getResponseText=$.prototype.ga,$.prototype.send=$.prototype.ea;var If=je.createWebChannelTransport=function(){return new Wr},Ef=je.getStatEventTarget=function(){return Fr()},ki=je.ErrorCode=Or,xf=je.EventType=wu,Sf=je.Event=yt,ic=je.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},bf=je.FetchXmlHttpFactory=Vn,Yr=je.WebChannel=Tu,Af=je.XhrIo=$;const oc="@firebase/firestore";class ae{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ae.UNAUTHENTICATED=new ae(null),ae.GOOGLE_CREDENTIALS=new ae("google-credentials-uid"),ae.FIRST_PARTY=new ae("first-party-uid"),ae.MOCK_USER=new ae("mock-user");let Gt="9.2.0";const tt=new pt.Yd("@firebase/firestore");function Ri(){return tt.logLevel}function w(n,...e){if(tt.logLevel<=pt.in.DEBUG){const t=e.map(Li);tt.debug(`Firestore (${Gt}): ${n}`,...t)}}function G(n,...e){if(tt.logLevel<=pt.in.ERROR){const t=e.map(Li);tt.error(`Firestore (${Gt}): ${n}`,...t)}}function $n(n,...e){if(tt.logLevel<=pt.in.WARN){const t=e.map(Li);tt.warn(`Firestore (${Gt}): ${n}`,...t)}}function Li(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch(t){return n}}function x(n="Unexpected state"){const e=`FIRESTORE (${Gt}) INTERNAL ASSERTION FAILED: `+n;throw G(e),new Error(e)}function b(n,e){n||x()}function T(n,e){return n}const f={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class v extends Error{constructor(e,t){super(t),this.code=e,this.message=t,this.name="FirebaseError",this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class J{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class ac{constructor(e,t){this.user=t,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization=`Bearer ${e}`}}class Cf{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ae.UNAUTHENTICATED))}shutdown(){}}class kf{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Rf{constructor(e){this.t=e,this.currentUser=ae.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let s=this.i;const i=c=>this.i!==s?(s=this.i,t(c)):Promise.resolve();let o=new J;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new J,e.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const c=o;e.enqueueRetryable((0,g.Z)(function*(){yield c.promise,yield i(r.currentUser)}))},u=c=>{w("FirebaseCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?u(c):(w("FirebaseCredentialsProvider","Auth not yet detected"),o.resolve(),o=new J)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(w("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(b("string"==typeof r.accessToken),new ac(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return b(null===e||"string"==typeof e),new ae(e)}}class Lf{constructor(e,t,r){this.h=e,this.l=t,this.m=r,this.type="FirstParty",this.user=ae.FIRST_PARTY}get authHeaders(){const e={"X-Goog-AuthUser":this.l},t=this.h.auth.getAuthHeaderValueForFirstParty([]);return t&&(e.Authorization=t),this.m&&(e["X-Goog-Iam-Authorization-Token"]=this.m),e}}class Mf{constructor(e,t,r){this.h=e,this.l=t,this.m=r}getToken(){return Promise.resolve(new Lf(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(ae.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Se{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.g(r),this.p=r=>t.writeSequenceNumber(r))}g(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.p&&this.p(e),e}}function Ff(n){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}Se.T=-1;class uc{static I(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=Ff(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function C(n,e){return n<e?-1:n>e?1:0}function zt(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function cc(n){return n+"\0"}class ee{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new v(f.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new v(f.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new v(f.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new v(f.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return ee.fromMillis(Date.now())}static fromDate(e){return ee.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new ee(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?C(this.nanoseconds,e.nanoseconds):C(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class N{constructor(e){this.timestamp=e}static fromTimestamp(e){return new N(e)}static min(){return new N(new ee(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function hc(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function It(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function lc(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class Gn{constructor(e,t,r){void 0===t?t=0:t>e.length&&x(),void 0===r?r=e.length-t:r>e.length-t&&x(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===Gn.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Gn?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class F extends Gn{construct(e,t,r){return new F(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new v(f.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new F(t)}static emptyPath(){return new F([])}}const Of=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ue extends Gn{construct(e,t,r){return new ue(e,t,r)}static isValidIdentifier(e){return Of.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ue.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ue(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(0===r.length)throw new v(f.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if("\\"===a){if(s+1===e.length)throw new v(f.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new v(f.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,s+=2}else"`"===a?(o=!o,s++):"."!==a||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new v(f.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ue(t)}static emptyPath(){return new ue([])}}class Ht{constructor(e){this.fields=e,e.sort(ue.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return zt(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class te{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new te(t)}static fromUint8Array(e){const t=function(r){let s="";for(let i=0;i<r.length;++i)s+=String.fromCharCode(r[i]);return s}(e);return new te(t)}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return C(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}te.EMPTY_BYTE_STRING=new te("");const Uf=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function nt(n){if(b(!!n),"string"==typeof n){let e=0;const t=Uf.exec(n);if(b(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:z(n.seconds),nanos:z(n.nanos)}}function z(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function Qt(n){return"string"==typeof n?te.fromBase64String(n):te.fromUint8Array(n)}function Mi(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==n?void 0:n.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function dc(n){const e=n.mapValue.fields.__previous_value__;return Mi(e)?dc(e):e}function zn(n){const e=nt(n.mapValue.fields.__local_write_time__.timestampValue);return new ee(e.seconds,e.nanos)}function Et(n){return null==n}function Xr(n){return 0===n&&1/n==-1/0}function fc(n){return"number"==typeof n&&Number.isInteger(n)&&!Xr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}class E{constructor(e){this.path=e}static fromPath(e){return new E(F.fromString(e))}static fromName(e){return new E(F.fromString(e).popFirst(5))}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}isEqual(e){return null!==e&&0===F.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return F.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new E(new F(e.slice()))}}function xt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Mi(n)?4:10:x()}function Oe(n,e){const t=xt(n);if(t!==xt(e))return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return zn(n).isEqual(zn(e));case 3:return function(r,s){if("string"==typeof r.timestampValue&&"string"==typeof s.timestampValue&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;const i=nt(r.timestampValue),o=nt(s.timestampValue);return i.seconds===o.seconds&&i.nanos===o.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return s=e,Qt(n.bytesValue).isEqual(Qt(s.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,s){return z(r.geoPointValue.latitude)===z(s.geoPointValue.latitude)&&z(r.geoPointValue.longitude)===z(s.geoPointValue.longitude)}(n,e);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return z(r.integerValue)===z(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){const i=z(r.doubleValue),o=z(s.doubleValue);return i===o?Xr(i)===Xr(o):isNaN(i)&&isNaN(o)}return!1}(n,e);case 9:return zt(n.arrayValue.values||[],e.arrayValue.values||[],Oe);case 10:return function(r,s){const i=r.mapValue.fields||{},o=s.mapValue.fields||{};if(hc(i)!==hc(o))return!1;for(const a in i)if(i.hasOwnProperty(a)&&(void 0===o[a]||!Oe(i[a],o[a])))return!1;return!0}(n,e);default:return x()}var s}function Hn(n,e){return void 0!==(n.values||[]).find(t=>Oe(t,e))}function Wt(n,e){const t=xt(n),r=xt(e);if(t!==r)return C(t,r);switch(t){case 0:return 0;case 1:return C(n.booleanValue,e.booleanValue);case 2:return function(s,i){const o=z(s.integerValue||s.doubleValue),a=z(i.integerValue||i.doubleValue);return o<a?-1:o>a?1:o===a?0:isNaN(o)?isNaN(a)?0:-1:1}(n,e);case 3:return mc(n.timestampValue,e.timestampValue);case 4:return mc(zn(n),zn(e));case 5:return C(n.stringValue,e.stringValue);case 6:return function(s,i){const o=Qt(s),a=Qt(i);return o.compareTo(a)}(n.bytesValue,e.bytesValue);case 7:return function(s,i){const o=s.split("/"),a=i.split("/");for(let u=0;u<o.length&&u<a.length;u++){const c=C(o[u],a[u]);if(0!==c)return c}return C(o.length,a.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,i){const o=C(z(s.latitude),z(i.latitude));return 0!==o?o:C(z(s.longitude),z(i.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,i){const o=s.values||[],a=i.values||[];for(let u=0;u<o.length&&u<a.length;++u){const c=Wt(o[u],a[u]);if(c)return c}return C(o.length,a.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,i){const o=s.fields||{},a=Object.keys(o),u=i.fields||{},c=Object.keys(u);a.sort(),c.sort();for(let l=0;l<a.length&&l<c.length;++l){const d=C(a[l],c[l]);if(0!==d)return d;const m=Wt(o[a[l]],u[c[l]]);if(0!==m)return m}return C(a.length,c.length)}(n.mapValue,e.mapValue);default:throw x()}}function mc(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return C(n,e);const t=nt(n),r=nt(e),s=C(t.seconds,r.seconds);return 0!==s?s:C(t.nanos,r.nanos)}function Fi(n){return Oi(n)}function Oi(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(r){const s=nt(r);return`time(${s.seconds},${s.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?Qt(n.bytesValue).toBase64():"referenceValue"in n?E.fromName(n.referenceValue).toString():"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(r){let s="[",i=!0;for(const o of r.values||[])i?i=!1:s+=",",s+=Oi(o);return s+"]"}(n.arrayValue):"mapValue"in n?function(r){const s=Object.keys(r.fields||{}).sort();let i="{",o=!0;for(const a of s)o?o=!1:i+=",",i+=`${a}:${Oi(r.fields[a])}`;return i+"}"}(n.mapValue):x();var e}function Jr(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Pi(n){return!!n&&"integerValue"in n}function Ui(n){return!!n&&"arrayValue"in n}function gc(n){return!!n&&"nullValue"in n}function pc(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function es(n){return!!n&&"mapValue"in n}function Qn(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return It(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Qn(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Qn(n.arrayValue.values[t]);return e}return Object.assign({},n)}class de{constructor(e){this.value=e}static empty(){return new de({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!es(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Qn(t)}setAll(e){let t=ue.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const u=this.getFieldsMap(t);this.applyChanges(u,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Qn(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());es(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Oe(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];es(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){It(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new de(Qn(this.value))}}function yc(n){const e=[];return It(n.fields,(t,r)=>{const s=new ue([t]);if(es(r)){const i=yc(r.mapValue).fields;if(0===i.length)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Ht(e)}class V{constructor(e,t,r,s,i){this.key=e,this.documentType=t,this.version=r,this.data=s,this.documentState=i}static newInvalidDocument(e){return new V(e,0,N.min(),de.empty(),0)}static newFoundDocument(e,t,r){return new V(e,1,t,r,0)}static newNoDocument(e,t){return new V(e,2,t,de.empty(),0)}static newUnknownDocument(e,t){return new V(e,3,t,de.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=de.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=de.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof V&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}clone(){return new V(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class qf{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.A=null}}function vc(n,e=null,t=[],r=[],s=null,i=null,o=null){return new qf(n,e,t,r,s,i,o)}function Wn(n){const e=T(n);if(null===e.A){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>function(n){return n.field.canonicalString()+n.op.toString()+Fi(n.value)}(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(s=r).field.canonicalString()+s.dir;var s}).join(","),Et(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=rs(e.startAt)),e.endAt&&(t+="|ub:",t+=rs(e.endAt)),e.A=t}return e.A}function ts(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let s=0;s<n.orderBy.length;s++)if(!Qf(n.orderBy[s],e.orderBy[s]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let s=0;s<n.filters.length;s++)if((t=n.filters[s]).op!==(r=e.filters[s]).op||!t.field.isEqual(r.field)||!Oe(t.value,r.value))return!1;var t,r;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Tc(n.startAt,e.startAt)&&Tc(n.endAt,e.endAt)}function ns(n){return E.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}class ve extends class{}{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.R(e,t,r):new jf(e,t,r):"array-contains"===t?new $f(e,r):"in"===t?new Gf(e,r):"not-in"===t?new zf(e,r):"array-contains-any"===t?new Hf(e,r):new ve(e,t,r)}static R(e,t,r){return"in"===t?new Zf(e,r):new Kf(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.P(Wt(t,this.value)):null!==t&&xt(this.value)===xt(t)&&this.P(Wt(t,this.value))}P(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return x()}}v(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class jf extends ve{constructor(e,t,r){super(e,t,r),this.key=E.fromName(r.referenceValue)}matches(e){const t=E.comparator(e.key,this.key);return this.P(t)}}class Zf extends ve{constructor(e,t){super(e,"in",t),this.keys=wc(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Kf extends ve{constructor(e,t){super(e,"not-in",t),this.keys=wc(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function wc(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>E.fromName(r.referenceValue))}class $f extends ve{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Ui(t)&&Hn(t.arrayValue,this.value)}}class Gf extends ve{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Hn(this.value.arrayValue,t)}}class zf extends ve{constructor(e,t){super(e,"not-in",t)}matches(e){if(Hn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Hn(this.value.arrayValue,t)}}class Hf extends ve{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ui(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Hn(this.value.arrayValue,r))}}class Yn{constructor(e,t){this.position=e,this.before=t}}function rs(n){return`${n.before?"b":"a"}:${n.position.map(e=>Fi(e)).join(",")}`}class Yt{constructor(e,t="asc"){this.field=e,this.dir=t}}function Qf(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}function _c(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(r=i.field.isKeyField()?E.comparator(E.fromName(o.referenceValue),t.key):Wt(o,t.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return n.before?r<=0:r<0}function Tc(n,e){if(null===n)return null===e;if(null===e||n.before!==e.before||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Oe(n.position[t],e.position[t]))return!1;return!0}class $e{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=u,this.V=null,this.S=null}}function Ic(n,e,t,r,s,i,o,a){return new $e(n,e,t,r,s,i,o,a)}function Xt(n){return new $e(n)}function ss(n){return!Et(n.limit)&&"F"===n.limitType}function is(n){return!Et(n.limit)&&"L"===n.limitType}function qi(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function Vi(n){for(const e of n.filters)if(e.v())return e.field;return null}function Bi(n){return null!==n.collectionGroup}function Jt(n){const e=T(n);if(null===e.V){e.V=[];const t=Vi(e),r=qi(e);if(null!==t&&null===r)t.isKeyField()||e.V.push(new Yt(t)),e.V.push(new Yt(ue.keyField(),"asc"));else{let s=!1;for(const i of e.explicitOrderBy)e.V.push(i),i.field.isKeyField()&&(s=!0);if(!s){const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.V.push(new Yt(ue.keyField(),i))}}}return e.V}function De(n){const e=T(n);if(!e.S)if("F"===e.limitType)e.S=vc(e.path,e.collectionGroup,Jt(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const i of Jt(e))t.push(new Yt(i.field,"desc"===i.dir?"asc":"desc"));const r=e.endAt?new Yn(e.endAt.position,!e.endAt.before):null,s=e.startAt?new Yn(e.startAt.position,!e.startAt.before):null;e.S=vc(e.path,e.collectionGroup,t,e.filters,e.limit,r,s)}return e.S}function Ec(n,e,t){return new $e(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Xn(n,e){return ts(De(n),De(e))&&n.limitType===e.limitType}function xc(n){return`${Wn(De(n))}|lt:${n.limitType}`}function ji(n){return`Query(target=${function(n){let e=n.path.canonicalString();return null!==n.collectionGroup&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>{return`${(r=t).field.canonicalString()} ${r.op} ${Fi(r.value)}`;var r}).join(", ")}]`),Et(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>{return`${(r=t).field.canonicalString()} (${r.dir})`;var r}).join(", ")}]`),n.startAt&&(e+=", startAt: "+rs(n.startAt)),n.endAt&&(e+=", endAt: "+rs(n.endAt)),`Target(${e})`}(De(n))}; limitType=${n.limitType})`}function Jn(n,e){return e.isFoundDocument()&&function(t,r){const s=r.key.path;return null!==t.collectionGroup?r.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(s):E.isDocumentKey(t.path)?t.path.isEqual(s):t.path.isImmediateParentOf(s)}(n,e)&&function(t,r){for(const s of t.explicitOrderBy)if(!s.field.isKeyField()&&null===r.data.field(s.field))return!1;return!0}(n,e)&&function(t,r){for(const s of t.filters)if(!s.matches(r))return!1;return!0}(n,e)&&(r=e,!((t=n).startAt&&!_c(t.startAt,Jt(t),r)||t.endAt&&_c(t.endAt,Jt(t),r)));var t,r}function Sc(n){return(e,t)=>{let r=!1;for(const s of Jt(n)){const i=Wf(s,e,t);if(0!==i)return i;r=r||s.field.isKeyField()}return 0}}function Wf(n,e,t){const r=n.field.isKeyField()?E.comparator(e.key,t.key):function(s,i,o){const a=i.data.field(s),u=o.data.field(s);return null!==a&&null!==u?Wt(a,u):x()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return x()}}function bc(n,e){if(n.D){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Xr(e)?"-0":e}}function Ac(n){return{integerValue:""+n}}function Nc(n,e){return fc(e)?Ac(e):bc(n,e)}class os{constructor(){this._=void 0}}function Yf(n,e,t){return n instanceof en?function(r,s){const i={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&(i.fields.__previous_value__=s),{mapValue:i}}(t,e):n instanceof St?Cc(n,e):n instanceof bt?kc(n,e):function(r,s){const i=Dc(r,s),o=Rc(i)+Rc(r.C);return Pi(i)&&Pi(r.C)?Ac(o):bc(r.N,o)}(n,e)}function Xf(n,e,t){return n instanceof St?Cc(n,e):n instanceof bt?kc(n,e):t}function Dc(n,e){return n instanceof tn?Pi(t=e)||(r=t)&&"doubleValue"in r?e:{integerValue:0}:null;var r,t}class en extends os{}class St extends os{constructor(e){super(),this.elements=e}}function Cc(n,e){const t=Lc(e);for(const r of n.elements)t.some(s=>Oe(s,r))||t.push(r);return{arrayValue:{values:t}}}class bt extends os{constructor(e){super(),this.elements=e}}function kc(n,e){let t=Lc(e);for(const r of n.elements)t=t.filter(s=>!Oe(s,r));return{arrayValue:{values:t}}}class tn extends os{constructor(e,t){super(),this.N=e,this.C=t}}function Rc(n){return z(n.integerValue||n.doubleValue)}function Lc(n){return Ui(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class er{constructor(e,t){this.field=e,this.transform=t}}class em{constructor(e,t){this.version=e,this.transformResults=t}}class H{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new H}static exists(e){return new H(void 0,e)}static updateTime(e){return new H(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function as(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class us{}function tm(n,e,t){n instanceof tr?function(r,s,i){const o=r.value.clone(),a=Pc(r.fieldTransforms,s,i.transformResults);o.setAll(a),s.convertToFoundDocument(i.version,o).setHasCommittedMutations()}(n,e,t):n instanceof rt?function(r,s,i){if(!as(r.precondition,s))return void s.convertToUnknownDocument(i.version);const o=Pc(r.fieldTransforms,s,i.transformResults),a=s.data;a.setAll(Oc(r)),a.setAll(o),s.convertToFoundDocument(i.version,a).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Zi(n,e,t){var s;n instanceof tr?function(r,s,i){if(!as(r.precondition,s))return;const o=r.value.clone(),a=Uc(r.fieldTransforms,i,s);o.setAll(a),s.convertToFoundDocument(Fc(s),o).setHasLocalMutations()}(n,e,t):n instanceof rt?function(r,s,i){if(!as(r.precondition,s))return;const o=Uc(r.fieldTransforms,i,s),a=s.data;a.setAll(Oc(r)),a.setAll(o),s.convertToFoundDocument(Fc(s),a).setHasLocalMutations()}(n,e,t):as(n.precondition,s=e)&&s.convertToNoDocument(N.min())}function nm(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=Dc(r.transform,s||null);null!=i&&(null==t&&(t=de.empty()),t.set(r.field,i))}return t||null}function Mc(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(r=e.fieldTransforms,!!(void 0===(t=n.fieldTransforms)&&void 0===r||t&&r&&zt(t,r,(s,i)=>function(n,e){return n.field.isEqual(e.field)&&(r=e.transform,(t=n.transform)instanceof St&&r instanceof St||t instanceof bt&&r instanceof bt?zt(t.elements,r.elements,Oe):t instanceof tn&&r instanceof tn?Oe(t.C,r.C):t instanceof en&&r instanceof en);var t,r}(s,i))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var t,r}function Fc(n){return n.isFoundDocument()?n.version:N.min()}class tr extends us{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}}class rt extends us{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}}function Oc(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Pc(n,e,t){const r=new Map;b(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,Xf(o,a,t[s]))}return r}function Uc(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,Yf(i,o,e))}return r}class nr extends us{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class Ki extends us{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class rm{constructor(e){this.count=e}}var Q,R;function qc(n){switch(n){default:return x();case f.CANCELLED:case f.UNKNOWN:case f.DEADLINE_EXCEEDED:case f.RESOURCE_EXHAUSTED:case f.INTERNAL:case f.UNAVAILABLE:case f.UNAUTHENTICATED:return!1;case f.INVALID_ARGUMENT:case f.NOT_FOUND:case f.ALREADY_EXISTS:case f.PERMISSION_DENIED:case f.FAILED_PRECONDITION:case f.ABORTED:case f.OUT_OF_RANGE:case f.UNIMPLEMENTED:case f.DATA_LOSS:return!0}}function Vc(n){if(void 0===n)return G("GRPC error has no .code"),f.UNKNOWN;switch(n){case Q.OK:return f.OK;case Q.CANCELLED:return f.CANCELLED;case Q.UNKNOWN:return f.UNKNOWN;case Q.DEADLINE_EXCEEDED:return f.DEADLINE_EXCEEDED;case Q.RESOURCE_EXHAUSTED:return f.RESOURCE_EXHAUSTED;case Q.INTERNAL:return f.INTERNAL;case Q.UNAVAILABLE:return f.UNAVAILABLE;case Q.UNAUTHENTICATED:return f.UNAUTHENTICATED;case Q.INVALID_ARGUMENT:return f.INVALID_ARGUMENT;case Q.NOT_FOUND:return f.NOT_FOUND;case Q.ALREADY_EXISTS:return f.ALREADY_EXISTS;case Q.PERMISSION_DENIED:return f.PERMISSION_DENIED;case Q.FAILED_PRECONDITION:return f.FAILED_PRECONDITION;case Q.ABORTED:return f.ABORTED;case Q.OUT_OF_RANGE:return f.OUT_OF_RANGE;case Q.UNIMPLEMENTED:return f.UNIMPLEMENTED;case Q.DATA_LOSS:return f.DATA_LOSS;default:return x()}}(R=Q||(Q={}))[R.OK=0]="OK",R[R.CANCELLED=1]="CANCELLED",R[R.UNKNOWN=2]="UNKNOWN",R[R.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",R[R.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",R[R.NOT_FOUND=5]="NOT_FOUND",R[R.ALREADY_EXISTS=6]="ALREADY_EXISTS",R[R.PERMISSION_DENIED=7]="PERMISSION_DENIED",R[R.UNAUTHENTICATED=16]="UNAUTHENTICATED",R[R.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",R[R.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",R[R.ABORTED=10]="ABORTED",R[R.OUT_OF_RANGE=11]="OUT_OF_RANGE",R[R.UNIMPLEMENTED=12]="UNIMPLEMENTED",R[R.INTERNAL=13]="INTERNAL",R[R.UNAVAILABLE=14]="UNAVAILABLE",R[R.DATA_LOSS=15]="DATA_LOSS";class W{constructor(e,t){this.comparator=e,this.root=t||ce.EMPTY}insert(e,t){return new W(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ce.BLACK,null,null))}remove(e){return new W(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ce.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(0===s)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new cs(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new cs(this.root,e,this.comparator,!1)}getReverseIterator(){return new cs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new cs(this.root,e,this.comparator,!0)}}class cs{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ce{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=null!=r?r:ce.RED,this.left=null!=s?s:ce.EMPTY,this.right=null!=i?i:ce.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new ce(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=s?s:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):0===i?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return ce.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===t(e,s.key)){if(s.right.isEmpty())return ce.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ce.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ce.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw x();const e=this.left.check();if(e!==this.right.check())throw x();return e+(this.isRed()?0:1)}}ce.EMPTY=null,ce.RED=!0,ce.BLACK=!1,ce.EMPTY=new class{constructor(){this.size=0}get key(){throw x()}get value(){throw x()}get color(){throw x()}get left(){throw x()}get right(){throw x()}copy(n,e,t,r,s){return this}insert(n,e,t){return new ce(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class j{constructor(e){this.comparator=e,this.data=new W(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Bc(this.data.getIterator())}getIteratorFrom(e){return new Bc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof j)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(0!==this.comparator(s,i))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new j(this.comparator);return t.data=e,t}}class Bc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const sm=new W(E.comparator);function Ce(){return sm}const im=new W(E.comparator);function $i(){return im}const om=new W(E.comparator);function jc(){return om}const am=new j(E.comparator);function O(...n){let e=am;for(const t of n)e=e.add(t);return e}const um=new j(C);function hs(){return um}class rr{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t){const r=new Map;return r.set(e,sr.createSynthesizedTargetChangeForCurrentChange(e,t)),new rr(N.min(),r,hs(),Ce(),O())}}class sr{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t){return new sr(te.EMPTY_BYTE_STRING,t,O(),O(),O())}}class ls{constructor(e,t,r,s){this.k=e,this.removedTargetIds=t,this.key=r,this.$=s}}class Zc{constructor(e,t){this.targetId=e,this.O=t}}class Kc{constructor(e,t,r=te.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class $c{constructor(){this.F=0,this.M=zc(),this.L=te.EMPTY_BYTE_STRING,this.B=!1,this.U=!0}get current(){return this.B}get resumeToken(){return this.L}get q(){return 0!==this.F}get K(){return this.U}j(e){e.approximateByteSize()>0&&(this.U=!0,this.L=e)}W(){let e=O(),t=O(),r=O();return this.M.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:x()}}),new sr(this.L,this.B,e,t,r)}G(){this.U=!1,this.M=zc()}H(e,t){this.U=!0,this.M=this.M.insert(e,t)}J(e){this.U=!0,this.M=this.M.remove(e)}Y(){this.F+=1}X(){this.F-=1}Z(){this.U=!0,this.B=!0}}class cm{constructor(e){this.tt=e,this.et=new Map,this.nt=Ce(),this.st=Gc(),this.it=new j(C)}rt(e){for(const t of e.k)e.$&&e.$.isFoundDocument()?this.ot(t,e.$):this.ct(t,e.key,e.$);for(const t of e.removedTargetIds)this.ct(t,e.key,e.$)}at(e){this.forEachTarget(e,t=>{const r=this.ut(t);switch(e.state){case 0:this.ht(t)&&r.j(e.resumeToken);break;case 1:r.X(),r.q||r.G(),r.j(e.resumeToken);break;case 2:r.X(),r.q||this.removeTarget(t);break;case 3:this.ht(t)&&(r.Z(),r.j(e.resumeToken));break;case 4:this.ht(t)&&(this.lt(t),r.j(e.resumeToken));break;default:x()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.et.forEach((r,s)=>{this.ht(s)&&t(s)})}ft(e){const t=e.targetId,r=e.O.count,s=this.dt(t);if(s){const i=s.target;if(ns(i))if(0===r){const o=new E(i.path);this.ct(t,o,V.newNoDocument(o,N.min()))}else b(1===r);else this.wt(t)!==r&&(this.lt(t),this.it=this.it.add(t))}}_t(e){const t=new Map;this.et.forEach((i,o)=>{const a=this.dt(o);if(a){if(i.current&&ns(a.target)){const u=new E(a.target.path);null!==this.nt.get(u)||this.gt(o,u)||this.ct(o,u,V.newNoDocument(u,e))}i.K&&(t.set(o,i.W()),i.G())}});let r=O();this.st.forEach((i,o)=>{let a=!0;o.forEachWhile(u=>{const c=this.dt(u);return!c||2===c.purpose||(a=!1,!1)}),a&&(r=r.add(i))});const s=new rr(e,t,this.it,this.nt,r);return this.nt=Ce(),this.st=Gc(),this.it=new j(C),s}ot(e,t){if(!this.ht(e))return;const r=this.gt(e,t.key)?2:0;this.ut(e).H(t.key,r),this.nt=this.nt.insert(t.key,t),this.st=this.st.insert(t.key,this.yt(t.key).add(e))}ct(e,t,r){if(!this.ht(e))return;const s=this.ut(e);this.gt(e,t)?s.H(t,1):s.J(t),this.st=this.st.insert(t,this.yt(t).delete(e)),r&&(this.nt=this.nt.insert(t,r))}removeTarget(e){this.et.delete(e)}wt(e){const t=this.ut(e).W();return this.tt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Y(e){this.ut(e).Y()}ut(e){let t=this.et.get(e);return t||(t=new $c,this.et.set(e,t)),t}yt(e){let t=this.st.get(e);return t||(t=new j(C),this.st=this.st.insert(e,t)),t}ht(e){const t=null!==this.dt(e);return t||w("WatchChangeAggregator","Detected inactive target",e),t}dt(e){const t=this.et.get(e);return t&&t.q?null:this.tt.Tt(e)}lt(e){this.et.set(e,new $c),this.tt.getRemoteKeysForTarget(e).forEach(t=>{this.ct(e,t,null)})}gt(e,t){return this.tt.getRemoteKeysForTarget(e).has(t)}}function Gc(){return new W(E.comparator)}function zc(){return new W(E.comparator)}const hm={asc:"ASCENDING",desc:"DESCENDING"},lm={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class dm{constructor(e,t){this.databaseId=e,this.D=t}}function ir(n,e){return n.D?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Hc(n,e){return n.D?e.toBase64():e.toUint8Array()}function fm(n,e){return ir(n,e.toTimestamp())}function ne(n){return b(!!n),N.fromTimestamp(function(e){const t=nt(e);return new ee(t.seconds,t.nanos)}(n))}function Gi(n,e){return(t=n,new F(["projects",t.projectId,"databases",t.database])).child("documents").child(e).canonicalString();var t}function Qc(n){const e=F.fromString(n);return b(ah(e)),e}function or(n,e){return Gi(n.databaseId,e.path)}function Pe(n,e){const t=Qc(e);if(t.get(1)!==n.databaseId.projectId)throw new v(f.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new v(f.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new E(Yc(t))}function zi(n,e){return Gi(n.databaseId,e)}function Wc(n){const e=Qc(n);return 4===e.length?F.emptyPath():Yc(e)}function ar(n){return new F(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Yc(n){return b(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function Xc(n,e,t){return{name:or(n,e),fields:t.value.mapValue.fields}}function Jc(n,e,t){const r=Pe(n,e.name),s=ne(e.updateTime),i=new de({mapValue:{fields:e.fields}}),o=V.newFoundDocument(r,s,i);return t&&o.setHasCommittedMutations(),t?o.setHasCommittedMutations():o}function ds(n,e){let t;if(e instanceof tr)t={update:Xc(n,e.key,e.value)};else if(e instanceof nr)t={delete:or(n,e.key)};else if(e instanceof rt)t={update:Xc(n,e.key,e.data),updateMask:Im(e.fieldMask)};else{if(!(e instanceof Ki))return x();t={verify:or(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,i){const o=i.transform;if(o instanceof en)return{fieldPath:i.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof St)return{fieldPath:i.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof bt)return{fieldPath:i.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof tn)return{fieldPath:i.field.canonicalString(),increment:o.C};throw x()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:fm(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:x()),t;var s}function eh(n,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?H.updateTime(ne(s.updateTime)):void 0!==s.exists?H.exists(s.exists):H.none():H.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(i,o){let a=null;"setToServerValue"in o?(b("REQUEST_TIME"===o.setToServerValue),a=new en):"appendMissingElements"in o?a=new St(o.appendMissingElements.values||[]):"removeAllFromArray"in o?a=new bt(o.removeAllFromArray.values||[]):"increment"in o?a=new tn(i,o.increment):x();const u=ue.fromServerFormat(o.fieldPath);return new er(u,a)}(n,s)):[];var s;if(e.update){const s=Pe(n,e.update.name),i=new de({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=new Ht((e.updateMask.fieldPaths||[]).map(c=>ue.fromServerFormat(c)));return new rt(s,i,o,t,r)}return new tr(s,i,t,r)}if(e.delete){const s=Pe(n,e.delete);return new nr(s,t)}if(e.verify){const s=Pe(n,e.verify);return new Ki(s,t)}return x()}function th(n,e){return{documents:[zi(n,e.path)]}}function nh(n,e){const t={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(t.parent=zi(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=zi(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const s=function(a){if(0===a.length)return;const u=a.map(c=>function(l){if("=="===l.op){if(pc(l.value))return{unaryFilter:{field:nn(l.field),op:"IS_NAN"}};if(gc(l.value))return{unaryFilter:{field:nn(l.field),op:"IS_NULL"}}}else if("!="===l.op){if(pc(l.value))return{unaryFilter:{field:nn(l.field),op:"IS_NOT_NAN"}};if(gc(l.value))return{unaryFilter:{field:nn(l.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:nn(l.field),op:wm(l.op),value:l.value}}}(c));return 1===u.length?u[0]:{compositeFilter:{op:"AND",filters:u}}}(e.filters);s&&(t.structuredQuery.where=s);const i=function(a){if(0!==a.length)return a.map(u=>{return{field:nn((c=u).field),direction:vm(c.dir)};var c})}(e.orderBy);i&&(t.structuredQuery.orderBy=i);const o=(u=e.limit,n.D||Et(u)?u:{value:u});var u;return null!==o&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt=ih(e.startAt)),e.endAt&&(t.structuredQuery.endAt=ih(e.endAt)),t}function rh(n){let e=Wc(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){b(1===r);const l=t.from[0];l.allDescendants?s=l.collectionId:e=e.child(l.collectionId)}let i=[];t.where&&(i=sh(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(l=>{return new Yt(rn((d=l).field),function(m){switch(m){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(d.direction));var d}));let a=null;t.limit&&(a=function(l){let d;return d="object"==typeof l?l.value:l,Et(d)?null:d}(t.limit));let u=null;t.startAt&&(u=oh(t.startAt));let c=null;return t.endAt&&(c=oh(t.endAt)),Ic(e,s,o,i,a,"F",u,c)}function sh(n){return n?void 0!==n.unaryFilter?[Tm(n)]:void 0!==n.fieldFilter?[_m(n)]:void 0!==n.compositeFilter?n.compositeFilter.filters.map(e=>sh(e)).reduce((e,t)=>e.concat(t)):x():[]}function ih(n){return{before:n.before,values:n.position}}function oh(n){return new Yn(n.values||[],!!n.before)}function vm(n){return hm[n]}function wm(n){return lm[n]}function nn(n){return{fieldPath:n.canonicalString()}}function rn(n){return ue.fromServerFormat(n.fieldPath)}function _m(n){return ve.create(rn(n.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return x()}}(n.fieldFilter.op),n.fieldFilter.value)}function Tm(n){switch(n.unaryFilter.op){case"IS_NAN":const e=rn(n.unaryFilter.field);return ve.create(e,"==",{doubleValue:NaN});case"IS_NULL":const t=rn(n.unaryFilter.field);return ve.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=rn(n.unaryFilter.field);return ve.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=rn(n.unaryFilter.field);return ve.create(s,"!=",{nullValue:"NULL_VALUE"});default:return x()}}function Im(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function ah(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}function Re(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=uh(e)),e=Em(n.get(t),e);return uh(e)}function Em(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=i}}return t}function uh(n){return n+"\x01\x01"}function Ge(n){const e=n.length;if(b(e>=2),2===e)return b("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),F.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("\x01",i);switch((o<0||o>t)&&x(),n.charAt(o+1)){case"\x01":const a=n.substring(i,o);let u;0===s.length?u=a:(s+=a,u=s,s=""),r.push(u);break;case"\x10":s+=n.substring(i,o),s+="\0";break;case"\x11":s+=n.substring(i,o+1);break;default:x()}i=o+2}return new F(r)}class xm{constructor(e,t){this.seconds=e,this.nanoseconds=t}}class be{constructor(e,t,r){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=r}}be.store="owner",be.key="owner";class st{constructor(e,t,r){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=r}}st.store="mutationQueues",st.keyPath="userId";class P{constructor(e,t,r,s,i){this.userId=e,this.batchId=t,this.localWriteTimeMs=r,this.baseMutations=s,this.mutations=i}}P.store="mutations",P.keyPath="batchId",P.userMutationsIndex="userMutationsIndex",P.userMutationsKeyPath=["userId","batchId"];class fe{constructor(){}static prefixForUser(e){return[e]}static prefixForPath(e,t){return[e,Re(t)]}static key(e,t,r){return[e,Re(t),r]}}fe.store="documentMutations",fe.PLACEHOLDER=new fe;class Sm{constructor(e,t){this.path=e,this.readTime=t}}class bm{constructor(e,t){this.path=e,this.version=t}}class Z{constructor(e,t,r,s,i,o){this.unknownDocument=e,this.noDocument=t,this.document=r,this.hasCommittedMutations=s,this.readTime=i,this.parentPath=o}}Z.store="remoteDocuments",Z.readTimeIndex="readTimeIndex",Z.readTimeIndexPath="readTime",Z.collectionReadTimeIndex="collectionReadTimeIndex",Z.collectionReadTimeIndexPath=["parentPath","readTime"];class Ue{constructor(e){this.byteSize=e}}Ue.store="remoteDocumentGlobal",Ue.key="remoteDocumentGlobalKey";class Te{constructor(e,t,r,s,i,o,a){this.targetId=e,this.canonicalId=t,this.readTime=r,this.resumeToken=s,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=a}}Te.store="targets",Te.keyPath="targetId",Te.queryTargetsIndexName="queryTargetsIndex",Te.queryTargetsKeyPath=["canonicalId","targetId"];class he{constructor(e,t,r){this.targetId=e,this.path=t,this.sequenceNumber=r}}he.store="targetDocuments",he.keyPath=["targetId","path"],he.documentTargetsIndex="documentTargetsIndex",he.documentTargetsKeyPath=["path","targetId"];class Ae{constructor(e,t,r,s){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=r,this.targetCount=s}}Ae.key="targetGlobalKey",Ae.store="targetGlobal";class At{constructor(e,t){this.collectionId=e,this.parent=t}}At.store="collectionParents",At.keyPath=["collectionId","parent"];class ze{constructor(e,t,r,s){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=r,this.inForeground=s}}ze.store="clientMetadata",ze.keyPath="clientId";class sn{constructor(e,t,r){this.bundleId=e,this.createTime=t,this.version=r}}sn.store="bundles",sn.keyPath="bundleId";class on{constructor(e,t,r){this.name=e,this.readTime=t,this.bundledQuery=r}}on.store="namedQueries",on.keyPath="name";const Am=[st.store,P.store,fe.store,Z.store,Te.store,be.store,Ae.store,he.store,ze.store,Ue.store,At.store,sn.store,on.store],ch="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class hh{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}class y{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&x(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new y((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof y?t:y.resolve(t)}catch(t){return y.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):y.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):y.reject(t)}static resolve(e){return new y((t,r)=>{t(e)})}static reject(e){return new y((t,r)=>{r(e)})}static waitFor(e){return new y((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},u=>r(u))}),o=!0,i===s&&t()})}static or(e){let t=y.resolve(!1);for(const r of e)t=t.next(s=>s?y.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}}class fs{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.Et=new J,this.transaction.oncomplete=()=>{this.Et.resolve()},this.transaction.onabort=()=>{t.error?this.Et.reject(new ur(e,t.error)):this.Et.resolve()},this.transaction.onerror=r=>{const s=Hi(r.target.error);this.Et.reject(new ur(e,s))}}static open(e,t,r,s){try{return new fs(t,e.transaction(s,r))}catch(i){throw new ur(t,i)}}get It(){return this.Et.promise}abort(e){e&&this.Et.reject(e),this.aborted||(w("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(e){const t=this.transaction.objectStore(e);return new Dm(t)}}class Le{constructor(e,t,r){this.name=e,this.version=t,this.At=r,12.2===Le.Rt((0,M.z$)())&&G("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return w("SimpleDb","Removing database:",e),Dt(window.indexedDB.deleteDatabase(e)).toPromise()}static bt(){if(!(0,M.hl)())return!1;if(Le.Pt())return!0;const e=(0,M.z$)(),t=Le.Rt(e),r=0<t&&t<10,s=Le.vt(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static Pt(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.Vt)}static St(e,t){return e.store(t)}static Rt(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static vt(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}Dt(e){var t=this;return(0,g.Z)(function*(){return t.db||(w("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,s)=>{const i=indexedDB.open(t.name,t.version);i.onsuccess=o=>{r(o.target.result)},i.onblocked=()=>{s(new ur(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=o=>{const a=o.target.error;s("VersionError"===a.name?new v(f.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===a.name?new v(f.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a):new ur(e,a))},i.onupgradeneeded=o=>{w("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',o.oldVersion),t.At.Ct(o.target.result,i.transaction,o.oldVersion,t.version).next(()=>{w("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.Nt&&(t.db.onversionchange=r=>t.Nt(r)),t.db})()}xt(e){this.Nt=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,s){var i=this;return(0,g.Z)(function*(){const o="readonly"===t;let a=0;for(;;){++a;try{i.db=yield i.Dt(e);const u=fs.open(i.db,e,o?"readonly":"readwrite",r),c=s(u).catch(l=>(u.abort(l),y.reject(l))).toPromise();return c.catch(()=>{}),yield u.It,c}catch(u){const c="FirebaseError"!==u.name&&a<3;if(w("SimpleDb","Transaction failed with error:",u.message,"Retrying:",c),i.close(),!c)return Promise.reject(u)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class Nm{constructor(e){this.kt=e,this.$t=!1,this.Ot=null}get isDone(){return this.$t}get Ft(){return this.Ot}set cursor(e){this.kt=e}done(){this.$t=!0}Mt(e){this.Ot=e}delete(){return Dt(this.kt.delete())}}class ur extends v{constructor(e,t){super(f.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Nt(n){return"IndexedDbTransactionError"===n.name}class Dm{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(w("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(w("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Dt(r)}add(e){return w("SimpleDb","ADD",this.store.name,e,e),Dt(this.store.add(e))}get(e){return Dt(this.store.get(e)).next(t=>(void 0===t&&(t=null),w("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return w("SimpleDb","DELETE",this.store.name,e),Dt(this.store.delete(e))}count(){return w("SimpleDb","COUNT",this.store.name),Dt(this.store.count())}Lt(e,t){const r=this.cursor(this.options(e,t)),s=[];return this.Bt(r,(i,o)=>{s.push(o)}).next(()=>s)}Ut(e,t){w("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.qt=!1;const s=this.cursor(r);return this.Bt(s,(i,o,a)=>a.delete())}Kt(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.Bt(s,t)}jt(e){const t=this.cursor({});return new y((r,s)=>{t.onerror=i=>{const o=Hi(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}Bt(e,t){const r=[];return new y((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const u=new Nm(a),c=t(a.primaryKey,a.value,u);if(c instanceof y){const l=c.catch(d=>(u.done(),y.reject(d)));r.push(l)}u.isDone?s():null===u.Ft?a.continue():a.continue(u.Ft)}}).next(()=>y.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.qt?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Dt(n){return new y((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const s=Hi(r.target.error);t(s)}})}let lh=!1;function Hi(n){const e=Le.Rt((0,M.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new v("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return lh||(lh=!0,setTimeout(()=>{throw r},0)),r}}return n}class dh extends hh{constructor(e,t){super(),this.Qt=e,this.currentSequenceNumber=t}}function Ie(n,e){const t=T(n);return Le.St(t.Qt,e)}class Qi{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&tm(i,e,r[s])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&Zi(t,e,this.localWriteTime);for(const t of this.mutations)t.key.isEqual(e.key)&&Zi(t,e,this.localWriteTime)}applyToLocalDocumentSet(e){this.mutations.forEach(t=>{const r=e.get(t.key),s=r;this.applyToLocalView(s),r.isValidDocument()||s.convertToNoDocument(N.min())})}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),O())}isEqual(e){return this.batchId===e.batchId&&zt(this.mutations,e.mutations,(t,r)=>Mc(t,r))&&zt(this.baseMutations,e.baseMutations,(t,r)=>Mc(t,r))}}class Wi{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){b(e.mutations.length===r.length);let s=jc();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Wi(e,t,r,s)}}class it{constructor(e,t,r,s,i=N.min(),o=N.min(),a=te.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}withSequenceNumber(e){return new it(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new it(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new it(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class fh{constructor(e){this.Wt=e}}function Yi(n,e){if(e.document)return Jc(n.Wt,e.document,!!e.hasCommittedMutations);if(e.noDocument){const t=E.fromSegments(e.noDocument.path),r=un(e.noDocument.readTime),s=V.newNoDocument(t,r);return e.hasCommittedMutations?s.setHasCommittedMutations():s}if(e.unknownDocument){const t=E.fromSegments(e.unknownDocument.path),r=un(e.unknownDocument.version);return V.newUnknownDocument(t,r)}return x()}function mh(n,e,t){const r=Xi(t),s=e.key.path.popLast().toArray();if(e.isFoundDocument()){const i={name:or(a=n.Wt,(u=e).key),fields:u.data.value.mapValue.fields,updateTime:ir(a,u.version.toTimestamp())};return new Z(null,null,i,e.hasCommittedMutations,r,s)}var a,u;if(e.isNoDocument()){const i=e.key.path.toArray(),o=an(e.version),a=e.hasCommittedMutations;return new Z(null,new Sm(i,o),null,a,r,s)}if(e.isUnknownDocument()){const i=e.key.path.toArray(),o=an(e.version);return new Z(new bm(i,o),null,null,!0,r,s)}return x()}function Xi(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function gh(n){const e=new ee(n[0],n[1]);return N.fromTimestamp(e)}function an(n){const e=n.toTimestamp();return new xm(e.seconds,e.nanoseconds)}function un(n){const e=new ee(n.seconds,n.nanoseconds);return N.fromTimestamp(e)}function cn(n,e){const t=(e.baseMutations||[]).map(i=>eh(n.Wt,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];i+1<e.mutations.length&&void 0!==e.mutations[i+1].transform&&(o.updateTransforms=e.mutations[i+1].transform.fieldTransforms,e.mutations.splice(i+1,1),++i)}const r=e.mutations.map(i=>eh(n.Wt,i)),s=ee.fromMillis(e.localWriteTimeMs);return new Qi(e.batchId,s,t,r)}function cr(n){const e=un(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?un(n.lastLimboFreeSnapshotVersion):N.min();let r;var s;return void 0!==n.query.documents?(b(1===(s=n.query).documents.length),r=De(Xt(Wc(s.documents[0])))):r=De(rh(n.query)),new it(r,n.targetId,0,n.lastListenSequenceNumber,e,t,te.fromBase64String(n.resumeToken))}function ph(n,e){const t=an(e.snapshotVersion),r=an(e.lastLimboFreeSnapshotVersion);let s;s=ns(e.target)?th(n.Wt,e.target):nh(n.Wt,e.target);const i=e.resumeToken.toBase64();return new Te(e.targetId,Wn(e.target),t,i,e.sequenceNumber,r,s)}function Ji(n){const e=rh({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?Ec(e,e.limit,"L"):e}class Cm{getBundleMetadata(e,t){return yh(e).get(t).next(r=>{if(r)return{id:(s=r).bundleId,createTime:un(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return yh(e).put({bundleId:(r=t).id,createTime:an(ne(r.createTime)),version:r.version});var r}getNamedQuery(e,t){return vh(e).get(t).next(r=>{if(r)return{name:(s=r).name,query:Ji(s.bundledQuery),readTime:un(s.readTime)};var s})}saveNamedQuery(e,t){return vh(e).put({name:(r=t).name,readTime:an(ne(r.readTime)),bundledQuery:r.bundledQuery});var r}}function yh(n){return Ie(n,sn.store)}function vh(n){return Ie(n,on.store)}class km{constructor(){this.Gt=new eo}addToCollectionParentIndex(e,t){return this.Gt.add(t),y.resolve()}getCollectionParents(e,t){return y.resolve(this.Gt.getEntries(t))}}class eo{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new j(F.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new j(F.comparator)).toArray()}}class Rm{constructor(){this.zt=new eo}addToCollectionParentIndex(e,t){if(!this.zt.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.zt.add(t)});const i={collectionId:r,parent:Re(s)};return wh(e).put(i)}return y.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[cc(t),""],!1,!0);return wh(e).Lt(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(Ge(o.parent))}return r})}}function wh(n){return Ie(n,At.store)}const _h={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Ee{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Ee(e,Ee.DEFAULT_COLLECTION_PERCENTILE,Ee.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Th(n,e,t){const r=n.store(P.store),s=n.store(fe.store),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const u=r.Kt({range:o},(l,d,m)=>(a++,m.delete()));i.push(u.next(()=>{b(1===a)}));const c=[];for(const l of t.mutations){const d=fe.key(e,l.key.path,t.batchId);i.push(s.delete(d)),c.push(l.key)}return y.waitFor(i).next(()=>c)}function ms(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw x();e=n.noDocument}return JSON.stringify(e).length}Ee.DEFAULT_COLLECTION_PERCENTILE=10,Ee.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ee.DEFAULT=new Ee(41943040,Ee.DEFAULT_COLLECTION_PERCENTILE,Ee.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ee.DISABLED=new Ee(-1,0,0);class to{constructor(e,t,r,s){this.userId=e,this.N=t,this.Ht=r,this.referenceDelegate=s,this.Jt={}}static Yt(e,t,r,s){b(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new to(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ot(e).Kt({index:P.userMutationsIndex,range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=hn(e),o=ot(e);return o.add({}).next(a=>{b("number"==typeof a);const u=new Qi(a,t,r,s),c=function(m,p,_){const S=_.baseMutations.map(K=>ds(m.Wt,K)),D=_.mutations.map(K=>ds(m.Wt,K));return new P(p,_.batchId,_.localWriteTime.toMillis(),S,D)}(this.N,this.userId,u),l=[];let d=new j((m,p)=>C(m.canonicalString(),p.canonicalString()));for(const m of s){const p=fe.key(this.userId,m.key.path,a);d=d.add(m.key.path.popLast()),l.push(o.put(c)),l.push(i.put(p,fe.PLACEHOLDER))}return d.forEach(m=>{l.push(this.Ht.addToCollectionParentIndex(e,m))}),e.addOnCommittedListener(()=>{this.Jt[a]=u.keys()}),y.waitFor(l).next(()=>u)})}lookupMutationBatch(e,t){return ot(e).get(t).next(r=>r?(b(r.userId===this.userId),cn(this.N,r)):null)}Xt(e,t){return this.Jt[t]?y.resolve(this.Jt[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Jt[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return ot(e).Kt({index:P.userMutationsIndex,range:s},(o,a,u)=>{a.userId===this.userId&&(b(a.batchId>=r),i=cn(this.N,a)),u.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return ot(e).Kt({index:P.userMutationsIndex,range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ot(e).Lt(P.userMutationsIndex,t).next(r=>r.map(s=>cn(this.N,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=fe.prefixForPath(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return hn(e).Kt({range:s},(o,a,u)=>{const[c,l,d]=o,m=Ge(l);if(c===this.userId&&t.path.isEqual(m))return ot(e).get(d).next(p=>{if(!p)throw x();b(p.userId===this.userId),i.push(cn(this.N,p))});u.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new j(C);const s=[];return t.forEach(i=>{const o=fe.prefixForPath(this.userId,i.path),a=IDBKeyRange.lowerBound(o),u=hn(e).Kt({range:a},(c,l,d)=>{const[m,p,_]=c,S=Ge(p);m===this.userId&&i.path.isEqual(S)?r=r.add(_):d.done()});s.push(u)}),y.waitFor(s).next(()=>this.Zt(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=fe.prefixForPath(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new j(C);return hn(e).Kt({range:o},(u,c,l)=>{const[d,m,p]=u,_=Ge(m);d===this.userId&&r.isPrefixOf(_)?_.length===s&&(a=a.add(p)):l.done()}).next(()=>this.Zt(e,a))}Zt(e,t){const r=[],s=[];return t.forEach(i=>{s.push(ot(e).get(i).next(o=>{if(null===o)throw x();b(o.userId===this.userId),r.push(cn(this.N,o))}))}),y.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return Th(e.Qt,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.te(t.batchId)}),y.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}te(e){delete this.Jt[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return y.resolve();const r=IDBKeyRange.lowerBound(fe.prefixForUser(this.userId)),s=[];return hn(e).Kt({range:r},(i,o,a)=>{if(i[0]===this.userId){const u=Ge(i[1]);s.push(u)}else a.done()}).next(()=>{b(0===s.length)})})}containsKey(e,t){return Ih(e,this.userId,t)}ee(e){return Eh(e).get(this.userId).next(t=>t||new st(this.userId,-1,""))}}function Ih(n,e,t){const r=fe.prefixForPath(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return hn(n).Kt({range:i,qt:!0},(a,u,c)=>{const[l,d,m]=a;l===e&&d===s&&(o=!0),c.done()}).next(()=>o)}function ot(n){return Ie(n,P.store)}function hn(n){return Ie(n,fe.store)}function Eh(n){return Ie(n,st.store)}class Ct{constructor(e){this.ne=e}next(){return this.ne+=2,this.ne}static se(){return new Ct(0)}static ie(){return new Ct(-1)}}class Lm{constructor(e,t){this.referenceDelegate=e,this.N=t}allocateTargetId(e){return this.re(e).next(t=>{const r=new Ct(t.highestTargetId);return t.highestTargetId=r.next(),this.oe(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.re(e).next(t=>N.fromTimestamp(new ee(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.re(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.re(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.oe(e,s)))}addTargetData(e,t){return this.ce(e,t).next(()=>this.re(e).next(r=>(r.targetCount+=1,this.ae(t,r),this.oe(e,r))))}updateTargetData(e,t){return this.ce(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>ln(e).delete(t.targetId)).next(()=>this.re(e)).next(r=>(b(r.targetCount>0),r.targetCount-=1,this.oe(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return ln(e).Kt((o,a)=>{const u=cr(a);u.sequenceNumber<=t&&null===r.get(u.targetId)&&(s++,i.push(this.removeTargetData(e,u)))}).next(()=>y.waitFor(i)).next(()=>s)}forEachTarget(e,t){return ln(e).Kt((r,s)=>{const i=cr(s);t(i)})}re(e){return xh(e).get(Ae.key).next(t=>(b(null!==t),t))}oe(e,t){return xh(e).put(Ae.key,t)}ce(e,t){return ln(e).put(ph(this.N,t))}ae(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.re(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Wn(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return ln(e).Kt({range:s,index:Te.queryTargetsIndexName},(o,a,u)=>{const c=cr(a);ts(t,c.target)&&(i=c,u.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=at(e);return t.forEach(o=>{const a=Re(o.path);s.push(i.put(new he(r,a))),s.push(this.referenceDelegate.addReference(e,r,o))}),y.waitFor(s)}removeMatchingKeys(e,t,r){const s=at(e);return y.forEach(t,i=>{const o=Re(i.path);return y.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=at(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=at(e);let i=O();return s.Kt({range:r,qt:!0},(o,a,u)=>{const c=Ge(o[1]),l=new E(c);i=i.add(l)}).next(()=>i)}containsKey(e,t){const r=Re(t.path),s=IDBKeyRange.bound([r],[cc(r)],!1,!0);let i=0;return at(e).Kt({index:he.documentTargetsIndex,qt:!0,range:s},([o,a],u,c)=>{0!==o&&(i++,c.done())}).next(()=>i>0)}Tt(e,t){return ln(e).get(t).next(r=>r?cr(r):null)}}function ln(n){return Ie(n,Te.store)}function xh(n){return Ie(n,Ae.store)}function at(n){return Ie(n,he.store)}function kt(n){return no.apply(this,arguments)}function no(){return(no=(0,g.Z)(function*(n){if(n.code!==f.FAILED_PRECONDITION||n.message!==ch)throw n;w("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}function Sh([n,e],[t,r]){const s=C(n,t);return 0===s?C(e,r):s}class Mm{constructor(e){this.ue=e,this.buffer=new j(Sh),this.he=0}le(){return++this.he}fe(e){const t=[e,this.le()];if(this.buffer.size<this.ue)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Sh(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Fm{constructor(e,t){this.garbageCollector=e,this.asyncQueue=t,this.de=!1,this.we=null}start(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this._e(e)}stop(){this.we&&(this.we.cancel(),this.we=null)}get started(){return null!==this.we}_e(e){var t=this;const r=this.de?3e5:6e4;w("LruGarbageCollector",`Garbage collection scheduled in ${r}ms`),this.we=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",r,(0,g.Z)(function*(){t.we=null,t.de=!0;try{yield e.collectGarbage(t.garbageCollector)}catch(s){Nt(s)?w("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",s):yield kt(s)}yield t._e(e)}))}}class Om{constructor(e,t){this.me=e,this.params=t}calculateTargetCount(e,t){return this.me.ge(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return y.resolve(Se.T);const r=new Mm(t);return this.me.forEachTarget(e,s=>r.fe(s.sequenceNumber)).next(()=>this.me.ye(e,s=>r.fe(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.me.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.me.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(w("LruGarbageCollector","Garbage collection skipped; disabled"),y.resolve(_h)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(w("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),_h):this.pe(e,t))}getCacheSize(e){return this.me.getCacheSize(e)}pe(e,t){let r,s,i,o,a,u,c;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(d=>(d>this.params.maximumSequenceNumbersToCollect?(w("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),s=this.params.maximumSequenceNumbersToCollect):s=d,o=Date.now(),this.nthSequenceNumber(e,s))).next(d=>(r=d,a=Date.now(),this.removeTargets(e,r,t))).next(d=>(i=d,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(d=>(c=Date.now(),Ri()<=pt.in.DEBUG&&w("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-l}ms\n\tDetermined least recently used ${s} in `+(a-o)+`ms\n\tRemoved ${i} targets in `+(u-a)+`ms\n\tRemoved ${d} documents in `+(c-u)+`ms\nTotal Duration: ${c-l}ms`),y.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:d})))}}class Pm{constructor(e,t){this.db=e,this.garbageCollector=new Om(this,t)}ge(e){const t=this.Te(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}Te(e){let t=0;return this.ye(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}ye(e,t){return this.Ee(e,(r,s)=>t(s))}addReference(e,t,r){return gs(e,r)}removeReference(e,t,r){return gs(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return gs(e,t)}Ie(e,t){return function(r,s){let i=!1;return Eh(r).jt(o=>Ih(r,o,s).next(a=>(a&&(i=!0),y.resolve(!a)))).next(()=>i)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Ee(e,(o,a)=>{if(a<=t){const u=this.Ie(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o),at(e).delete([0,Re(o.path)])))});s.push(u)}}).next(()=>y.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return gs(e,t)}Ee(e,t){const r=at(e);let s,i=Se.T;return r.Kt({index:he.documentTargetsIndex},([o,a],{path:u,sequenceNumber:c})=>{0===o?(i!==Se.T&&t(new E(Ge(s)),i),i=c,s=u):i=Se.T}).next(()=>{i!==Se.T&&t(new E(Ge(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function gs(n,e){return at(n).put((r=n.currentSequenceNumber,new he(0,Re(e.path),r)));var r}class dn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[s,i]of r)if(this.equalsFn(s,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(void 0!==s){for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t])}else this.inner[r]=[[e,t]]}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return 1===r.length?delete this.inner[t]:r.splice(s,1),!0;return!1}forEach(e){It(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return lc(this.inner)}}class bh{constructor(){this.changes=new dn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}getReadTime(e){const t=this.changes.get(e);return t?t.readTime:N.min()}addEntry(e,t){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:t})}removeEntry(e,t=null){this.assertNotApplied(),this.changes.set(e,{document:V.newInvalidDocument(e),readTime:t})}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?y.resolve(r.document):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Um{constructor(e,t){this.N=e,this.Ht=t}addEntry(e,t,r){return ut(e).put(ps(t),r)}removeEntry(e,t){const r=ut(e),s=ps(t);return r.delete(s)}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Ae(e,r)))}getEntry(e,t){return ut(e).get(ps(t)).next(r=>this.Re(t,r))}be(e,t){return ut(e).get(ps(t)).next(r=>({document:this.Re(t,r),size:ms(r)}))}getEntries(e,t){let r=Ce();return this.Pe(e,t,(s,i)=>{const o=this.Re(s,i);r=r.insert(s,o)}).next(()=>r)}ve(e,t){let r=Ce(),s=new W(E.comparator);return this.Pe(e,t,(i,o)=>{const a=this.Re(i,o);r=r.insert(i,a),s=s.insert(i,ms(o))}).next(()=>({documents:r,Ve:s}))}Pe(e,t,r){if(t.isEmpty())return y.resolve();const s=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),i=t.getIterator();let o=i.getNext();return ut(e).Kt({range:s},(a,u,c)=>{const l=E.fromSegments(a);for(;o&&E.comparator(o,l)<0;)r(o,null),o=i.getNext();o&&o.isEqual(l)&&(r(o,u),o=i.hasNext()?i.getNext():null),o?c.Mt(o.path.toArray()):c.done()}).next(()=>{for(;o;)r(o,null),o=i.hasNext()?i.getNext():null})}getDocumentsMatchingQuery(e,t,r){let s=Ce();const i=t.path.length+1,o={};if(r.isEqual(N.min())){const a=t.path.toArray();o.range=IDBKeyRange.lowerBound(a)}else{const a=t.path.toArray(),u=Xi(r);o.range=IDBKeyRange.lowerBound([a,u],!0),o.index=Z.collectionReadTimeIndex}return ut(e).Kt(o,(a,u,c)=>{if(a.length!==i)return;const l=Yi(this.N,u);t.path.isPrefixOf(l.key.path)?Jn(t,l)&&(s=s.insert(l.key,l)):c.done()}).next(()=>s)}newChangeBuffer(e){return new qm(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Ah(e).get(Ue.key).next(t=>(b(!!t),t))}Ae(e,t){return Ah(e).put(Ue.key,t)}Re(e,t){if(t){const r=Yi(this.N,t);if(!r.isNoDocument()||!r.version.isEqual(N.min()))return r}return V.newInvalidDocument(e)}}class qm extends bh{constructor(e,t){super(),this.Se=e,this.trackRemovals=t,this.De=new dn(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new j((i,o)=>C(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.De.get(i);if(o.document.isValidDocument()){const u=mh(this.Se.N,o.document,this.getReadTime(i));s=s.add(i.path.popLast()),r+=ms(u)-a,t.push(this.Se.addEntry(e,i,u))}else if(r-=a,this.trackRemovals){const u=mh(this.Se.N,V.newNoDocument(i,N.min()),this.getReadTime(i));t.push(this.Se.addEntry(e,i,u))}else t.push(this.Se.removeEntry(e,i))}),s.forEach(i=>{t.push(this.Se.Ht.addToCollectionParentIndex(e,i))}),t.push(this.Se.updateMetadata(e,r)),y.waitFor(t)}getFromCache(e,t){return this.Se.be(e,t).next(r=>(this.De.set(t,r.size),r.document))}getAllFromCache(e,t){return this.Se.ve(e,t).next(({documents:r,Ve:s})=>(s.forEach((i,o)=>{this.De.set(i,o)}),r))}}function Ah(n){return Ie(n,Ue.store)}function ut(n){return Ie(n,Z.store)}function ps(n){return n.path.toArray()}class Vm{constructor(e){this.N=e}Ct(e,t,r,s){b(r<s&&r>=0&&s<=11);const i=new fs("createOrUpgrade",t);var a;r<1&&s>=1&&(e.createObjectStore(be.store),(a=e).createObjectStore(st.store,{keyPath:st.keyPath}),a.createObjectStore(P.store,{keyPath:P.keyPath,autoIncrement:!0}).createIndex(P.userMutationsIndex,P.userMutationsKeyPath,{unique:!0}),a.createObjectStore(fe.store),Nh(e),function(a){a.createObjectStore(Z.store)}(e));let o=y.resolve();return r<3&&s>=3&&(0!==r&&(function(a){a.deleteObjectStore(he.store),a.deleteObjectStore(Te.store),a.deleteObjectStore(Ae.store)}(e),Nh(e)),o=o.next(()=>function(a){const u=a.store(Ae.store),c=new Ae(0,0,N.min().toTimestamp(),0);return u.put(Ae.key,c)}(i))),r<4&&s>=4&&(0!==r&&(o=o.next(()=>function(a,u){return u.store(P.store).Lt().next(c=>{a.deleteObjectStore(P.store),a.createObjectStore(P.store,{keyPath:P.keyPath,autoIncrement:!0}).createIndex(P.userMutationsIndex,P.userMutationsKeyPath,{unique:!0});const l=u.store(P.store),d=c.map(m=>l.put(m));return y.waitFor(d)})}(e,i))),o=o.next(()=>{!function(a){a.createObjectStore(ze.store,{keyPath:ze.keyPath})}(e)})),r<5&&s>=5&&(o=o.next(()=>this.Ce(i))),r<6&&s>=6&&(o=o.next(()=>(function(a){a.createObjectStore(Ue.store)}(e),this.Ne(i)))),r<7&&s>=7&&(o=o.next(()=>this.xe(i))),r<8&&s>=8&&(o=o.next(()=>this.ke(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")})(e),function(a){const u=a.objectStore(Z.store);u.createIndex(Z.readTimeIndex,Z.readTimeIndexPath,{unique:!1}),u.createIndex(Z.collectionReadTimeIndex,Z.collectionReadTimeIndexPath,{unique:!1})}(t)})),r<10&&s>=10&&(o=o.next(()=>this.$e(i))),r<11&&s>=11&&(o=o.next(()=>{(function(a){a.createObjectStore(sn.store,{keyPath:sn.keyPath})})(e),function(a){a.createObjectStore(on.store,{keyPath:on.keyPath})}(e)})),o}Ne(e){let t=0;return e.store(Z.store).Kt((r,s)=>{t+=ms(s)}).next(()=>{const r=new Ue(t);return e.store(Ue.store).put(Ue.key,r)})}Ce(e){const t=e.store(st.store),r=e.store(P.store);return t.Lt().next(s=>y.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.Lt(P.userMutationsIndex,o).next(a=>y.forEach(a,u=>{b(u.userId===i.userId);const c=cn(this.N,u);return Th(e,i.userId,c).next(()=>{})}))}))}xe(e){const t=e.store(he.store),r=e.store(Z.store);return e.store(Ae.store).get(Ae.key).next(s=>{const i=[];return r.Kt((o,a)=>{const u=new F(o),c=[0,Re(u)];i.push(t.get(c).next(l=>l?y.resolve():t.put(new he(0,Re(u),s.highestListenSequenceNumber))))}).next(()=>y.waitFor(i))})}ke(e,t){e.createObjectStore(At.store,{keyPath:At.keyPath});const r=t.store(At.store),s=new eo,i=o=>{if(s.add(o)){const a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:Re(u)})}};return t.store(Z.store).Kt({qt:!0},(o,a)=>{const u=new F(o);return i(u.popLast())}).next(()=>t.store(fe.store).Kt({qt:!0},([o,a,u],c)=>{const l=Ge(a);return i(l.popLast())}))}$e(e){const t=e.store(Te.store);return t.Kt((r,s)=>{const i=cr(s),o=ph(this.N,i);return t.put(o)})}}function Nh(n){n.createObjectStore(he.store,{keyPath:he.keyPath}).createIndex(he.documentTargetsIndex,he.documentTargetsKeyPath,{unique:!0}),n.createObjectStore(Te.store,{keyPath:Te.keyPath}).createIndex(Te.queryTargetsIndexName,Te.queryTargetsKeyPath,{unique:!0}),n.createObjectStore(Ae.store)}const ro="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class so{constructor(e,t,r,s,i,o,a,u,c,l){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Oe=i,this.window=o,this.document=a,this.Fe=c,this.Me=l,this.Le=null,this.Be=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ue=null,this.inForeground=!1,this.qe=null,this.Ke=null,this.je=Number.NEGATIVE_INFINITY,this.Qe=d=>Promise.resolve(),!so.bt())throw new v(f.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Pm(this,s),this.We=t+"main",this.N=new fh(u),this.Ge=new Le(this.We,11,new Vm(this.N)),this.ze=new Lm(this.referenceDelegate,this.N),this.Ht=new Rm,this.He=new Um(this.N,this.Ht),this.Je=new Cm,this.window&&this.window.localStorage?this.Ye=this.window.localStorage:(this.Ye=null,!1===l&&G("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Xe().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new v(f.FAILED_PRECONDITION,ro);return this.Ze(),this.tn(),this.en(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.ze.getHighestSequenceNumber(e))}).then(e=>{this.Le=new Se(e,this.Fe)}).then(()=>{this.Be=!0}).catch(e=>(this.Ge&&this.Ge.close(),Promise.reject(e)))}nn(e){var t=this;return this.Qe=function(){var r=(0,g.Z)(function*(s){if(t.started)return e(s)});return function(s){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ge.xt(function(){var t=(0,g.Z)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Oe.enqueueAndForget((0,g.Z)(function*(){t.started&&(yield t.Xe())})))}Xe(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>ys(e).put(new ze(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.sn(e).next(t=>{t||(this.isPrimary=!1,this.Oe.enqueueRetryable(()=>this.Qe(!1)))})}).next(()=>this.rn(e)).next(t=>this.isPrimary&&!t?this.on(e).next(()=>!1):!!t&&this.cn(e).next(()=>!0))).catch(e=>{if(Nt(e))return w("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return w("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Oe.enqueueRetryable(()=>this.Qe(e)),this.isPrimary=e})}sn(e){return hr(e).get(be.key).next(t=>y.resolve(this.an(t)))}un(e){return ys(e).delete(this.clientId)}hn(){var e=this;return(0,g.Z)(function*(){if(e.isPrimary&&!e.ln(e.je,18e5)){e.je=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const s=Ie(r,ze.store);return s.Lt().next(i=>{const o=e.fn(i,18e5),a=i.filter(u=>-1===o.indexOf(u));return y.forEach(a,u=>s.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(e.Ye)for(const r of t)e.Ye.removeItem(e.dn(r.clientId))}})()}en(){this.Ke=this.Oe.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Xe().then(()=>this.hn()).then(()=>this.en()))}an(e){return!!e&&e.ownerId===this.clientId}rn(e){return this.Me?y.resolve(!0):hr(e).get(be.key).next(t=>{if(null!==t&&this.ln(t.leaseTimestampMs,5e3)&&!this.wn(t.ownerId)){if(this.an(t)&&this.networkEnabled)return!0;if(!this.an(t)){if(!t.allowTabSynchronization)throw new v(f.FAILED_PRECONDITION,ro);return!1}}return!(!this.networkEnabled||!this.inForeground)||ys(e).Lt().next(r=>void 0===this.fn(r,5e3).find(s=>{if(this.clientId!==s.clientId){const o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(!this.networkEnabled&&s.networkEnabled||o&&a)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&w("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,g.Z)(function*(){e.Be=!1,e._n(),e.Ke&&(e.Ke.cancel(),e.Ke=null),e.mn(),e.gn(),yield e.Ge.runTransaction("shutdown","readwrite",[be.store,ze.store],t=>{const r=new dh(t,Se.T);return e.on(r).next(()=>e.un(r))}),e.Ge.close(),e.yn()})()}fn(e,t){return e.filter(r=>this.ln(r.updateTimeMs,t)&&!this.wn(r.clientId))}pn(){return this.runTransaction("getActiveClients","readonly",e=>ys(e).Lt().next(t=>this.fn(t,18e5).map(r=>r.clientId)))}get started(){return this.Be}getMutationQueue(e){return to.Yt(e,this.N,this.Ht,this.referenceDelegate)}getTargetCache(){return this.ze}getRemoteDocumentCache(){return this.He}getIndexManager(){return this.Ht}getBundleCache(){return this.Je}runTransaction(e,t,r){let i;return w("IndexedDbPersistence","Starting transaction:",e),this.Ge.runTransaction(e,"readonly"===t?"readonly":"readwrite",Am,o=>(i=new dh(o,this.Le?this.Le.next():Se.T),"readwrite-primary"===t?this.sn(i).next(a=>!!a||this.rn(i)).next(a=>{if(!a)throw G(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Oe.enqueueRetryable(()=>this.Qe(!1)),new v(f.FAILED_PRECONDITION,ch);return r(i)}).next(a=>this.cn(i).next(()=>a)):this.Tn(i).next(()=>r(i)))).then(o=>(i.raiseOnCommittedEvent(),o))}Tn(e){return hr(e).get(be.key).next(t=>{if(null!==t&&this.ln(t.leaseTimestampMs,5e3)&&!this.wn(t.ownerId)&&!this.an(t)&&!(this.Me||this.allowTabSynchronization&&t.allowTabSynchronization))throw new v(f.FAILED_PRECONDITION,ro)})}cn(e){const t=new be(this.clientId,this.allowTabSynchronization,Date.now());return hr(e).put(be.key,t)}static bt(){return Le.bt()}on(e){const t=hr(e);return t.get(be.key).next(r=>this.an(r)?(w("IndexedDbPersistence","Releasing primary lease."),t.delete(be.key)):y.resolve())}ln(e,t){const r=Date.now();return!(e<r-t||e>r&&(G(`Detected an update time that is in the future: ${e} > ${r}`),1))}Ze(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.qe=()=>{this.Oe.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Xe()))},this.document.addEventListener("visibilitychange",this.qe),this.inForeground="visible"===this.document.visibilityState)}mn(){this.qe&&(this.document.removeEventListener("visibilitychange",this.qe),this.qe=null)}tn(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Ue=()=>{this._n(),(0,M.G6)()&&navigator.appVersion.match("Version/14")&&this.Oe.enterRestrictedMode(!0),this.Oe.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ue))}gn(){this.Ue&&(this.window.removeEventListener("pagehide",this.Ue),this.Ue=null)}wn(e){var t;try{const r=null!==(null===(t=this.Ye)||void 0===t?void 0:t.getItem(this.dn(e)));return w("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return G("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}_n(){if(this.Ye)try{this.Ye.setItem(this.dn(this.clientId),String(Date.now()))}catch(e){G("Failed to set zombie client id.",e)}}yn(){if(this.Ye)try{this.Ye.removeItem(this.dn(this.clientId))}catch(e){}}dn(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function hr(n){return Ie(n,be.store)}function ys(n){return Ie(n,ze.store)}function io(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class Bm{constructor(e,t){this.progress=e,this.En=t}}class Dh{constructor(e,t,r){this.He=e,this.In=t,this.Ht=r}An(e,t){return this.In.getAllMutationBatchesAffectingDocumentKey(e,t).next(r=>this.Rn(e,t,r))}Rn(e,t,r){return this.He.getEntry(e,t).next(s=>{for(const i of r)i.applyToLocalView(s);return s})}bn(e,t){e.forEach((r,s)=>{for(const i of t)i.applyToLocalView(s)})}Pn(e,t){return this.He.getEntries(e,t).next(r=>this.vn(e,r).next(()=>r))}vn(e,t){return this.In.getAllMutationBatchesAffectingDocumentKeys(e,t).next(r=>this.bn(t,r))}getDocumentsMatchingQuery(e,t,r){return E.isDocumentKey((s=t).path)&&null===s.collectionGroup&&0===s.filters.length?this.Vn(e,t.path):Bi(t)?this.Sn(e,t,r):this.Dn(e,t,r);var s}Vn(e,t){return this.An(e,new E(t)).next(r=>{let s=$i();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}Sn(e,t,r){const s=t.collectionGroup;let i=$i();return this.Ht.getCollectionParents(e,s).next(o=>y.forEach(o,a=>{const u=(c=t,l=a.child(s),new $e(l,null,c.explicitOrderBy.slice(),c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt));var c,l;return this.Dn(e,u,r).next(c=>{c.forEach((l,d)=>{i=i.insert(l,d)})})}).next(()=>i))}Dn(e,t,r){let s,i;return this.He.getDocumentsMatchingQuery(e,t,r).next(o=>(s=o,this.In.getAllMutationBatchesAffectingQuery(e,t))).next(o=>(i=o,this.Cn(e,i,s).next(a=>{s=a;for(const u of i)for(const c of u.mutations){const l=c.key;let d=s.get(l);null==d&&(d=V.newInvalidDocument(l),s=s.insert(l,d)),Zi(c,d,u.localWriteTime),d.isFoundDocument()||(s=s.remove(l))}}))).next(()=>(s.forEach((o,a)=>{Jn(t,a)||(s=s.remove(o))}),s))}Cn(e,t,r){let s=O();for(const o of t)for(const a of o.mutations)a instanceof rt&&null===r.get(a.key)&&(s=s.add(a.key));let i=r;return this.He.getEntries(e,s).next(o=>(o.forEach((a,u)=>{u.isFoundDocument()&&(i=i.insert(a,u))}),i))}}class oo{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Nn=r,this.xn=s}static kn(e,t){let r=O(),s=O();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new oo(e,t.fromCache,r,s)}}class Ch{$n(e){this.On=e}getDocumentsMatchingQuery(e,t,r,s){return 0===(i=t).filters.length&&null===i.limit&&null==i.startAt&&null==i.endAt&&(0===i.explicitOrderBy.length||1===i.explicitOrderBy.length&&i.explicitOrderBy[0].field.isKeyField())||r.isEqual(N.min())?this.Fn(e,t):this.On.Pn(e,s).next(i=>{const o=this.Mn(t,i);return(ss(t)||is(t))&&this.Ln(t.limitType,o,s,r)?this.Fn(e,t):(Ri()<=pt.in.DEBUG&&w("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),ji(t)),this.On.getDocumentsMatchingQuery(e,t,r).next(a=>(o.forEach(u=>{a=a.insert(u.key,u)}),a)))});var i}Mn(e,t){let r=new j(Sc(e));return t.forEach((s,i)=>{Jn(e,i)&&(r=r.add(i))}),r}Ln(e,t,r,s){if(r.size!==t.size)return!0;const i="F"===e?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Fn(e,t){return Ri()<=pt.in.DEBUG&&w("QueryEngine","Using full collection scan to execute query:",ji(t)),this.On.getDocumentsMatchingQuery(e,t,N.min())}}class jm{constructor(e,t,r,s){this.persistence=e,this.Bn=t,this.N=s,this.Un=new W(C),this.qn=new dn(i=>Wn(i),ts),this.Kn=N.min(),this.In=e.getMutationQueue(r),this.jn=e.getRemoteDocumentCache(),this.ze=e.getTargetCache(),this.Qn=new Dh(this.jn,this.In,this.persistence.getIndexManager()),this.Je=e.getBundleCache(),this.Bn.$n(this.Qn)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Un))}}function kh(n,e,t,r){return new jm(n,e,t,r)}function Rh(n,e){return ao.apply(this,arguments)}function ao(){return(ao=(0,g.Z)(function*(n,e){const t=T(n);let r=t.In,s=t.Qn;const i=yield t.persistence.runTransaction("Handle user change","readonly",o=>{let a;return t.In.getAllMutationBatches(o).next(u=>(a=u,r=t.persistence.getMutationQueue(e),s=new Dh(t.jn,r,t.persistence.getIndexManager()),r.getAllMutationBatches(o))).next(u=>{const c=[],l=[];let d=O();for(const m of a){c.push(m.batchId);for(const p of m.mutations)d=d.add(p.key)}for(const m of u){l.push(m.batchId);for(const p of m.mutations)d=d.add(p.key)}return s.Pn(o,d).next(m=>({Wn:m,removedBatchIds:c,addedBatchIds:l}))})});return t.In=r,t.Qn=s,t.Bn.$n(t.Qn),i})).apply(this,arguments)}function Zm(n,e){const t=T(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.jn.newChangeBuffer({trackRemovals:!0});return function(o,a,u,c){const l=u.batch,d=l.keys();let m=y.resolve();return d.forEach(p=>{m=m.next(()=>c.getEntry(a,p)).next(_=>{const S=u.docVersions.get(p);b(null!==S),_.version.compareTo(S)<0&&(l.applyToRemoteDocument(_,u),_.isValidDocument()&&c.addEntry(_,u.commitVersion))})}),m.next(()=>o.In.removeMutationBatch(a,l))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.In.performConsistencyCheck(r)).next(()=>t.Qn.Pn(r,s))})}function Lh(n){const e=T(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.ze.getLastRemoteSnapshotVersion(t))}function Km(n,e){const t=T(n),r=e.snapshotVersion;let s=t.Un;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.jn.newChangeBuffer({trackRemovals:!0});s=t.Un;const a=[];e.targetChanges.forEach((c,l)=>{const d=s.get(l);if(!d)return;a.push(t.ze.removeMatchingKeys(i,c.removedDocuments,l).next(()=>t.ze.addMatchingKeys(i,c.addedDocuments,l)));const m=c.resumeToken;if(m.approximateByteSize()>0){const p=d.withResumeToken(m,r).withSequenceNumber(i.currentSequenceNumber);s=s.insert(l,p),_=d,D=c,b((S=p).resumeToken.approximateByteSize()>0),(0===_.resumeToken.approximateByteSize()||S.snapshotVersion.toMicroseconds()-_.snapshotVersion.toMicroseconds()>=3e8||D.addedDocuments.size+D.modifiedDocuments.size+D.removedDocuments.size>0)&&a.push(t.ze.updateTargetData(i,p))}var _,S,D});let u=Ce();if(e.documentUpdates.forEach((c,l)=>{e.resolvedLimboDocuments.has(c)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,c))}),a.push(Mh(i,o,e.documentUpdates,r,void 0).next(c=>{u=c})),!r.isEqual(N.min())){const c=t.ze.getLastRemoteSnapshotVersion(i).next(l=>t.ze.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(c)}return y.waitFor(a).next(()=>o.apply(i)).next(()=>t.Qn.vn(i,u)).next(()=>u)}).then(i=>(t.Un=s,i))}function Mh(n,e,t,r,s){let i=O();return t.forEach(o=>i=i.add(o)),e.getEntries(n,i).next(o=>{let a=Ce();return t.forEach((u,c)=>{const l=o.get(u),d=(null==s?void 0:s.get(u))||r;c.isNoDocument()&&c.version.isEqual(N.min())?(e.removeEntry(u,d),a=a.insert(u,c)):!l.isValidDocument()||c.version.compareTo(l.version)>0||0===c.version.compareTo(l.version)&&l.hasPendingWrites?(e.addEntry(c,d),a=a.insert(u,c)):w("LocalStore","Ignoring outdated watch update for ",u,". Current version:",l.version," Watch version:",c.version)}),a})}function $m(n,e){const t=T(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.In.getNextMutationBatchAfterBatchId(r,e)))}function fn(n,e){const t=T(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.ze.getTargetData(r,e).next(i=>i?(s=i,y.resolve(s)):t.ze.allocateTargetId(r).next(o=>(s=new it(e,o,0,r.currentSequenceNumber),t.ze.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.Un.get(r.targetId);return(null===s||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Un=t.Un.insert(r.targetId,r),t.qn.set(e,r.targetId)),r})}function mn(n,e,t){return uo.apply(this,arguments)}function uo(){return(uo=(0,g.Z)(function*(n,e,t){const r=T(n),s=r.Un.get(e),i=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s)))}catch(o){if(!Nt(o))throw o;w("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.Un=r.Un.remove(e),r.qn.delete(s.target)})).apply(this,arguments)}function vs(n,e,t){const r=T(n);let s=N.min(),i=O();return r.persistence.runTransaction("Execute query","readonly",o=>function(a,u,c){const l=T(a),d=l.qn.get(c);return void 0!==d?y.resolve(l.Un.get(d)):l.ze.getTargetData(u,c)}(r,o,De(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.ze.getMatchingKeysForTargetId(o,a.targetId).next(u=>{i=u})}).next(()=>r.Bn.getDocumentsMatchingQuery(o,e,t?s:N.min(),t?i:O())).next(a=>({documents:a,Gn:i})))}function Fh(n,e){const t=T(n),r=T(t.ze),s=t.Un.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.Tt(i,e).next(o=>o?o.target:null))}function Oh(n){const e=T(n);return e.persistence.runTransaction("Get new document changes","readonly",t=>function(r,s,i){const o=T(r);let a=Ce(),u=Xi(i);const c=ut(s),l=IDBKeyRange.lowerBound(u,!0);return c.Kt({index:Z.readTimeIndex,range:l},(d,m)=>{const p=Yi(o.N,m);a=a.insert(p.key,p),u=m.readTime}).next(()=>({En:a,readTime:gh(u)}))}(e.jn,t,e.Kn)).then(({En:t,readTime:r})=>(e.Kn=r,t))}function co(){return(co=(0,g.Z)(function*(n){const e=T(n);return e.persistence.runTransaction("Synchronize last document change read time","readonly",t=>function(r){const s=ut(r);let i=N.min();return s.Kt({index:Z.readTimeIndex,reverse:!0},(o,a,u)=>{a.readTime&&(i=gh(a.readTime)),u.done()}).next(()=>i)}(t)).then(t=>{e.Kn=t})})).apply(this,arguments)}function ho(){return(ho=(0,g.Z)(function*(n,e,t,r){const s=T(n);let i=O(),o=Ce(),a=jc();for(const l of t){const d=e.zn(l.metadata.name);l.document&&(i=i.add(d)),o=o.insert(d,e.Hn(l)),a=a.insert(d,e.Jn(l.metadata.readTime))}const u=s.jn.newChangeBuffer({trackRemovals:!0}),c=yield fn(s,(l=r,De(Xt(F.fromString(`__bundle__/docs/${l}`)))));var l;return s.persistence.runTransaction("Apply bundle documents","readwrite",l=>Mh(l,u,o,N.min(),a).next(d=>(u.apply(l),d)).next(d=>s.ze.removeMatchingKeysForTargetId(l,c.targetId).next(()=>s.ze.addMatchingKeys(l,i,c.targetId)).next(()=>s.Qn.vn(l,d)).next(()=>d)))})).apply(this,arguments)}function Hm(n,e){return lo.apply(this,arguments)}function lo(){return(lo=(0,g.Z)(function*(n,e,t=O()){const r=yield fn(n,De(Ji(e.bundledQuery))),s=T(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=ne(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Je.saveNamedQuery(i,e);const a=r.withResumeToken(te.EMPTY_BYTE_STRING,o);return s.Un=s.Un.insert(a.targetId,a),s.ze.updateTargetData(i,a).next(()=>s.ze.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.ze.addMatchingKeys(i,t,r.targetId)).next(()=>s.Je.saveNamedQuery(i,e))})})).apply(this,arguments)}class Qm{constructor(e){this.N=e,this.Yn=new Map,this.Xn=new Map}getBundleMetadata(e,t){return y.resolve(this.Yn.get(t))}saveBundleMetadata(e,t){var r;return this.Yn.set(t.id,{id:(r=t).id,version:r.version,createTime:ne(r.createTime)}),y.resolve()}getNamedQuery(e,t){return y.resolve(this.Xn.get(t))}saveNamedQuery(e,t){return this.Xn.set(t.name,{name:(r=t).name,query:Ji(r.bundledQuery),readTime:ne(r.readTime)}),y.resolve();var r}}class fo{constructor(){this.Zn=new j(re.ts),this.es=new j(re.ns)}isEmpty(){return this.Zn.isEmpty()}addReference(e,t){const r=new re(e,t);this.Zn=this.Zn.add(r),this.es=this.es.add(r)}ss(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.rs(new re(e,t))}os(e,t){e.forEach(r=>this.removeReference(r,t))}cs(e){const t=new E(new F([])),r=new re(t,e),s=new re(t,e+1),i=[];return this.es.forEachInRange([r,s],o=>{this.rs(o),i.push(o.key)}),i}us(){this.Zn.forEach(e=>this.rs(e))}rs(e){this.Zn=this.Zn.delete(e),this.es=this.es.delete(e)}hs(e){const t=new E(new F([])),r=new re(t,e),s=new re(t,e+1);let i=O();return this.es.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new re(e,0),r=this.Zn.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class re{constructor(e,t){this.key=e,this.ls=t}static ts(e,t){return E.comparator(e.key,t.key)||C(e.ls,t.ls)}static ns(e,t){return C(e.ls,t.ls)||E.comparator(e.key,t.key)}}class Wm{constructor(e,t){this.Ht=e,this.referenceDelegate=t,this.In=[],this.fs=1,this.ds=new j(re.ts)}checkEmpty(e){return y.resolve(0===this.In.length)}addMutationBatch(e,t,r,s){const i=this.fs;this.fs++;const o=new Qi(i,t,r,s);this.In.push(o);for(const a of s)this.ds=this.ds.add(new re(a.key,i)),this.Ht.addToCollectionParentIndex(e,a.key.path.popLast());return y.resolve(o)}lookupMutationBatch(e,t){return y.resolve(this.ws(t))}getNextMutationBatchAfterBatchId(e,t){const s=this._s(t+1),i=s<0?0:s;return y.resolve(this.In.length>i?this.In[i]:null)}getHighestUnacknowledgedBatchId(){return y.resolve(0===this.In.length?-1:this.fs-1)}getAllMutationBatches(e){return y.resolve(this.In.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new re(t,0),s=new re(t,Number.POSITIVE_INFINITY),i=[];return this.ds.forEachInRange([r,s],o=>{const a=this.ws(o.ls);i.push(a)}),y.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new j(C);return t.forEach(s=>{const i=new re(s,0),o=new re(s,Number.POSITIVE_INFINITY);this.ds.forEachInRange([i,o],a=>{r=r.add(a.ls)})}),y.resolve(this.gs(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;E.isDocumentKey(i)||(i=i.child(""));const o=new re(new E(i),0);let a=new j(C);return this.ds.forEachWhile(u=>{const c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(u.ls)),!0)},o),y.resolve(this.gs(a))}gs(e){const t=[];return e.forEach(r=>{const s=this.ws(r);null!==s&&t.push(s)}),t}removeMutationBatch(e,t){b(0===this.ys(t.batchId,"removed")),this.In.shift();let r=this.ds;return y.forEach(t.mutations,s=>{const i=new re(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.ds=r})}te(e){}containsKey(e,t){const r=new re(t,0),s=this.ds.firstAfterOrEqual(r);return y.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return y.resolve()}ys(e,t){return this._s(e)}_s(e){return 0===this.In.length?0:e-this.In[0].batchId}ws(e){const t=this._s(e);return t<0||t>=this.In.length?null:this.In[t]}}class Ym{constructor(e,t){this.Ht=e,this.ps=t,this.docs=new W(E.comparator),this.size=0}addEntry(e,t,r){const s=t.key,i=this.docs.get(s),o=i?i.size:0,a=this.ps(t);return this.docs=this.docs.insert(s,{document:t.clone(),size:a,readTime:r}),this.size+=a-o,this.Ht.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return y.resolve(r?r.document.clone():V.newInvalidDocument(t))}getEntries(e,t){let r=Ce();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.clone():V.newInvalidDocument(s))}),y.resolve(r)}getDocumentsMatchingQuery(e,t,r){let s=Ce();const i=new E(t.path.child("")),o=this.docs.getIteratorFrom(i);for(;o.hasNext();){const{key:a,value:{document:u,readTime:c}}=o.getNext();if(!t.path.isPrefixOf(a.path))break;c.compareTo(r)<=0||Jn(t,u)&&(s=s.insert(u.key,u.clone()))}return y.resolve(s)}Ts(e,t){return y.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Xm(this)}getSize(e){return y.resolve(this.size)}}class Xm extends bh{constructor(e){super(),this.Se=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.document.isValidDocument()?t.push(this.Se.addEntry(e,s.document,this.getReadTime(r))):this.Se.removeEntry(r)}),y.waitFor(t)}getFromCache(e,t){return this.Se.getEntry(e,t)}getAllFromCache(e,t){return this.Se.getEntries(e,t)}}class Jm{constructor(e){this.persistence=e,this.Es=new dn(t=>Wn(t),ts),this.lastRemoteSnapshotVersion=N.min(),this.highestTargetId=0,this.Is=0,this.As=new fo,this.targetCount=0,this.Rs=Ct.se()}forEachTarget(e,t){return this.Es.forEach((r,s)=>t(s)),y.resolve()}getLastRemoteSnapshotVersion(e){return y.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return y.resolve(this.Is)}allocateTargetId(e){return this.highestTargetId=this.Rs.next(),y.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Is&&(this.Is=t),y.resolve()}ce(e){this.Es.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Rs=new Ct(t),this.highestTargetId=t),e.sequenceNumber>this.Is&&(this.Is=e.sequenceNumber)}addTargetData(e,t){return this.ce(t),this.targetCount+=1,y.resolve()}updateTargetData(e,t){return this.ce(t),y.resolve()}removeTargetData(e,t){return this.Es.delete(t.target),this.As.cs(t.targetId),this.targetCount-=1,y.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Es.forEach((o,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.Es.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),y.waitFor(i).next(()=>s)}getTargetCount(e){return y.resolve(this.targetCount)}getTargetData(e,t){const r=this.Es.get(t)||null;return y.resolve(r)}addMatchingKeys(e,t,r){return this.As.ss(t,r),y.resolve()}removeMatchingKeys(e,t,r){this.As.os(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),y.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.As.cs(t),y.resolve()}getMatchingKeysForTargetId(e,t){const r=this.As.hs(t);return y.resolve(r)}containsKey(e,t){return y.resolve(this.As.containsKey(t))}}class eg{constructor(e,t){this.bs={},this.Le=new Se(0),this.Be=!1,this.Be=!0,this.referenceDelegate=e(this),this.ze=new Jm(this),this.Ht=new km,this.He=new Ym(this.Ht,r=>this.referenceDelegate.Ps(r)),this.N=new fh(t),this.Je=new Qm(this.N)}start(){return Promise.resolve()}shutdown(){return this.Be=!1,Promise.resolve()}get started(){return this.Be}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Ht}getMutationQueue(e){let t=this.bs[e.toKey()];return t||(t=new Wm(this.Ht,this.referenceDelegate),this.bs[e.toKey()]=t),t}getTargetCache(){return this.ze}getRemoteDocumentCache(){return this.He}getBundleCache(){return this.Je}runTransaction(e,t,r){w("MemoryPersistence","Starting transaction:",e);const s=new tg(this.Le.next());return this.referenceDelegate.vs(),r(s).next(i=>this.referenceDelegate.Vs(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ss(e,t){return y.or(Object.values(this.bs).map(r=>()=>r.containsKey(e,t)))}}class tg extends hh{constructor(e){super(),this.currentSequenceNumber=e}}class mo{constructor(e){this.persistence=e,this.Ds=new fo,this.Cs=null}static Ns(e){return new mo(e)}get xs(){if(this.Cs)return this.Cs;throw x()}addReference(e,t,r){return this.Ds.addReference(r,t),this.xs.delete(r.toString()),y.resolve()}removeReference(e,t,r){return this.Ds.removeReference(r,t),this.xs.add(r.toString()),y.resolve()}markPotentiallyOrphaned(e,t){return this.xs.add(t.toString()),y.resolve()}removeTarget(e,t){this.Ds.cs(t.targetId).forEach(s=>this.xs.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.xs.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}vs(){this.Cs=new Set}Vs(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return y.forEach(this.xs,r=>{const s=E.fromPath(r);return this.ks(e,s).next(i=>{i||t.removeEntry(s)})}).next(()=>(this.Cs=null,t.apply(e)))}updateLimboDocument(e,t){return this.ks(e,t).next(r=>{r?this.xs.delete(t.toString()):this.xs.add(t.toString())})}Ps(e){return 0}ks(e,t){return y.or([()=>y.resolve(this.Ds.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ss(e,t)])}}function Ph(n,e){return`firestore_clients_${n}_${e}`}function Uh(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function go(n,e){return`firestore_targets_${n}_${e}`}class ws{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static $s(e,t,r){const s=JSON.parse(r);let i,o="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error);return o&&s.error&&(o="string"==typeof s.error.message&&"string"==typeof s.error.code,o&&(i=new v(s.error.code,s.error.message))),o?new ws(e,t,s.state,i):(G("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Os(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class lr{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static $s(e,t){const r=JSON.parse(t);let s,i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code,i&&(s=new v(r.error.code,r.error.message))),i?new lr(e,r.state,s):(G("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Os(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class _s{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static $s(e,t){const r=JSON.parse(t);let s="object"==typeof r&&r.activeTargetIds instanceof Array,i=hs();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=fc(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new _s(e,i):(G("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class po{constructor(e,t){this.clientId=e,this.onlineState=t}static $s(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new po(t.clientId,t.onlineState):(G("SharedClientState",`Failed to parse online state: ${e}`),null)}}class yo{constructor(){this.activeTargetIds=hs()}Fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ms(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Os(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class vo{constructor(e,t,r,s,i){this.window=e,this.Oe=t,this.persistenceKey=r,this.Ls=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Bs=this.Us.bind(this),this.qs=new W(C),this.started=!1,this.Ks=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.js=Ph(this.persistenceKey,this.Ls),this.Qs=`firestore_sequence_number_${this.persistenceKey}`,this.qs=this.qs.insert(this.Ls,new yo),this.Ws=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Gs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.zs=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.Hs=`firestore_online_state_${this.persistenceKey}`,this.Js=function(a){return`firestore_bundle_loaded_${a}`}(this.persistenceKey),this.window.addEventListener("storage",this.Bs)}static bt(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,g.Z)(function*(){const t=yield e.syncEngine.pn();for(const s of t){if(s===e.Ls)continue;const i=e.getItem(Ph(e.persistenceKey,s));if(i){const o=_s.$s(s,i);o&&(e.qs=e.qs.insert(o.clientId,o))}}e.Ys();const r=e.storage.getItem(e.Hs);if(r){const s=e.Xs(r);s&&e.Zs(s)}for(const s of e.Ks)e.Us(s);e.Ks=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.Qs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ti(this.qs)}isActiveQueryTarget(e){let t=!1;return this.qs.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.ei(e,"pending")}updateMutationState(e,t,r){this.ei(e,t,r),this.ni(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(go(this.persistenceKey,e));if(r){const s=lr.$s(e,r);s&&(t=s.state)}}return this.si.Fs(e),this.Ys(),t}removeLocalQueryTarget(e){this.si.Ms(e),this.Ys()}isLocalQueryTarget(e){return this.si.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(go(this.persistenceKey,e))}updateQueryState(e,t,r){this.ii(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.ni(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.ri(e)}notifyBundleLoaded(){this.oi()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Bs),this.removeItem(this.js),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return w("SharedClientState","READ",e,t),t}setItem(e,t){w("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){w("SharedClientState","REMOVE",e),this.storage.removeItem(e)}Us(e){var t=this;const r=e;if(r.storageArea===this.storage){if(w("SharedClientState","EVENT",r.key,r.newValue),r.key===this.js)return void G("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Oe.enqueueRetryable((0,g.Z)(function*(){if(t.started){if(null!==r.key)if(t.Ws.test(r.key)){if(null==r.newValue){const s=t.ci(r.key);return t.ai(s,null)}{const s=t.ui(r.key,r.newValue);if(s)return t.ai(s.clientId,s)}}else if(t.Gs.test(r.key)){if(null!==r.newValue){const s=t.hi(r.key,r.newValue);if(s)return t.li(s)}}else if(t.zs.test(r.key)){if(null!==r.newValue){const s=t.fi(r.key,r.newValue);if(s)return t.di(s)}}else if(r.key===t.Hs){if(null!==r.newValue){const s=t.Xs(r.newValue);if(s)return t.Zs(s)}}else if(r.key===t.Qs){const s=function(i){let o=Se.T;if(null!=i)try{const a=JSON.parse(i);b("number"==typeof a),o=a}catch(a){G("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(r.newValue);s!==Se.T&&t.sequenceNumberHandler(s)}else if(r.key===t.Js)return t.syncEngine.wi()}else t.Ks.push(r)}))}}get si(){return this.qs.get(this.Ls)}Ys(){this.setItem(this.js,this.si.Os())}ei(e,t,r){const s=new ws(this.currentUser,e,t,r),i=Uh(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Os())}ni(e){const t=Uh(this.persistenceKey,this.currentUser,e);this.removeItem(t)}ri(e){this.storage.setItem(this.Hs,JSON.stringify({clientId:this.Ls,onlineState:e}))}ii(e,t,r){const s=go(this.persistenceKey,e),i=new lr(e,t,r);this.setItem(s,i.Os())}oi(){this.setItem(this.Js,"value-not-used")}ci(e){const t=this.Ws.exec(e);return t?t[1]:null}ui(e,t){const r=this.ci(e);return _s.$s(r,t)}hi(e,t){const r=this.Gs.exec(e),s=Number(r[1]);return ws.$s(new ae(void 0!==r[2]?r[2]:null),s,t)}fi(e,t){const r=this.zs.exec(e),s=Number(r[1]);return lr.$s(s,t)}Xs(e){return po.$s(e)}li(e){var t=this;return(0,g.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine._i(e.batchId,e.state,e.error);w("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}di(e){return this.syncEngine.mi(e.targetId,e.state,e.error)}ai(e,t){const r=t?this.qs.insert(e,t):this.qs.remove(e),s=this.ti(this.qs),i=this.ti(r),o=[],a=[];return i.forEach(u=>{s.has(u)||o.push(u)}),s.forEach(u=>{i.has(u)||a.push(u)}),this.syncEngine.gi(o,a).then(()=>{this.qs=r})}Zs(e){this.qs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ti(e){let t=hs();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class qh{constructor(){this.yi=new yo,this.pi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.yi.Fs(e),this.pi[e]||"not-current"}updateQueryState(e,t,r){this.pi[e]=t}removeLocalQueryTarget(e){this.yi.Ms(e)}isLocalQueryTarget(e){return this.yi.activeTargetIds.has(e)}clearQueryState(e){delete this.pi[e]}getAllActiveQueryTargets(){return this.yi.activeTargetIds}isActiveQueryTarget(e){return this.yi.activeTargetIds.has(e)}start(){return this.yi=new yo,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}class ng{Ti(e){}shutdown(){}}class Vh{constructor(){this.Ei=()=>this.Ii(),this.Ai=()=>this.Ri(),this.bi=[],this.Pi()}Ti(e){this.bi.push(e)}shutdown(){window.removeEventListener("online",this.Ei),window.removeEventListener("offline",this.Ai)}Pi(){window.addEventListener("online",this.Ei),window.addEventListener("offline",this.Ai)}Ii(){w("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.bi)e(0)}Ri(){w("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.bi)e(1)}static bt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const rg={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class sg{constructor(e){this.vi=e.vi,this.Vi=e.Vi}Si(e){this.Di=e}Ci(e){this.Ni=e}onMessage(e){this.xi=e}close(){this.Vi()}send(e){this.vi(e)}ki(){this.Di()}$i(e){this.Ni(e)}Oi(e){this.xi(e)}}class ig extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.Fi=(e.ssl?"https":"http")+"://"+e.host,this.Mi="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Li(e,t,r,s){const i=this.Bi(e,t);w("RestConnection","Sending: ",i,r);const o={};return this.Ui(o,s),this.qi(e,i,o,r).then(a=>(w("RestConnection","Received: ",a),a),a=>{throw $n("RestConnection",`${e} failed with error: `,a,"url: ",i,"request:",r),a})}Ki(e,t,r,s){return this.Li(e,t,r,s)}Ui(e,t){if(e["X-Goog-Api-Client"]="gl-js/ fire/"+Gt,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t)for(const r in t.authHeaders)t.authHeaders.hasOwnProperty(r)&&(e[r]=t.authHeaders[r])}Bi(e,t){return`${this.Fi}/v1/${t}:${rg[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}qi(e,t,r,s){return new Promise((i,o)=>{const a=new Af;a.listenOnce(xf.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case ki.NO_ERROR:const c=a.getResponseJson();w("Connection","XHR received:",JSON.stringify(c)),i(c);break;case ki.TIMEOUT:w("Connection",'RPC "'+e+'" timed out'),o(new v(f.DEADLINE_EXCEEDED,"Request time out"));break;case ki.HTTP_ERROR:const l=a.getStatus();if(w("Connection",'RPC "'+e+'" failed with status:',l,"response text:",a.getResponseText()),l>0){const d=a.getResponseJson().error;if(d&&d.status&&d.message){const m=function(p){const _=p.toLowerCase().replace(/_/g,"-");return Object.values(f).indexOf(_)>=0?_:f.UNKNOWN}(d.status);o(new v(m,d.message))}else o(new v(f.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new v(f.UNAVAILABLE,"Connection failed."));break;default:x()}}finally{w("Connection",'RPC "'+e+'" completed.')}});const u=JSON.stringify(s);a.send(t,"POST",u,r,15)})}ji(e,t){const r=[this.Fi,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=If(),i=Ef(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new bf({})),this.Ui(o.initMessageHeaders,t),(0,M.uI)()||(0,M.b$)()||(0,M.d)()||(0,M.w1)()||(0,M.Mn)()||(0,M.ru)()||(o.httpHeadersOverwriteParam="$httpHeaders");const a=r.join("");w("Connection","Creating WebChannel: "+a,o);const u=s.createWebChannel(a,o);let c=!1,l=!1;const d=new sg({vi:p=>{l?w("Connection","Not sending because WebChannel is closed:",p):(c||(w("Connection","Opening WebChannel transport."),u.open(),c=!0),w("Connection","WebChannel sending:",p),u.send(p))},Vi:()=>u.close()}),m=(p,_,S)=>{p.listen(_,D=>{try{S(D)}catch(K){setTimeout(()=>{throw K},0)}})};return m(u,Yr.EventType.OPEN,()=>{l||w("Connection","WebChannel transport opened.")}),m(u,Yr.EventType.CLOSE,()=>{l||(l=!0,w("Connection","WebChannel transport closed"),d.$i())}),m(u,Yr.EventType.ERROR,p=>{l||(l=!0,$n("Connection","WebChannel transport errored:",p),d.$i(new v(f.UNAVAILABLE,"The operation could not be completed")))}),m(u,Yr.EventType.MESSAGE,p=>{var _;if(!l){const S=p.data[0];b(!!S);const D=S,K=D.error||(null===(_=D[0])||void 0===_?void 0:_.error);if(K){w("Connection","WebChannel received error:",K);const Me=K.status;let Be=function(Xe){const Os=Q[Xe];if(void 0!==Os)return Vc(Os)}(Me),Ye=K.message;void 0===Be&&(Be=f.INTERNAL,Ye="Unknown error status: "+Me+" with message "+K.message),l=!0,d.$i(new v(Be,Ye)),u.close()}else w("Connection","WebChannel received:",S),d.Oi(S)}}),m(i,Sf.STAT_EVENT,p=>{p.stat===ic.PROXY?w("Connection","Detected buffering proxy"):p.stat===ic.NOPROXY&&w("Connection","Detected no buffering proxy")}),setTimeout(()=>{d.ki()},0),d}}function Bh(){return"undefined"!=typeof window?window:null}function Ts(){return"undefined"!=typeof document?document:null}function dr(n){return new dm(n,!0)}class wo{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Oe=e,this.timerId=t,this.Qi=r,this.Wi=s,this.Gi=i,this.zi=0,this.Hi=null,this.Ji=Date.now(),this.reset()}reset(){this.zi=0}Yi(){this.zi=this.Gi}Xi(e){this.cancel();const t=Math.floor(this.zi+this.Zi()),r=Math.max(0,Date.now()-this.Ji),s=Math.max(0,t-r);s>0&&w("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.zi} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Hi=this.Oe.enqueueAfterDelay(this.timerId,s,()=>(this.Ji=Date.now(),e())),this.zi*=this.Wi,this.zi<this.Qi&&(this.zi=this.Qi),this.zi>this.Gi&&(this.zi=this.Gi)}tr(){null!==this.Hi&&(this.Hi.skipDelay(),this.Hi=null)}cancel(){null!==this.Hi&&(this.Hi.cancel(),this.Hi=null)}Zi(){return(Math.random()-.5)*this.zi}}class jh{constructor(e,t,r,s,i,o,a){this.Oe=e,this.er=r,this.nr=s,this.sr=i,this.credentialsProvider=o,this.listener=a,this.state=0,this.ir=0,this.rr=null,this.cr=null,this.stream=null,this.ar=new wo(e,t)}ur(){return 1===this.state||5===this.state||this.hr()}hr(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.lr()}stop(){var e=this;return(0,g.Z)(function*(){e.ur()&&(yield e.close(0))})()}dr(){this.state=0,this.ar.reset()}wr(){this.hr()&&null===this.rr&&(this.rr=this.Oe.enqueueAfterDelay(this.er,6e4,()=>this._r()))}mr(e){this.gr(),this.stream.send(e)}_r(){var e=this;return(0,g.Z)(function*(){if(e.hr())return e.close(0)})()}gr(){this.rr&&(this.rr.cancel(),this.rr=null)}yr(){this.cr&&(this.cr.cancel(),this.cr=null)}close(e,t){var r=this;return(0,g.Z)(function*(){r.gr(),r.yr(),r.ar.cancel(),r.ir++,4!==e?r.ar.reset():t&&t.code===f.RESOURCE_EXHAUSTED?(G(t.toString()),G("Using maximum backoff delay to prevent overloading the backend."),r.ar.Yi()):t&&t.code===f.UNAUTHENTICATED&&3!==r.state&&r.credentialsProvider.invalidateToken(),null!==r.stream&&(r.pr(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.Ci(t)})()}pr(){}auth(){this.state=1;const e=this.Tr(this.ir),t=this.ir;this.credentialsProvider.getToken().then(r=>{this.ir===t&&this.Er(r)},r=>{e(()=>{const s=new v(f.UNKNOWN,"Fetching auth token failed: "+r.message);return this.Ir(s)})})}Er(e){const t=this.Tr(this.ir);this.stream=this.Ar(e),this.stream.Si(()=>{t(()=>(this.state=2,this.cr=this.Oe.enqueueAfterDelay(this.nr,1e4,()=>(this.hr()&&(this.state=3),Promise.resolve())),this.listener.Si()))}),this.stream.Ci(r=>{t(()=>this.Ir(r))}),this.stream.onMessage(r=>{t(()=>this.onMessage(r))})}lr(){var e=this;this.state=5,this.ar.Xi((0,g.Z)(function*(){e.state=0,e.start()}))}Ir(e){return w("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Tr(e){return t=>{this.Oe.enqueueAndForget(()=>this.ir===e?t():(w("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class og extends jh{constructor(e,t,r,s,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i),this.N=s}Ar(e){return this.sr.ji("Listen",e)}onMessage(e){this.ar.reset();const t=function(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(u=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===u?1:"REMOVE"===u?2:"CURRENT"===u?3:"RESET"===u?4:x(),s=e.targetChange.targetIds||[],i=function(u,c){return u.D?(b(void 0===c||"string"==typeof c),te.fromBase64String(c||"")):(b(void 0===c||c instanceof Uint8Array),te.fromUint8Array(c||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const c=void 0===u.code?f.UNKNOWN:Vc(u.code);return new v(c,u.message||"")}(o);t=new Kc(r,s,i,a||null)}else if("documentChange"in e){const r=e.documentChange,s=Pe(n,r.document.name),i=ne(r.document.updateTime),o=new de({mapValue:{fields:r.document.fields}}),a=V.newFoundDocument(s,i,o);t=new ls(r.targetIds||[],r.removedTargetIds||[],a.key,a)}else if("documentDelete"in e){const r=e.documentDelete,s=Pe(n,r.document),i=r.readTime?ne(r.readTime):N.min(),o=V.newNoDocument(s,i);t=new ls([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const r=e.documentRemove,s=Pe(n,r.document);t=new ls([],r.removedTargetIds||[],s,null)}else{if(!("filter"in e))return x();{const r=e.filter,i=new rm(r.count||0);t=new Zc(r.targetId,i)}}var u;return t}(this.N,e),r=function(s){if(!("targetChange"in s))return N.min();const i=s.targetChange;return i.targetIds&&i.targetIds.length?N.min():i.readTime?ne(i.readTime):N.min()}(e);return this.listener.Rr(t,r)}br(e){const t={};t.database=ar(this.N),t.addTarget=function(s,i){let o;const a=i.target;return o=ns(a)?{documents:th(s,a)}:{query:nh(s,a)},o.targetId=i.targetId,i.resumeToken.approximateByteSize()>0?o.resumeToken=Hc(s,i.resumeToken):i.snapshotVersion.compareTo(N.min())>0&&(o.readTime=ir(s,i.snapshotVersion.toTimestamp())),o}(this.N,e);const r=function(n,e){const t=function(r,s){switch(s){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return x()}}(0,e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.mr(t)}Pr(e){const t={};t.database=ar(this.N),t.removeTarget=e,this.mr(t)}}class ag extends jh{constructor(e,t,r,s,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i),this.N=s,this.vr=!1}get Vr(){return this.vr}start(){this.vr=!1,this.lastStreamToken=void 0,super.start()}pr(){this.vr&&this.Sr([])}Ar(e){return this.sr.ji("Write",e)}onMessage(e){if(b(!!e.streamToken),this.lastStreamToken=e.streamToken,this.vr){this.ar.reset();const t=function(n,e){return n&&n.length>0?(b(void 0!==e),n.map(t=>function(r,s){let i=ne(r.updateTime?r.updateTime:s);return i.isEqual(N.min())&&(i=ne(s)),new em(i,r.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=ne(e.commitTime);return this.listener.Dr(r,t)}return b(!e.writeResults||0===e.writeResults.length),this.vr=!0,this.listener.Cr()}Nr(){const e={};e.database=ar(this.N),this.mr(e)}Sr(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>ds(this.N,r))};this.mr(t)}}class ug extends class{}{constructor(e,t,r){super(),this.credentials=e,this.sr=t,this.N=r,this.kr=!1}$r(){if(this.kr)throw new v(f.FAILED_PRECONDITION,"The client has already been terminated.")}Li(e,t,r){return this.$r(),this.credentials.getToken().then(s=>this.sr.Li(e,t,r,s)).catch(s=>{throw"FirebaseError"===s.name?(s.code===f.UNAUTHENTICATED&&this.credentials.invalidateToken(),s):new v(f.UNKNOWN,s.toString())})}Ki(e,t,r){return this.$r(),this.credentials.getToken().then(s=>this.sr.Ki(e,t,r,s)).catch(s=>{throw"FirebaseError"===s.name?(s.code===f.UNAUTHENTICATED&&this.credentials.invalidateToken(),s):new v(f.UNKNOWN,s.toString())})}terminate(){this.kr=!0}}class cg{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Or=0,this.Fr=null,this.Mr=!0}Lr(){0===this.Or&&(this.Br("Unknown"),this.Fr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.Fr=null,this.Ur("Backend didn't respond within 10 seconds."),this.Br("Offline"),Promise.resolve())))}qr(e){"Online"===this.state?this.Br("Unknown"):(this.Or++,this.Or>=1&&(this.Kr(),this.Ur(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.Br("Offline")))}set(e){this.Kr(),this.Or=0,"Online"===e&&(this.Mr=!1),this.Br(e)}Br(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}Ur(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Mr?(G(t),this.Mr=!1):w("OnlineStateTracker",t)}Kr(){null!==this.Fr&&(this.Fr.cancel(),this.Fr=null)}}class hg{constructor(e,t,r,s,i){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.jr=[],this.Qr=new Map,this.Wr=new Set,this.Gr=[],this.zr=i,this.zr.Ti(a=>{r.enqueueAndForget((0,g.Z)(function*(){var u;ct(o)&&(w("RemoteStore","Restarting streams for network reachability change."),yield(u=(0,g.Z)(function*(c){const l=T(c);l.Wr.add(4),yield gn(l),l.Hr.set("Unknown"),l.Wr.delete(4),yield fr(l)}),function(c){return u.apply(this,arguments)})(o))}))}),this.Hr=new cg(r,s)}}function fr(n){return _o.apply(this,arguments)}function _o(){return(_o=(0,g.Z)(function*(n){if(ct(n))for(const e of n.Gr)yield e(!0)})).apply(this,arguments)}function gn(n){return To.apply(this,arguments)}function To(){return(To=(0,g.Z)(function*(n){for(const e of n.Gr)yield e(!1)})).apply(this,arguments)}function Is(n,e){const t=T(n);t.Qr.has(e.targetId)||(t.Qr.set(e.targetId,e),xo(t)?Eo(t):yn(t).hr()&&Io(t,e))}function mr(n,e){const t=T(n),r=yn(t);t.Qr.delete(e),r.hr()&&Zh(t,e),0===t.Qr.size&&(r.hr()?r.wr():ct(t)&&t.Hr.set("Unknown"))}function Io(n,e){n.Jr.Y(e.targetId),yn(n).br(e)}function Zh(n,e){n.Jr.Y(e),yn(n).Pr(e)}function Eo(n){n.Jr=new cm({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Tt:e=>n.Qr.get(e)||null}),yn(n).start(),n.Hr.Lr()}function xo(n){return ct(n)&&!yn(n).ur()&&n.Qr.size>0}function ct(n){return 0===T(n).Wr.size}function Kh(n){n.Jr=void 0}function lg(n){return So.apply(this,arguments)}function So(){return(So=(0,g.Z)(function*(n){n.Qr.forEach((e,t)=>{Io(n,e)})})).apply(this,arguments)}function dg(n,e){return bo.apply(this,arguments)}function bo(){return(bo=(0,g.Z)(function*(n,e){Kh(n),xo(n)?(n.Hr.qr(e),Eo(n)):n.Hr.set("Unknown")})).apply(this,arguments)}function fg(n,e,t){return Ao.apply(this,arguments)}function Ao(){return(Ao=(0,g.Z)(function*(n,e,t){if(n.Hr.set("Online"),e instanceof Kc&&2===e.state&&e.cause)try{yield(r=(0,g.Z)(function*(s,i){const o=i.cause;for(const a of i.targetIds)s.Qr.has(a)&&(yield s.remoteSyncer.rejectListen(a,o),s.Qr.delete(a),s.Jr.removeTarget(a))}),function(s,i){return r.apply(this,arguments)})(n,e)}catch(r){w("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Es(n,r)}else if(e instanceof ls?n.Jr.rt(e):e instanceof Zc?n.Jr.ft(e):n.Jr.at(e),!t.isEqual(N.min()))try{const r=yield Lh(n.localStore);t.compareTo(r)>=0&&(yield function(s,i){const o=s.Jr._t(i);return o.targetChanges.forEach((a,u)=>{if(a.resumeToken.approximateByteSize()>0){const c=s.Qr.get(u);c&&s.Qr.set(u,c.withResumeToken(a.resumeToken,i))}}),o.targetMismatches.forEach(a=>{const u=s.Qr.get(a);if(!u)return;s.Qr.set(a,u.withResumeToken(te.EMPTY_BYTE_STRING,u.snapshotVersion)),Zh(s,a);const c=new it(u.target,a,1,u.sequenceNumber);Io(s,c)}),s.remoteSyncer.applyRemoteEvent(o)}(n,t))}catch(r){w("RemoteStore","Failed to raise snapshot:",r),yield Es(n,r)}var r})).apply(this,arguments)}function Es(n,e,t){return No.apply(this,arguments)}function No(){return(No=(0,g.Z)(function*(n,e,t){if(!Nt(e))throw e;n.Wr.add(1),yield gn(n),n.Hr.set("Offline"),t||(t=()=>Lh(n.localStore)),n.asyncQueue.enqueueRetryable((0,g.Z)(function*(){w("RemoteStore","Retrying IndexedDB access"),yield t(),n.Wr.delete(1),yield fr(n)}))})).apply(this,arguments)}function $h(n,e){return e().catch(t=>Es(n,t,e))}function pn(n){return Do.apply(this,arguments)}function Do(){return(Do=(0,g.Z)(function*(n){const e=T(n),t=ht(e);let r=e.jr.length>0?e.jr[e.jr.length-1].batchId:-1;for(;mg(e);)try{const s=yield $m(e.localStore,r);if(null===s){0===e.jr.length&&t.wr();break}r=s.batchId,gg(e,s)}catch(s){yield Es(e,s)}Gh(e)&&zh(e)})).apply(this,arguments)}function mg(n){return ct(n)&&n.jr.length<10}function gg(n,e){n.jr.push(e);const t=ht(n);t.hr()&&t.Vr&&t.Sr(e.mutations)}function Gh(n){return ct(n)&&!ht(n).ur()&&n.jr.length>0}function zh(n){ht(n).start()}function pg(n){return Co.apply(this,arguments)}function Co(){return(Co=(0,g.Z)(function*(n){ht(n).Nr()})).apply(this,arguments)}function yg(n){return ko.apply(this,arguments)}function ko(){return(ko=(0,g.Z)(function*(n){const e=ht(n);for(const t of n.jr)e.Sr(t.mutations)})).apply(this,arguments)}function vg(n,e,t){return Ro.apply(this,arguments)}function Ro(){return(Ro=(0,g.Z)(function*(n,e,t){const r=n.jr.shift(),s=Wi.from(r,e,t);yield $h(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),yield pn(n)})).apply(this,arguments)}function wg(n,e){return Lo.apply(this,arguments)}function Lo(){return(Lo=(0,g.Z)(function*(n,e){var t;e&&ht(n).Vr&&(yield(t=(0,g.Z)(function*(r,s){if(qc(i=s.code)&&i!==f.ABORTED){const o=r.jr.shift();ht(r).dr(),yield $h(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield pn(r)}var i}),function(r,s){return t.apply(this,arguments)})(n,e)),Gh(n)&&zh(n)})).apply(this,arguments)}function Mo(n,e){return Fo.apply(this,arguments)}function Fo(){return(Fo=(0,g.Z)(function*(n,e){const t=T(n);e?(t.Wr.delete(2),yield fr(t)):e||(t.Wr.add(2),yield gn(t),t.Hr.set("Unknown"))})).apply(this,arguments)}function yn(n){return n.Yr||(n.Yr=function(e,t,r){const s=T(e);return s.$r(),new og(t,s.sr,s.credentials,s.N,r)}(n.datastore,n.asyncQueue,{Si:lg.bind(null,n),Ci:dg.bind(null,n),Rr:fg.bind(null,n)}),n.Gr.push(function(){var e=(0,g.Z)(function*(t){t?(n.Yr.dr(),xo(n)?Eo(n):n.Hr.set("Unknown")):(yield n.Yr.stop(),Kh(n))});return function(t){return e.apply(this,arguments)}}())),n.Yr}function ht(n){return n.Xr||(n.Xr=function(e,t,r){const s=T(e);return s.$r(),new ag(t,s.sr,s.credentials,s.N,r)}(n.datastore,n.asyncQueue,{Si:pg.bind(null,n),Ci:wg.bind(null,n),Cr:yg.bind(null,n),Dr:vg.bind(null,n)}),n.Gr.push(function(){var e=(0,g.Z)(function*(t){t?(n.Xr.dr(),yield pn(n)):(yield n.Xr.stop(),n.jr.length>0&&(w("RemoteStore",`Stopping write stream with ${n.jr.length} pending writes`),n.jr=[]))});return function(t){return e.apply(this,arguments)}}())),n.Xr}class Oo{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new J,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new Oo(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new v(f.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function vn(n,e){if(G("AsyncQueue",`${e}: ${n}`),Nt(n))return new v(f.UNAVAILABLE,`${e}: ${n}`);throw n}class wn{constructor(e){this.comparator=e?(t,r)=>e(t,r)||E.comparator(t.key,r.key):(t,r)=>E.comparator(t.key,r.key),this.keyedMap=$i(),this.sortedSet=new W(this.comparator)}static emptySet(e){return new wn(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof wn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new wn;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Hh{constructor(){this.Zr=new W(E.comparator)}track(e){const t=e.doc.key,r=this.Zr.get(t);r?0!==e.type&&3===r.type?this.Zr=this.Zr.insert(t,e):3===e.type&&1!==r.type?this.Zr=this.Zr.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.Zr=this.Zr.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.Zr=this.Zr.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.Zr=this.Zr.remove(t):1===e.type&&2===r.type?this.Zr=this.Zr.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.Zr=this.Zr.insert(t,{type:2,doc:e.doc}):x():this.Zr=this.Zr.insert(t,e)}eo(){const e=[];return this.Zr.inorderTraversal((t,r)=>{e.push(r)}),e}}class _n{constructor(e,t,r,s,i,o,a,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u}static fromInitialDocuments(e,t,r,s){const i=[];return t.forEach(o=>{i.push({type:0,doc:o})}),new _n(e,t,wn.emptySet(t),i,r,s,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Xn(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class _g{constructor(){this.no=void 0,this.listeners=[]}}class Tg{constructor(){this.queries=new dn(e=>xc(e),Xn),this.onlineState="Unknown",this.so=new Set}}function Po(n,e){return Uo.apply(this,arguments)}function Uo(){return(Uo=(0,g.Z)(function*(n,e){const t=T(n),r=e.query;let s=!1,i=t.queries.get(r);if(i||(s=!0,i=new _g),s)try{i.no=yield t.onListen(r)}catch(o){const a=vn(o,`Initialization of query '${ji(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,i),i.listeners.push(e),e.io(t.onlineState),i.no&&e.ro(i.no)&&Bo(t)})).apply(this,arguments)}function qo(n,e){return Vo.apply(this,arguments)}function Vo(){return(Vo=(0,g.Z)(function*(n,e){const t=T(n),r=e.query;let s=!1;const i=t.queries.get(r);if(i){const o=i.listeners.indexOf(e);o>=0&&(i.listeners.splice(o,1),s=0===i.listeners.length)}if(s)return t.queries.delete(r),t.onUnlisten(r)})).apply(this,arguments)}function Ig(n,e){const t=T(n);let r=!1;for(const s of e){const o=t.queries.get(s.query);if(o){for(const a of o.listeners)a.ro(s)&&(r=!0);o.no=s}}r&&Bo(t)}function Eg(n,e,t){const r=T(n),s=r.queries.get(e);if(s)for(const i of s.listeners)i.onError(t);r.queries.delete(e)}function Bo(n){n.so.forEach(e=>{e.next()})}class jo{constructor(e,t,r){this.query=e,this.oo=t,this.co=!1,this.ao=null,this.onlineState="Unknown",this.options=r||{}}ro(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)3!==s.type&&r.push(s);e=new _n(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.co?this.uo(e)&&(this.oo.next(e),t=!0):this.ho(e,this.onlineState)&&(this.lo(e),t=!0),this.ao=e,t}onError(e){this.oo.error(e)}io(e){this.onlineState=e;let t=!1;return this.ao&&!this.co&&this.ho(this.ao,e)&&(this.lo(this.ao),t=!0),t}ho(e,t){return!e.fromCache||!(this.options.fo&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)}uo(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.ao&&this.ao.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}lo(e){e=_n.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.co=!0,this.oo.next(e)}}class xg{constructor(e,t){this.payload=e,this.byteLength=t}wo(){return"metadata"in this.payload}}class Qh{constructor(e){this.N=e}zn(e){return Pe(this.N,e)}Hn(e){return e.metadata.exists?Jc(this.N,e.document,!1):V.newNoDocument(this.zn(e.metadata.name),this.Jn(e.metadata.readTime))}Jn(e){return ne(e)}}class Sg{constructor(e,t,r){this._o=e,this.localStore=t,this.N=r,this.queries=[],this.documents=[],this.progress=Wh(e)}mo(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;return e.payload.namedQuery?this.queries.push(e.payload.namedQuery):e.payload.documentMetadata?(this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t):e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}yo(e){const t=new Map,r=new Qh(this.N);for(const s of e)if(s.metadata.queries){const i=r.zn(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||O()).add(i);t.set(o,a)}}return t}complete(){var e=this;return(0,g.Z)(function*(){const t=yield function(n,e,t,r){return ho.apply(this,arguments)}(e.localStore,new Qh(e.N),e.documents,e._o.id),r=e.yo(e.documents);for(const s of e.queries)yield Hm(e.localStore,s,r.get(s.name));return e.progress.taskState="Success",new Bm(Object.assign({},e.progress),t)})()}}function Wh(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class Yh{constructor(e){this.key=e}}class Xh{constructor(e){this.key=e}}class Jh{constructor(e,t){this.query=e,this.po=t,this.To=null,this.current=!1,this.Eo=O(),this.mutatedKeys=O(),this.Io=Sc(e),this.Ao=new wn(this.Io)}get Ro(){return this.po}bo(e,t){const r=t?t.Po:new Hh,s=t?t.Ao:this.Ao;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const u=ss(this.query)&&s.size===this.query.limit?s.last():null,c=is(this.query)&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((l,d)=>{const m=s.get(l),p=Jn(this.query,d)?d:null,_=!!m&&this.mutatedKeys.has(m.key),S=!!p&&(p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations);let D=!1;m&&p?m.data.isEqual(p.data)?_!==S&&(r.track({type:3,doc:p}),D=!0):this.vo(m,p)||(r.track({type:2,doc:p}),D=!0,(u&&this.Io(p,u)>0||c&&this.Io(p,c)<0)&&(a=!0)):!m&&p?(r.track({type:0,doc:p}),D=!0):m&&!p&&(r.track({type:1,doc:m}),D=!0,(u||c)&&(a=!0)),D&&(p?(o=o.add(p),i=S?i.add(l):i.delete(l)):(o=o.delete(l),i=i.delete(l)))}),ss(this.query)||is(this.query))for(;o.size>this.query.limit;){const l=ss(this.query)?o.last():o.first();o=o.delete(l.key),i=i.delete(l.key),r.track({type:1,doc:l})}return{Ao:o,Po:r,Ln:a,mutatedKeys:i}}vo(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r){const s=this.Ao;this.Ao=e.Ao,this.mutatedKeys=e.mutatedKeys;const i=e.Po.eo();i.sort((c,l)=>function(d,m){const p=_=>{switch(_){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return x()}};return p(d)-p(m)}(c.type,l.type)||this.Io(c.doc,l.doc)),this.Vo(r);const o=t?this.So():[],a=0===this.Eo.size&&this.current?1:0,u=a!==this.To;return this.To=a,0!==i.length||u?{snapshot:new _n(this.query,e.Ao,s,i,e.mutatedKeys,0===a,u,!1),Do:o}:{Do:o}}io(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ao:this.Ao,Po:new Hh,mutatedKeys:this.mutatedKeys,Ln:!1},!1)):{Do:[]}}Co(e){return!this.po.has(e)&&!!this.Ao.has(e)&&!this.Ao.get(e).hasLocalMutations}Vo(e){e&&(e.addedDocuments.forEach(t=>this.po=this.po.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.po=this.po.delete(t)),this.current=e.current)}So(){if(!this.current)return[];const e=this.Eo;this.Eo=O(),this.Ao.forEach(r=>{this.Co(r.key)&&(this.Eo=this.Eo.add(r.key))});const t=[];return e.forEach(r=>{this.Eo.has(r)||t.push(new Xh(r))}),this.Eo.forEach(r=>{e.has(r)||t.push(new Yh(r))}),t}No(e){this.po=e.Gn,this.Eo=O();const t=this.bo(e.documents);return this.applyChanges(t,!0)}xo(){return _n.fromInitialDocuments(this.query,this.Ao,this.mutatedKeys,0===this.To)}}class bg{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Ag{constructor(e){this.key=e,this.ko=!1}}class Ng{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.$o={},this.Oo=new dn(a=>xc(a),Xn),this.Fo=new Map,this.Mo=new Set,this.Lo=new W(E.comparator),this.Bo=new Map,this.Uo=new fo,this.qo={},this.Ko=new Map,this.jo=Ct.ie(),this.onlineState="Unknown",this.Qo=void 0}get isPrimaryClient(){return!0===this.Qo}}function Dg(n,e){return Zo.apply(this,arguments)}function Zo(){return(Zo=(0,g.Z)(function*(n,e){const t=da(n);let r,s;const i=t.Oo.get(e);if(i)r=i.targetId,t.sharedClientState.addLocalQueryTarget(r),s=i.view.xo();else{const o=yield fn(t.localStore,De(e)),a=t.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,s=yield Ko(t,e,r,"current"===a),t.isPrimaryClient&&Is(t.remoteStore,o)}return s})).apply(this,arguments)}function Ko(n,e,t,r){return $o.apply(this,arguments)}function $o(){return($o=(0,g.Z)(function*(n,e,t,r){n.Wo=(l,d,m)=>{return(p=(0,g.Z)(function*(_,S,D,K){let Me=S.view.bo(D);Me.Ln&&(Me=yield vs(_.localStore,S.query,!1).then(({documents:Xe})=>S.view.bo(Xe,Me)));const Be=K&&K.targetChanges.get(S.targetId),Ye=S.view.applyChanges(Me,_.isPrimaryClient,Be);return ta(_,S.targetId,Ye.Do),Ye.snapshot}),function(_,S,D,K){return p.apply(this,arguments)})(n,l,d,m);var p};const s=yield vs(n.localStore,e,!0),i=new Jh(e,s.Gn),o=i.bo(s.documents),a=sr.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState),u=i.applyChanges(o,n.isPrimaryClient,a);ta(n,t,u.Do);const c=new bg(e,t,i);return n.Oo.set(e,c),n.Fo.has(t)?n.Fo.get(t).push(e):n.Fo.set(t,[e]),u.snapshot})).apply(this,arguments)}function Cg(n,e){return Go.apply(this,arguments)}function Go(){return(Go=(0,g.Z)(function*(n,e){const t=T(n),r=t.Oo.get(e),s=t.Fo.get(r.targetId);if(s.length>1)return t.Fo.set(r.targetId,s.filter(i=>!Xn(i,e))),void t.Oo.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield mn(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),mr(t.remoteStore,r.targetId),Tn(t,r.targetId)}).catch(kt))):(Tn(t,r.targetId),yield mn(t.localStore,r.targetId,!0))})).apply(this,arguments)}function zo(){return(zo=(0,g.Z)(function*(n,e,t){const r=fa(n);try{const s=yield function(i,o){const a=T(i),u=ee.now(),c=o.reduce((d,m)=>d.add(m.key),O());let l;return a.persistence.runTransaction("Locally write mutations","readwrite",d=>a.Qn.Pn(d,c).next(m=>{l=m;const p=[];for(const _ of o){const S=nm(_,l.get(_.key));null!=S&&p.push(new rt(_.key,S,yc(S.value.mapValue),H.exists(!0)))}return a.In.addMutationBatch(d,u,p,o)})).then(d=>(d.applyToLocalDocumentSet(l),{batchId:d.batchId,changes:l}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(i,o,a){let u=i.qo[i.currentUser.toKey()];u||(u=new W(C)),u=u.insert(o,a),i.qo[i.currentUser.toKey()]=u}(r,s.batchId,t),yield He(r,s.changes),yield pn(r.remoteStore)}catch(s){const i=vn(s,"Failed to persist write");t.reject(i)}})).apply(this,arguments)}function el(n,e){return Ho.apply(this,arguments)}function Ho(){return(Ho=(0,g.Z)(function*(n,e){const t=T(n);try{const r=yield Km(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Bo.get(i);o&&(b(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.ko=!0:s.modifiedDocuments.size>0?b(o.ko):s.removedDocuments.size>0&&(b(o.ko),o.ko=!1))}),yield He(t,r,e)}catch(r){yield kt(r)}})).apply(this,arguments)}function tl(n,e,t){const r=T(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const s=[];r.Oo.forEach((i,o)=>{const a=o.view.io(e);a.snapshot&&s.push(a.snapshot)}),function(i,o){const a=T(i);a.onlineState=o;let u=!1;a.queries.forEach((c,l)=>{for(const d of l.listeners)d.io(o)&&(u=!0)}),u&&Bo(a)}(r.eventManager,e),s.length&&r.$o.Rr(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Rg(n,e,t){return Qo.apply(this,arguments)}function Qo(){return(Qo=(0,g.Z)(function*(n,e,t){const r=T(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Bo.get(e),i=s&&s.key;if(i){let o=new W(E.comparator);o=o.insert(i,V.newNoDocument(i,N.min()));const a=O().add(i),u=new rr(N.min(),new Map,new j(C),o,a);yield el(r,u),r.Lo=r.Lo.remove(i),r.Bo.delete(e),na(r)}else yield mn(r.localStore,e,!1).then(()=>Tn(r,e,t)).catch(kt)})).apply(this,arguments)}function Lg(n,e){return Wo.apply(this,arguments)}function Wo(){return(Wo=(0,g.Z)(function*(n,e){const t=T(n),r=e.batch.batchId;try{const s=yield Zm(t.localStore,e);ea(t,r,null),Jo(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield He(t,s)}catch(s){yield kt(s)}})).apply(this,arguments)}function Mg(n,e,t){return Yo.apply(this,arguments)}function Yo(){return(Yo=(0,g.Z)(function*(n,e,t){const r=T(n);try{const s=yield function(i,o){const a=T(i);return a.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let c;return a.In.lookupMutationBatch(u,o).next(l=>(b(null!==l),c=l.keys(),a.In.removeMutationBatch(u,l))).next(()=>a.In.performConsistencyCheck(u)).next(()=>a.Qn.Pn(u,c))})}(r.localStore,e);ea(r,e,t),Jo(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield He(r,s)}catch(s){yield kt(s)}})).apply(this,arguments)}function Xo(){return(Xo=(0,g.Z)(function*(n,e){const t=T(n);ct(t.remoteStore)||w("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(i){const o=T(i);return o.persistence.runTransaction("Get highest unacknowledged batch id","readonly",a=>o.In.getHighestUnacknowledgedBatchId(a))}(t.localStore);if(-1===r)return void e.resolve();const s=t.Ko.get(r)||[];s.push(e),t.Ko.set(r,s)}catch(r){const s=vn(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}})).apply(this,arguments)}function Jo(n,e){(n.Ko.get(e)||[]).forEach(t=>{t.resolve()}),n.Ko.delete(e)}function ea(n,e,t){const r=T(n);let s=r.qo[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.qo[r.currentUser.toKey()]=s}}function Tn(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Fo.get(e))n.Oo.delete(r),t&&n.$o.Go(r,t);n.Fo.delete(e),n.isPrimaryClient&&n.Uo.cs(e).forEach(r=>{n.Uo.containsKey(r)||nl(n,r)})}function nl(n,e){n.Mo.delete(e.path.canonicalString());const t=n.Lo.get(e);null!==t&&(mr(n.remoteStore,t),n.Lo=n.Lo.remove(e),n.Bo.delete(t),na(n))}function ta(n,e,t){for(const r of t)r instanceof Yh?(n.Uo.addReference(r.key,e),Og(n,r)):r instanceof Xh?(w("SyncEngine","Document no longer in limbo: "+r.key),n.Uo.removeReference(r.key,e),n.Uo.containsKey(r.key)||nl(n,r.key)):x()}function Og(n,e){const t=e.key,r=t.path.canonicalString();n.Lo.get(t)||n.Mo.has(r)||(w("SyncEngine","New document in limbo: "+t),n.Mo.add(r),na(n))}function na(n){for(;n.Mo.size>0&&n.Lo.size<n.maxConcurrentLimboResolutions;){const e=n.Mo.values().next().value;n.Mo.delete(e);const t=new E(F.fromString(e)),r=n.jo.next();n.Bo.set(r,new Ag(t)),n.Lo=n.Lo.insert(t,r),Is(n.remoteStore,new it(De(Xt(t.path)),r,2,Se.T))}}function He(n,e,t){return ra.apply(this,arguments)}function ra(){return(ra=(0,g.Z)(function*(n,e,t){const r=T(n),s=[],i=[],o=[];var a;r.Oo.isEmpty()||(r.Oo.forEach((a,u)=>{o.push(r.Wo(u,e,t).then(c=>{if(c){r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,c.fromCache?"not-current":"current"),s.push(c);const l=oo.kn(u.targetId,c);i.push(l)}}))}),yield Promise.all(o),r.$o.Rr(s),yield(a=(0,g.Z)(function*(u,c){const l=T(u);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",d=>y.forEach(c,m=>y.forEach(m.Nn,p=>l.persistence.referenceDelegate.addReference(d,m.targetId,p)).next(()=>y.forEach(m.xn,p=>l.persistence.referenceDelegate.removeReference(d,m.targetId,p)))))}catch(d){if(!Nt(d))throw d;w("LocalStore","Failed to update sequence numbers: "+d)}for(const d of c){const m=d.targetId;if(!d.fromCache){const p=l.Un.get(m),S=p.withLastLimboFreeSnapshotVersion(p.snapshotVersion);l.Un=l.Un.insert(m,S)}}}),function(u,c){return a.apply(this,arguments)})(r.localStore,i))})).apply(this,arguments)}function Pg(n,e){return sa.apply(this,arguments)}function sa(){return(sa=(0,g.Z)(function*(n,e){const t=T(n);if(!t.currentUser.isEqual(e)){w("SyncEngine","User change. New user:",e.toKey());const r=yield Rh(t.localStore,e);t.currentUser=e,(s=t).Ko.forEach(o=>{o.forEach(a=>{a.reject(new v(f.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.Ko.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield He(t,r.Wn)}var s})).apply(this,arguments)}function Ug(n,e){const t=T(n),r=t.Bo.get(e);if(r&&r.ko)return O().add(r.key);{let s=O();const i=t.Fo.get(e);if(!i)return s;for(const o of i){const a=t.Oo.get(o);s=s.unionWith(a.view.Ro)}return s}}function qg(n,e){return ia.apply(this,arguments)}function ia(){return(ia=(0,g.Z)(function*(n,e){const t=T(n),r=yield vs(t.localStore,e.query,!0),s=e.view.No(r);return t.isPrimaryClient&&ta(t,e.targetId,s.Do),s})).apply(this,arguments)}function Vg(n){return oa.apply(this,arguments)}function oa(){return(oa=(0,g.Z)(function*(n){const e=T(n);return Oh(e.localStore).then(t=>He(e,t))})).apply(this,arguments)}function Bg(n,e,t,r){return aa.apply(this,arguments)}function aa(){return(aa=(0,g.Z)(function*(n,e,t,r){const s=T(n),i=yield function(o,a){const u=T(o),c=T(u.In);return u.persistence.runTransaction("Lookup mutation documents","readonly",l=>c.Xt(l,a).next(d=>d?u.Qn.Pn(l,d):y.resolve(null)))}(s.localStore,e);var a;null!==i?("pending"===t?yield pn(s.remoteStore):"acknowledged"===t||"rejected"===t?(ea(s,e,r||null),Jo(s,e),a=e,T(T(s.localStore).In).te(a)):x(),yield He(s,i)):w("SyncEngine","Cannot apply mutation batch with id: "+e)})).apply(this,arguments)}function ua(){return(ua=(0,g.Z)(function*(n,e){const t=T(n);if(da(t),fa(t),!0===e&&!0!==t.Qo){const r=t.sharedClientState.getAllActiveQueryTargets(),s=yield rl(t,r.toArray());t.Qo=!0,yield Mo(t.remoteStore,!0);for(const i of s)Is(t.remoteStore,i)}else if(!1===e&&!1!==t.Qo){const r=[];let s=Promise.resolve();t.Fo.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(Tn(t,o),mn(t.localStore,o,!0))),mr(t.remoteStore,o)}),yield s,yield rl(t,r),function(i){const o=T(i);o.Bo.forEach((a,u)=>{mr(o.remoteStore,u)}),o.Uo.us(),o.Bo=new Map,o.Lo=new W(E.comparator)}(t),t.Qo=!1,yield Mo(t.remoteStore,!1)}})).apply(this,arguments)}function rl(n,e,t){return ca.apply(this,arguments)}function ca(){return(ca=(0,g.Z)(function*(n,e,t){const r=T(n),s=[],i=[];for(const o of e){let a;const u=r.Fo.get(o);if(u&&0!==u.length){a=yield fn(r.localStore,De(u[0]));for(const c of u){const l=r.Oo.get(c),d=yield qg(r,l);d.snapshot&&i.push(d.snapshot)}}else{const c=yield Fh(r.localStore,o);a=yield fn(r.localStore,c),yield Ko(r,sl(c),o,!1)}s.push(a)}return r.$o.Rr(i),s})).apply(this,arguments)}function sl(n){return Ic(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function Zg(n){const e=T(n);return T(T(e.localStore).persistence).pn()}function Kg(n,e,t,r){return ha.apply(this,arguments)}function ha(){return(ha=(0,g.Z)(function*(n,e,t,r){const s=T(n);if(s.Qo)w("SyncEngine","Ignoring unexpected query state notification.");else if(s.Fo.has(e))switch(t){case"current":case"not-current":{const i=yield Oh(s.localStore),o=rr.createSynthesizedRemoteEventForCurrentChange(e,"current"===t);yield He(s,i,o);break}case"rejected":yield mn(s.localStore,e,!0),Tn(s,e,r);break;default:x()}})).apply(this,arguments)}function $g(n,e,t){return la.apply(this,arguments)}function la(){return(la=(0,g.Z)(function*(n,e,t){const r=da(n);if(r.Qo){for(const s of e){if(r.Fo.has(s)){w("SyncEngine","Adding an already active target "+s);continue}const i=yield Fh(r.localStore,s),o=yield fn(r.localStore,i);yield Ko(r,sl(i),o.targetId,!1),Is(r.remoteStore,o)}for(const s of t)r.Fo.has(s)&&(yield mn(r.localStore,s,!1).then(()=>{mr(r.remoteStore,s),Tn(r,s)}).catch(kt))}})).apply(this,arguments)}function da(n){const e=T(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=el.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ug.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Rg.bind(null,e),e.$o.Rr=Ig.bind(null,e.eventManager),e.$o.Go=Eg.bind(null,e.eventManager),e}function fa(n){const e=T(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Lg.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Mg.bind(null,e),e}class il{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,g.Z)(function*(){t.N=dr(e.databaseInfo.databaseId),t.sharedClientState=t.Ho(e),t.persistence=t.Jo(e),yield t.persistence.start(),t.gcScheduler=t.Yo(e),t.localStore=t.Xo(e)})()}Yo(e){return null}Xo(e){return kh(this.persistence,new Ch,e.initialUser,this.N)}Jo(e){return new eg(mo.Ns,this.N)}Ho(e){return new qh}terminate(){var e=this;return(0,g.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class ol extends il{constructor(e,t,r){super(),this.Zo=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,g.Z)(function*(){yield t().call(r,e),yield function(n){return co.apply(this,arguments)}(r.localStore),yield r.Zo.initialize(r,e),yield fa(r.Zo.syncEngine),yield pn(r.Zo.remoteStore),yield r.persistence.nn(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(r.localStore),Promise.resolve()))})()}Xo(e){return kh(this.persistence,new Ch,e.initialUser,this.N)}Yo(e){return new Fm(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue)}Jo(e){const t=io(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?Ee.withCacheSize(this.cacheSizeBytes):Ee.DEFAULT;return new so(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Bh(),Ts(),this.N,this.sharedClientState,!!this.forceOwnership)}Ho(e){return new qh}}class zg extends ol{constructor(e,t){super(e,t,!1),this.Zo=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,g.Z)(function*(){yield t().call(r,e);const s=r.Zo.syncEngine;r.sharedClientState instanceof vo&&(r.sharedClientState.syncEngine={_i:Bg.bind(null,s),mi:Kg.bind(null,s),gi:$g.bind(null,s),pn:Zg.bind(null,s),wi:Vg.bind(null,s)},yield r.sharedClientState.start()),yield r.persistence.nn(function(){var i=(0,g.Z)(function*(o){yield function(n,e){return ua.apply(this,arguments)}(r.Zo.syncEngine,o),r.gcScheduler&&(o&&!r.gcScheduler.started?r.gcScheduler.start(r.localStore):o||r.gcScheduler.stop())});return function(o){return i.apply(this,arguments)}}())})()}Ho(e){const t=Bh();if(!vo.bt(t))throw new v(f.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=io(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new vo(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class ma{initialize(e,t){var r=this;return(0,g.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=s=>tl(r.syncEngine,s,1),r.remoteStore.remoteSyncer.handleCredentialChange=Pg.bind(null,r.syncEngine),yield Mo(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Tg}createDatastore(e){const t=dr(e.databaseInfo.databaseId),r=new ig(e.databaseInfo);return new ug(e.credentials,r,t)}createRemoteStore(e){return t=this.localStore,r=this.datastore,s=e.asyncQueue,i=a=>tl(this.syncEngine,a,0),o=Vh.bt()?new Vh:new ng,new hg(t,r,s,i,o);var t,r,s,i,o}createSyncEngine(e,t){return function(r,s,i,o,a,u,c){const l=new Ng(r,s,i,o,a,u);return c&&(l.Qo=!0),l}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,g.Z)(function*(t){const r=T(t);w("RemoteStore","RemoteStore shutting down."),r.Wr.add(5),yield gn(r),r.zr.shutdown(),r.Hr.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}function al(n,e=10240){let t=0;return{read:()=>(0,g.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,g.Z)(function*(){})(),releaseLock(){},closed:Promise.reject("unimplemented")}}class xs{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.tc(this.observer.next,e)}error(e){this.observer.error?this.tc(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}ec(){this.muted=!0}tc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Hg{constructor(e,t){this.nc=e,this.N=t,this.metadata=new J,this.buffer=new Uint8Array,this.sc=new TextDecoder("utf-8"),this.ic().then(r=>{r&&r.wo()?this.metadata.resolve(r.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==r?void 0:r.payload)}`))},r=>this.metadata.reject(r))}close(){return this.nc.cancel()}getMetadata(){var e=this;return(0,g.Z)(function*(){return e.metadata.promise})()}zo(){var e=this;return(0,g.Z)(function*(){return yield e.getMetadata(),e.ic()})()}ic(){var e=this;return(0,g.Z)(function*(){const t=yield e.rc();if(null===t)return null;const r=e.sc.decode(t),s=Number(r);isNaN(s)&&e.oc(`length string (${r}) is not valid number`);const i=yield e.cc(s);return new xg(JSON.parse(i),t.length+s)})()}ac(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}rc(){var e=this;return(0,g.Z)(function*(){for(;e.ac()<0&&!(yield e.uc()););if(0===e.buffer.length)return null;const t=e.ac();t<0&&e.oc("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}cc(e){var t=this;return(0,g.Z)(function*(){for(;t.buffer.length<e;)(yield t.uc())&&t.oc("Reached the end of bundle when more is expected.");const r=t.sc.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}oc(e){throw this.nc.cancel(),new Error(`Invalid bundle format: ${e}`)}uc(){var e=this;return(0,g.Z)(function*(){const t=yield e.nc.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class Qg{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,g.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new v(f.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const r=yield(s=(0,g.Z)(function*(i,o){const a=T(i),u=ar(a.N)+"/documents",c={documents:o.map(p=>or(a.N,p))},l=yield a.Ki("BatchGetDocuments",u,c),d=new Map;l.forEach(p=>{const _=function(n,e){return"found"in e?function(t,r){b(!!r.found);const s=Pe(t,r.found.name),i=ne(r.found.updateTime),o=new de({mapValue:{fields:r.found.fields}});return V.newFoundDocument(s,i,o)}(n,e):"missing"in e?function(t,r){b(!!r.missing),b(!!r.readTime);const s=Pe(t,r.missing),i=ne(r.readTime);return V.newNoDocument(s,i)}(n,e):x()}(a.N,p);d.set(_.key.toString(),_)});const m=[];return o.forEach(p=>{const _=d.get(p.toString());b(!!_),m.push(_)}),m}),function(i,o){return s.apply(this,arguments)})(t.datastore,e);var s;return r.forEach(s=>t.recordVersion(s)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new nr(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,g.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,s)=>{const i=E.fromPath(s);e.mutations.push(new Ki(i,e.precondition(i)))}),yield(r=(0,g.Z)(function*(s,i){const o=T(s),a=ar(o.N)+"/documents",u={writes:i.map(c=>ds(o.N,c))};yield o.Li("Commit",a,u)}),function(s,i){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw x();t=N.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new v(f.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?H.updateTime(t):H.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(N.min()))throw new v(f.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return H.updateTime(t)}return H.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Wg{constructor(e,t,r,s){this.asyncQueue=e,this.datastore=t,this.updateFunction=r,this.deferred=s,this.hc=5,this.ar=new wo(this.asyncQueue,"transaction_retry")}run(){this.hc-=1,this.lc()}lc(){var e=this;this.ar.Xi((0,g.Z)(function*(){const t=new Qg(e.datastore),r=e.fc(t);r&&r.then(s=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(s)}).catch(i=>{e.dc(i)}))}).catch(s=>{e.dc(s)})}))}fc(e){try{const t=this.updateFunction(e);return!Et(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}dc(e){this.hc>0&&this.wc(e)?(this.hc-=1,this.asyncQueue.enqueueAndForget(()=>(this.lc(),Promise.resolve()))):this.deferred.reject(e)}wc(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||!qc(t)}return!1}}class Yg{constructor(e,t,r){var s=this;this.credentials=e,this.asyncQueue=t,this.databaseInfo=r,this.user=ae.UNAUTHENTICATED,this.clientId=uc.I(),this.credentialListener=()=>Promise.resolve(),this.credentials.start(t,function(){var i=(0,g.Z)(function*(o){w("FirestoreClient","Received user=",o.uid),yield s.credentialListener(o),s.user=o});return function(o){return i.apply(this,arguments)}}())}getConfiguration(){var e=this;return(0,g.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,credentials:e.credentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.credentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new v(f.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new J;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,g.Z)(function*(){try{e.onlineComponents&&(yield e.onlineComponents.terminate()),e.offlineComponents&&(yield e.offlineComponents.terminate()),e.credentials.shutdown(),t.resolve()}catch(r){const s=vn(r,"Failed to shutdown persistence");t.reject(s)}})),t.promise}}function ul(n,e){return ga.apply(this,arguments)}function ga(){return(ga=(0,g.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),w("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var s=(0,g.Z)(function*(i){r.isEqual(i)||(yield Rh(e.localStore,i),r=i)});return function(i){return s.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n.offlineComponents=e})).apply(this,arguments)}function cl(n,e){return pa.apply(this,arguments)}function pa(){return(pa=(0,g.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield ya(n);w("FirestoreClient","Initializing OnlineComponentProvider");const r=yield n.getConfiguration();yield e.initialize(t,r),n.setCredentialChangeListener(s=>{return(i=(0,g.Z)(function*(o,a){const u=T(o);u.asyncQueue.verifyOperationInProgress(),w("RemoteStore","RemoteStore received new credentials");const c=ct(u);u.Wr.add(3),yield gn(u),c&&u.Hr.set("Unknown"),yield u.remoteSyncer.handleCredentialChange(a),u.Wr.delete(3),yield fr(u)}),function(o,a){return i.apply(this,arguments)})(e.remoteStore,s);var i}),n.onlineComponents=e})).apply(this,arguments)}function ya(n){return va.apply(this,arguments)}function va(){return(va=(0,g.Z)(function*(n){return n.offlineComponents||(w("FirestoreClient","Using default OfflineComponentProvider"),yield ul(n,new il)),n.offlineComponents})).apply(this,arguments)}function Ss(n){return wa.apply(this,arguments)}function wa(){return(wa=(0,g.Z)(function*(n){return n.onlineComponents||(w("FirestoreClient","Using default OnlineComponentProvider"),yield cl(n,new ma)),n.onlineComponents})).apply(this,arguments)}function hl(n){return ya(n).then(e=>e.persistence)}function _a(n){return ya(n).then(e=>e.localStore)}function ll(n){return Ss(n).then(e=>e.remoteStore)}function Ta(n){return Ss(n).then(e=>e.syncEngine)}function In(n){return Ia.apply(this,arguments)}function Ia(){return(Ia=(0,g.Z)(function*(n){const e=yield Ss(n),t=e.eventManager;return t.onListen=Dg.bind(null,e.syncEngine),t.onUnlisten=Cg.bind(null,e.syncEngine),t})).apply(this,arguments)}function dl(n,e,t={}){const r=new J;return n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return function(s,i,o,a,u){const c=new xs({next:d=>{i.enqueueAndForget(()=>qo(s,l));const m=d.docs.has(o);!m&&d.fromCache?u.reject(new v(f.UNAVAILABLE,"Failed to get document because the client is offline.")):m&&d.fromCache&&a&&"server"===a.source?u.reject(new v(f.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(d)},error:d=>u.reject(d)}),l=new jo(Xt(o.path),c,{includeMetadataChanges:!0,fo:!0});return Po(s,l)}(yield In(n),n.asyncQueue,e,t,r)})),r.promise}function fl(n,e,t={}){const r=new J;return n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return function(s,i,o,a,u){const c=new xs({next:d=>{i.enqueueAndForget(()=>qo(s,l)),d.fromCache&&"server"===a.source?u.reject(new v(f.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(d)},error:d=>u.reject(d)}),l=new jo(o,c,{includeMetadataChanges:!0,fo:!0});return Po(s,l)}(yield In(n),n.asyncQueue,e,t,r)})),r.promise}class op{constructor(e,t,r,s,i,o,a,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.useFetchStreams=u}}class En{constructor(e,t){this.projectId=e,this.database=t||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof En&&e.projectId===this.projectId&&e.database===this.database}}const ml=new Map;function Ea(n,e,t){if(!t)throw new v(f.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function gl(n,e,t,r){if(!0===e&&!0===r)throw new v(f.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function pl(n){if(!E.isDocumentKey(n))throw new v(f.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function yl(n){if(E.isDocumentKey(n))throw new v(f.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function bs(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(t=n).constructor?t.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var t;return"function"==typeof n?"a function":x()}function L(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new v(f.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=bs(n);throw new v(f.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function vl(n,e){if(e<=0)throw new v(f.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class wl{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new v(f.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new v(f.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,gl("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class gr{constructor(e,t){this._credentials=t,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new wl({}),this._settingsFrozen=!1,e instanceof En?this._databaseId=e:(this._app=e,this._databaseId=function(r){if(!Object.prototype.hasOwnProperty.apply(r.options,["projectId"]))throw new v(f.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new En(r.options.projectId)}(e))}get app(){if(!this._app)throw new v(f.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new v(f.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new wl(e),void 0!==e.credentials&&(this._credentials=function(t){if(!t)return new Cf;switch(t.type){case"gapi":const r=t.client;return b(!("object"!=typeof r||null===r||!r.auth||!r.auth.getAuthHeaderValueForFirstParty)),new Mf(r,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new v(f.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=ml.get(e);t&&(w("ComponentProvider","Removing Datastore"),ml.delete(e),t.terminate())}(this),Promise.resolve()}}class U{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new qe(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new U(this.firestore,e,this._key)}}class me{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new me(this.firestore,e,this._query)}}class qe extends me{constructor(e,t,r){super(e,t,Xt(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new U(this.firestore,null,new E(e))}withConverter(e){return new qe(this.firestore,e,this._path)}}function _l(n,e,...t){if(n=(0,M.m9)(n),Ea("collection","path",e),n instanceof gr){const r=F.fromString(e,...t);return yl(r),new qe(n,null,r)}{if(!(n instanceof U||n instanceof qe))throw new v(f.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(F.fromString(e,...t));return yl(r),new qe(n.firestore,null,r)}}function As(n,e,...t){if(n=(0,M.m9)(n),1===arguments.length&&(e=uc.I()),Ea("doc","path",e),n instanceof gr){const r=F.fromString(e,...t);return pl(r),new U(n,null,new E(r))}{if(!(n instanceof U||n instanceof qe))throw new v(f.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(F.fromString(e,...t));return pl(r),new U(n.firestore,n instanceof qe?n.converter:null,new E(r))}}function Tl(n,e){return n=(0,M.m9)(n),e=(0,M.m9)(e),(n instanceof U||n instanceof qe)&&(e instanceof U||e instanceof qe)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Il(n,e){return n=(0,M.m9)(n),e=(0,M.m9)(e),n instanceof me&&e instanceof me&&n.firestore===e.firestore&&Xn(n._query,e._query)&&n.converter===e.converter}class cp{constructor(){this._c=Promise.resolve(),this.mc=[],this.gc=!1,this.yc=[],this.Tc=null,this.Ec=!1,this.Ic=!1,this.Ac=[],this.ar=new wo(this,"async_queue_retry"),this.Rc=()=>{const t=Ts();t&&w("AsyncQueue","Visibility state changed to "+t.visibilityState),this.ar.tr()};const e=Ts();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Rc)}get isShuttingDown(){return this.gc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.bc(),this.Pc(e)}enterRestrictedMode(e){if(!this.gc){this.gc=!0,this.Ic=e||!1;const t=Ts();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Rc)}}enqueue(e){if(this.bc(),this.gc)return new Promise(()=>{});const t=new J;return this.Pc(()=>this.gc&&this.Ic?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.mc.push(e),this.vc()))}vc(){var e=this;return(0,g.Z)(function*(){if(0!==e.mc.length){try{yield e.mc[0](),e.mc.shift(),e.ar.reset()}catch(t){if(!Nt(t))throw t;w("AsyncQueue","Operation failed with retryable error: "+t)}e.mc.length>0&&e.ar.Xi(()=>e.vc())}})()}Pc(e){const t=this._c.then(()=>(this.Ec=!0,e().catch(r=>{throw this.Tc=r,this.Ec=!1,G("INTERNAL UNHANDLED ERROR: ",function(i){let o=i.message||"";return i.stack&&(o=i.stack.includes(i.message)?i.stack:i.message+"\n"+i.stack),o}(r)),r}).then(r=>(this.Ec=!1,r))));return this._c=t,t}enqueueAfterDelay(e,t,r){this.bc(),this.Ac.indexOf(e)>-1&&(t=0);const s=Oo.createAndSchedule(this,e,t,r,i=>this.Vc(i));return this.yc.push(s),s}bc(){this.Tc&&x()}verifyOperationInProgress(){}Sc(){var e=this;return(0,g.Z)(function*(){let t;do{t=e._c,yield t}while(t!==e._c)})()}Dc(e){for(const t of this.yc)if(t.timerId===e)return!0;return!1}Cc(e){return this.Sc().then(()=>{this.yc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.yc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Sc()})}Nc(e){this.Ac.push(e)}Vc(e){const t=this.yc.indexOf(e);this.yc.splice(t,1)}}function xa(n){return function(e,t){if("object"!=typeof e||null===e)return!1;const r=e;for(const s of["next","error","complete"])if(s in r&&"function"==typeof r[s])return!0;return!1}(n)}class hp{constructor(){this._progressObserver={},this._taskCompletionResolver=new J,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class B extends gr{constructor(e,t){super(e,t),this.type="firestore",this._queue=new cp,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||El(this),this._firestoreClient.terminate()}}function Y(n){return n._firestoreClient||El(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function El(n){var e;const t=n._freezeSettings(),r=(i=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new op(n._databaseId,i,n._persistenceKey,(a=t).host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,a.useFetchStreams));var i,a;n._firestoreClient=new Yg(n._credentials,n._queue,r)}function xl(n,e,t){const r=new J;return n.asyncQueue.enqueue((0,g.Z)(function*(){try{yield ul(n,t),yield cl(n,e),r.resolve()}catch(s){if(!("FirebaseError"===(i=s).name?i.code===f.FAILED_PRECONDITION||i.code===f.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&i instanceof DOMException)||22===i.code||20===i.code||11===i.code))throw s;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+s),r.reject(s)}var i})).then(()=>r.promise)}function Sl(n){if(n._initialized||n._terminated)throw new v(f.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Qe{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new v(f.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ue(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Ve{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ve(te.fromBase64String(e))}catch(t){throw new v(f.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Ve(te.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Rt{constructor(e){this._methodName=e}}class Ns{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new v(f.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new v(f.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return C(this._lat,e._lat)||C(this._long,e._long)}}const _p=/^__.*__$/;class Tp{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new rt(e,this.data,this.fieldMask,t,this.fieldTransforms):new tr(e,this.data,t,this.fieldTransforms)}}class bl{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new rt(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Al(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw x()}}class Ds{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.N=r,this.ignoreUndefinedProperties=s,void 0===i&&this.xc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get kc(){return this.settings.kc}$c(e){return new Ds(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.N,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Oc(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.$c({path:r,Fc:!1});return s.Mc(e),s}Lc(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.$c({path:r,Fc:!1});return s.xc(),s}Bc(e){return this.$c({path:void 0,Fc:!0})}Uc(e){return ks(e,this.settings.methodName,this.settings.qc||!1,this.path,this.settings.Kc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}xc(){if(this.path)for(let e=0;e<this.path.length;e++)this.Mc(this.path.get(e))}Mc(e){if(0===e.length)throw this.Uc("Document fields must not be empty");if(Al(this.kc)&&_p.test(e))throw this.Uc('Document fields cannot begin and end with "__"')}}class Ip{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.N=r||dr(e)}jc(e,t,r,s=!1){return new Ds({kc:e,methodName:t,Kc:r,path:ue.emptyPath(),Fc:!1,qc:s},this.databaseId,this.N,this.ignoreUndefinedProperties)}}function Lt(n){const e=n._freezeSettings(),t=dr(n._databaseId);return new Ip(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Cs(n,e,t,r,s,i={}){const o=n.jc(i.merge||i.mergeFields?2:0,e,t,s);Na("Data must be an object, but it was:",o,r);const a=Cl(r,o);let u,c;if(i.merge)u=new Ht(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const l=[];for(const d of i.mergeFields){const m=Da(e,d,t);if(!o.contains(m))throw new v(f.INVALID_ARGUMENT,`Field '${m}' is specified in your field mask but missing from your input data.`);Rl(l,m)||l.push(m)}u=new Ht(l),c=o.fieldTransforms.filter(d=>u.covers(d.field))}else u=null,c=o.fieldTransforms;return new Tp(new de(a),u,c)}class pr extends Rt{_toFieldTransform(e){if(2!==e.kc)throw e.Uc(1===e.kc?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof pr}}function Nl(n,e,t){return new Ds({kc:3,Kc:e.settings.Kc,methodName:n._methodName,Fc:t},e.databaseId,e.N,e.ignoreUndefinedProperties)}class Sa extends Rt{_toFieldTransform(e){return new er(e.path,new en)}isEqual(e){return e instanceof Sa}}class Ep extends Rt{constructor(e,t){super(e),this.Qc=t}_toFieldTransform(e){const t=Nl(this,e,!0),r=this.Qc.map(i=>Mt(i,t)),s=new St(r);return new er(e.path,s)}isEqual(e){return this===e}}class xp extends Rt{constructor(e,t){super(e),this.Qc=t}_toFieldTransform(e){const t=Nl(this,e,!0),r=this.Qc.map(i=>Mt(i,t)),s=new bt(r);return new er(e.path,s)}isEqual(e){return this===e}}class Sp extends Rt{constructor(e,t){super(e),this.Wc=t}_toFieldTransform(e){const t=new tn(e.N,Nc(e.N,this.Wc));return new er(e.path,t)}isEqual(e){return this===e}}function ba(n,e,t,r){const s=n.jc(1,e,t);Na("Data must be an object, but it was:",s,r);const i=[],o=de.empty();It(r,(u,c)=>{const l=Ca(e,u,t);c=(0,M.m9)(c);const d=s.Lc(l);if(c instanceof pr)i.push(l);else{const m=Mt(c,d);null!=m&&(i.push(l),o.set(l,m))}});const a=new Ht(i);return new bl(o,a,s.fieldTransforms)}function Aa(n,e,t,r,s,i){const o=n.jc(1,e,t),a=[Da(e,r,t)],u=[s];if(i.length%2!=0)throw new v(f.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let m=0;m<i.length;m+=2)a.push(Da(e,i[m])),u.push(i[m+1]);const c=[],l=de.empty();for(let m=a.length-1;m>=0;--m)if(!Rl(c,a[m])){const p=a[m];let _=u[m];_=(0,M.m9)(_);const S=o.Lc(p);if(_ instanceof pr)c.push(p);else{const D=Mt(_,S);null!=D&&(c.push(p),l.set(p,D))}}const d=new Ht(c);return new bl(l,d,o.fieldTransforms)}function Dl(n,e,t,r=!1){return Mt(t,n.jc(r?4:3,e))}function Mt(n,e){if(kl(n=(0,M.m9)(n)))return Na("Unsupported field value:",e,n),Cl(n,e);if(n instanceof Rt)return function(t,r){if(!Al(r.kc))throw r.Uc(`${t._methodName}() can only be used with update() and set()`);if(!r.path)throw r.Uc(`${t._methodName}() is not currently supported inside arrays`);const s=t._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Fc&&4!==e.kc)throw e.Uc("Nested arrays are not supported");return function(t,r){const s=[];let i=0;for(const o of t){let a=Mt(o,r.Bc(i));null==a&&(a={nullValue:"NULL_VALUE"}),s.push(a),i++}return{arrayValue:{values:s}}}(n,e)}return function(t,r){if(null===(t=(0,M.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Nc(r.N,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const s=ee.fromDate(t);return{timestampValue:ir(r.N,s)}}if(t instanceof ee){const s=new ee(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:ir(r.N,s)}}if(t instanceof Ns)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Ve)return{bytesValue:Hc(r.N,t._byteString)};if(t instanceof U){const s=r.databaseId,i=t.firestore._databaseId;if(!i.isEqual(s))throw r.Uc(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Gi(t.firestore._databaseId||r.databaseId,t._key.path)}}throw r.Uc(`Unsupported field value: ${bs(t)}`)}(n,e)}function Cl(n,e){const t={};return lc(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):It(n,(r,s)=>{const i=Mt(s,e.Oc(r));null!=i&&(t[r]=i)}),{mapValue:{fields:t}}}function kl(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof ee||n instanceof Ns||n instanceof Ve||n instanceof U||n instanceof Rt)}function Na(n,e,t){if(!kl(t)||"object"!=typeof(r=t)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r)){const r=bs(t);throw e.Uc("an object"===r?n+" a custom object":n+" "+r)}var r}function Da(n,e,t){if((e=(0,M.m9)(e))instanceof Qe)return e._internalPath;if("string"==typeof e)return Ca(n,e);throw ks("Field path arguments must be of type string or FieldPath.",n,!1,void 0,t)}const bp=new RegExp("[~\\*/\\[\\]]");function Ca(n,e,t){if(e.search(bp)>=0)throw ks(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Qe(...e.split("."))._internalPath}catch(r){throw ks(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function ks(n,e,t,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(i||o)&&(u+=" (found",i&&(u+=` in field ${r}`),o&&(u+=` in document ${s}`),u+=")"),new v(f.INVALID_ARGUMENT,a+n+u)}function Rl(n,e){return n.some(t=>t.isEqual(e))}class yr{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new U(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Ap(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Rs("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Ap extends yr{data(){return super.data()}}function Rs(n,e){return"string"==typeof e?Ca(n,e):e instanceof Qe?e._internalPath:e._delegate._internalPath}class Ft{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class We extends yr{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new vr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Rs("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class vr extends We{data(e={}){return super.data(e)}}class lt{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Ft(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new vr(this._firestore,this._userDataWriter,r.key,r,new Ft(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new v(f.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let i=0;return r._snapshot.docChanges.map(o=>({type:"added",doc:new vr(r._firestore,r._userDataWriter,o.doc.key,o.doc,new Ft(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter),oldIndex:-1,newIndex:i++}))}{let i=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(o=>s||3!==o.type).map(o=>{const a=new vr(r._firestore,r._userDataWriter,o.doc.key,o.doc,new Ft(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);let u=-1,c=-1;return 0!==o.type&&(u=i.indexOf(o.doc.key),i=i.delete(o.doc.key)),1!==o.type&&(i=i.add(o.doc),c=i.indexOf(o.doc.key)),{type:Np(o.type),doc:a,oldIndex:u,newIndex:c}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Np(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return x()}}function Ll(n,e){return n instanceof We&&e instanceof We?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof lt&&e instanceof lt&&n._firestore===e._firestore&&Il(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function Ml(n){if(is(n)&&0===n.explicitOrderBy.length)throw new v(f.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class wr{}function dt(n,...e){for(const t of e)n=t._apply(n);return n}class Dp extends wr{constructor(e,t,r){super(),this.Gc=e,this.zc=t,this.Hc=r,this.type="where"}_apply(e){const t=Lt(e.firestore),r=function(s,i,o,a,u,c,l){let d;if(u.isKeyField()){if("array-contains"===c||"array-contains-any"===c)throw new v(f.INVALID_ARGUMENT,`Invalid Query. You can't perform '${c}' queries on FieldPath.documentId().`);if("in"===c||"not-in"===c){Vl(l,c);const p=[];for(const _ of l)p.push(ql(a,s,_));d={arrayValue:{values:p}}}else d=ql(a,s,l)}else"in"!==c&&"not-in"!==c&&"array-contains-any"!==c||Vl(l,c),d=Dl(o,"where",l,"in"===c||"not-in"===c);const m=ve.create(u,c,d);return function(p,_){if(_.v()){const D=Vi(p);if(null!==D&&!D.isEqual(_.field))throw new v(f.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${D.toString()}' and '${_.field.toString()}'`);const K=qi(p);null!==K&&Bl(0,_.field,K)}const S=function(D,K){for(const Me of D.filters)if(K.indexOf(Me.op)>=0)return Me.op;return null}(p,function(D){switch(D){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(_.op));if(null!==S)throw new v(f.INVALID_ARGUMENT,S===_.op?`Invalid query. You cannot use more than one '${_.op.toString()}' filter.`:`Invalid query. You cannot use '${_.op.toString()}' filters with '${S.toString()}' filters.`)}(s,m),m}(e._query,0,t,e.firestore._databaseId,this.Gc,this.zc,this.Hc);return new me(e.firestore,e.converter,function(s,i){const o=s.filters.concat([i]);return new $e(s.path,s.collectionGroup,s.explicitOrderBy.slice(),o,s.limit,s.limitType,s.startAt,s.endAt)}(e._query,r))}}class kp extends wr{constructor(e,t){super(),this.Gc=e,this.Jc=t,this.type="orderBy"}_apply(e){const t=function(r,s,i){if(null!==r.startAt)throw new v(f.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==r.endAt)throw new v(f.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const o=new Yt(s,i);return function(a,u){if(null===qi(a)){const c=Vi(a);null!==c&&Bl(0,c,u.field)}}(r,o),o}(e._query,this.Gc,this.Jc);return new me(e.firestore,e.converter,function(r,s){const i=r.explicitOrderBy.concat([s]);return new $e(r.path,r.collectionGroup,i,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}class Fl extends wr{constructor(e,t,r){super(),this.type=e,this.Yc=t,this.Xc=r}_apply(e){return new me(e.firestore,e.converter,Ec(e._query,this.Yc,this.Xc))}}class Ol extends wr{constructor(e,t,r){super(),this.type=e,this.Zc=t,this.ta=r}_apply(e){const t=Ul(e,this.type,this.Zc,this.ta);return new me(e.firestore,e.converter,(s=t,new $e((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,s,r.endAt)));var r,s}}class Pl extends wr{constructor(e,t,r){super(),this.type=e,this.Zc=t,this.ta=r}_apply(e){const t=Ul(e,this.type,this.Zc,this.ta);return new me(e.firestore,e.converter,(s=t,new $e((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,s)));var r,s}}function Ul(n,e,t,r){if(t[0]=(0,M.m9)(t[0]),t[0]instanceof yr)return function(s,i,o,a,u){if(!a)throw new v(f.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${o}().`);const c=[];for(const l of Jt(s))if(l.field.isKeyField())c.push(Jr(i,a.key));else{const d=a.data.field(l.field);if(Mi(d))throw new v(f.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+l.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===d){const m=l.field.canonicalString();throw new v(f.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${m}' (used as the orderBy) does not exist.`)}c.push(d)}return new Yn(c,u)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=Lt(n.firestore);return function(i,o,a,u,c,l){const d=i.explicitOrderBy;if(c.length>d.length)throw new v(f.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const m=[];for(let p=0;p<c.length;p++){const _=c[p];if(d[p].field.isKeyField()){if("string"!=typeof _)throw new v(f.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof _}`);if(!Bi(i)&&-1!==_.indexOf("/"))throw new v(f.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${u}() must be a plain document ID, but '${_}' contains a slash.`);const S=i.path.child(F.fromString(_));if(!E.isDocumentKey(S))throw new v(f.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${u}() must result in a valid document path, but '${S}' is not because it contains an odd number of segments.`);const D=new E(S);m.push(Jr(o,D))}else{const S=Dl(a,u,_);m.push(S)}}return new Yn(m,l)}(n._query,n.firestore._databaseId,s,e,t,r)}}function ql(n,e,t){if("string"==typeof(t=(0,M.m9)(t))){if(""===t)throw new v(f.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Bi(e)&&-1!==t.indexOf("/"))throw new v(f.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(F.fromString(t));if(!E.isDocumentKey(r))throw new v(f.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Jr(n,new E(r))}if(t instanceof U)return Jr(n,t._key);throw new v(f.INVALID_ARGUMENT,`Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ${bs(t)}.`)}function Vl(n,e){if(!Array.isArray(n)||0===n.length)throw new v(f.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(n.length>10)throw new v(f.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function Bl(n,e,t){if(!t.isEqual(e))throw new v(f.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class ka{convertValue(e,t="none"){switch(xt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return z(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Qt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw x()}}convertObject(e,t){const r={};return It(e.fields,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertGeoPoint(e){return new Ns(z(e.latitude),z(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=dc(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(zn(e));default:return null}}convertTimestamp(e){const t=nt(e);return new ee(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=F.fromString(e);b(ah(r));const s=new En(r.get(1),r.get(3)),i=new E(r.popFirst(5));return s.isEqual(t)||G(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Ls(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class qp extends ka{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ve(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new U(this.firestore,null,t)}}class jl{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Lt(e)}set(e,t,r){this._verifyNotCommitted();const s=ft(e,this._firestore),i=Ls(s.converter,t,r),o=Cs(this._dataReader,"WriteBatch.set",s._key,i,null!==s.converter,r);return this._mutations.push(o.toMutation(s._key,H.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=ft(e,this._firestore);let o;return o="string"==typeof(t=(0,M.m9)(t))||t instanceof Qe?Aa(this._dataReader,"WriteBatch.update",i._key,t,r,s):ba(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,H.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=ft(e,this._firestore);return this._mutations=this._mutations.concat(new nr(t._key,H.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new v(f.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ft(n,e){if((n=(0,M.m9)(n)).firestore!==e)throw new v(f.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class Ot extends ka{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ve(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new U(this.firestore,null,t)}}function Zl(n,e,t){n=L(n,U);const r=L(n.firestore,B),s=Ls(n.converter,e,t);return xn(r,[Cs(Lt(r),"setDoc",n._key,s,null!==n.converter,t).toMutation(n._key,H.none())])}function Kl(n,e,t,...r){n=L(n,U);const s=L(n.firestore,B),i=Lt(s);let o;return o="string"==typeof(e=(0,M.m9)(e))||e instanceof Qe?Aa(i,"updateDoc",n._key,e,t,r):ba(i,"updateDoc",n._key,e),xn(s,[o.toMutation(n._key,H.exists(!0))])}function $l(n,...e){var t,r,s;n=(0,M.m9)(n);let i={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||xa(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges};if(xa(e[o])){const d=e[o];e[o]=null===(t=d.next)||void 0===t?void 0:t.bind(d),e[o+1]=null===(r=d.error)||void 0===r?void 0:r.bind(d),e[o+2]=null===(s=d.complete)||void 0===s?void 0:s.bind(d)}let u,c,l;if(n instanceof U)c=L(n.firestore,B),l=Xt(n._key.path),u={next:d=>{e[o]&&e[o](Ra(c,n,d))},error:e[o+1],complete:e[o+2]};else{const d=L(n,me);c=L(d.firestore,B),l=d._query;const m=new Ot(c);u={next:p=>{e[o]&&e[o](new lt(c,m,d,p))},error:e[o+1],complete:e[o+2]},Ml(n._query)}return function(d,m,p,_){const S=new xs(_),D=new jo(m,S,p);return d.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return Po(yield In(d),D)})),()=>{S.ec(),d.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return qo(yield In(d),D)}))}}(Y(c),l,a,u)}function xn(n,e){return function(t,r){const s=new J;return t.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return function(n,e,t){return zo.apply(this,arguments)}(yield Ta(t),r,s)})),s.promise}(Y(n),e)}function Ra(n,e,t){const r=t.docs.get(e._key),s=new Ot(n);return new We(n,s,e._key,r,new Ft(t.hasPendingWrites,t.fromCache),e.converter)}class Qp extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Lt(e)}get(e){const t=ft(e,this._firestore),r=new qp(this._firestore);return this._transaction.lookup([t._key]).then(s=>{if(!s||1!==s.length)return x();const i=s[0];if(i.isFoundDocument())return new yr(this._firestore,r,i.key,i,t.converter);if(i.isNoDocument())return new yr(this._firestore,r,t._key,null,t.converter);throw x()})}set(e,t,r){const s=ft(e,this._firestore),i=Ls(s.converter,t,r),o=Cs(this._dataReader,"Transaction.set",s._key,i,null!==s.converter,r);return this._transaction.set(s._key,o),this}update(e,t,r,...s){const i=ft(e,this._firestore);let o;return o="string"==typeof(t=(0,M.m9)(t))||t instanceof Qe?Aa(this._dataReader,"Transaction.update",i._key,t,r,s):ba(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,o),this}delete(e){const t=ft(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=ft(e,this._firestore),r=new Ot(this._firestore);return super.get(e).then(s=>new We(this._firestore,r,t._key,s._document,new Ft(!1,!1),t.converter))}}function La(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new v("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function Gl(){if("undefined"==typeof Uint8Array)throw new v("unimplemented","Uint8Arrays are not available in this environment.")}function zl(){if("undefined"==typeof atob)throw new v("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(n,e=!0){Gt=Sr.SDK_VERSION,(0,Sr._registerComponent)(new Ka.wA("firestore",(t,{options:r})=>{const s=t.getProvider("app").getImmediate(),i=new B(s,new Rf(t.getProvider("auth-internal")));return r=Object.assign({useFetchStreams:e},r),i._setSettings(r),i},"PUBLIC")),(0,Sr.registerVersion)(oc,"3.2.0",n),(0,Sr.registerVersion)(oc,"3.2.0","esm2017")}();class _r{constructor(e){this._delegate=e}static fromBase64String(e){return zl(),new _r(Ve.fromBase64String(e))}static fromUint8Array(e){return Gl(),new _r(Ve.fromUint8Array(e))}toBase64(){return zl(),this._delegate.toBase64()}toUint8Array(){return Gl(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Ma(n){return function(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const r of["next","error","complete"])if(r in t&&"function"==typeof t[r])return!0;return!1}(n)}class iy{enableIndexedDbPersistence(e,t){return function(n,e){Sl(n=L(n,B));const t=Y(n),r=n._freezeSettings(),s=new ma;return xl(t,s,new ol(s,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(n){Sl(n=L(n,B));const e=Y(n),t=n._freezeSettings(),r=new ma;return xl(e,r,new zg(r,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(n){if(n._initialized&&!n._terminated)throw new v(f.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new J;return n._queue.enqueueAndForgetEvenWhileRestricted((0,g.Z)(function*(){try{yield(t=(0,g.Z)(function*(r){if(!Le.bt())return Promise.resolve();const s=r+"main";yield Le.delete(s)}),function(r){return t.apply(this,arguments)})(io(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class Hl{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof En||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&$n("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,r={}){!function(n,e,t,r={}){var s;const i=(n=L(n,gr))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&$n("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},i),{host:`${e}:${t}`,ssl:!1})),r.mockUserToken){let o,a;if("string"==typeof r.mockUserToken)o=r.mockUserToken,a=ae.MOCK_USER;else{o=(0,M.Sg)(r.mockUserToken,null===(s=n._app)||void 0===s?void 0:s.options.projectId);const u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new v(f.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new ae(u)}n._credentials=new kf(new ac(o,a))}}(this._delegate,e,t,r)}enableNetwork(){return function(n){return function(n){return n.asyncQueue.enqueue((0,g.Z)(function*(){const e=yield hl(n),t=yield ll(n);return e.setNetworkEnabled(!0),function(r){const s=T(r);return s.Wr.delete(0),fr(s)}(t)}))}(Y(n=L(n,B)))}(this._delegate)}disableNetwork(){return function(n){return function(n){return n.asyncQueue.enqueue((0,g.Z)(function*(){const e=yield hl(n),t=yield ll(n);return e.setNetworkEnabled(!1),(r=(0,g.Z)(function*(s){const i=T(s);i.Wr.add(0),yield gn(i),i.Hr.set("Offline")}),function(s){return r.apply(this,arguments)})(t);var r}))}(Y(n=L(n,B)))}(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,gl("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function(n){return function(e){const t=new J;return e.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return function(n,e){return Xo.apply(this,arguments)}(yield Ta(e),t)})),t.promise}(Y(n=L(n,B)))}(this._delegate)}onSnapshotsInSync(e){return function(n,e){return function(n,e){const t=new xs(e);return n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return r=yield In(n),s=t,T(r).so.add(s),void s.next();var r,s})),()=>{t.ec(),n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return r=yield In(n),s=t,void T(r).so.delete(s);var r,s}))}}(Y(n=L(n,B)),xa(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new v("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Sn(this,_l(this._delegate,e))}catch(t){throw we(t,"collection()","Firestore.collection()")}}doc(e){try{return new ke(this,As(this._delegate,e))}catch(t){throw we(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new _e(this,function(n,e){if(n=L(n,gr),Ea("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new v(f.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new me(n,null,(t=e,new $e(F.emptyPath(),t)));var t}(this._delegate,e))}catch(t){throw we(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function(n,e){return function(n,e){const t=new J;return n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){const r=yield(s=n,Ss(s).then(i=>i.datastore));var s;new Wg(n.asyncQueue,r,e,t).run()})),t.promise}(Y(n=L(n,B)),t=>e(new Qp(n,t)))}(this._delegate,t=>e(new Ql(this,t)))}batch(){return Y(this._delegate),new Wl(new jl(this._delegate,e=>xn(this._delegate,e)))}loadBundle(e){return function(n,e){const t=Y(n=L(n,B)),r=new hp;return function(n,e,t,r){const s=function(i,o){let a;return a="string"==typeof i?(new TextEncoder).encode(i):i,u=function(u,c){if(u instanceof Uint8Array)return al(u,c);if(u instanceof ArrayBuffer)return al(new Uint8Array(u),c);if(u instanceof ReadableStream)return u.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(a),new Hg(u,o);var u}(t,dr(e));n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){!function(n,e,t){const r=T(n);var s;(s=(0,g.Z)(function*(i,o,a){try{const u=yield o.getMetadata();if(yield function(m,p){const _=T(m),S=ne(p.createTime);return _.persistence.runTransaction("hasNewerBundle","readonly",D=>_.Je.getBundleMetadata(D,p.id)).then(D=>!!D&&D.createTime.compareTo(S)>=0)}(i.localStore,u))return yield o.close(),void a._completeWith((m=u,{taskState:"Success",documentsLoaded:m.totalDocuments,bytesLoaded:m.totalBytes,totalDocuments:m.totalDocuments,totalBytes:m.totalBytes}));a._updateProgress(Wh(u));const c=new Sg(u,i.localStore,o.N);let l=yield o.zo();for(;l;){const m=yield c.mo(l);m&&a._updateProgress(m),l=yield o.zo()}const d=yield c.complete();yield He(i,d.En,void 0),yield function(m,p){const _=T(m);return _.persistence.runTransaction("Save bundle","readwrite",S=>_.Je.saveBundleMetadata(S,p))}(i.localStore,u),a._completeWith(d.progress)}catch(u){$n("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u)}var m}),function(i,o,a){return s.apply(this,arguments)})(r,e,t).then(()=>{r.sharedClientState.notifyBundleLoaded()})}(yield Ta(n),s,r)}))}(t,n._databaseId,e,r),r}(this._delegate,e)}namedQuery(e){return function(n,e){return function(n,e){return n.asyncQueue.enqueue((0,g.Z)(function*(){return function(t,r){const s=T(t);return s.persistence.runTransaction("Get named query","readonly",i=>s.Je.getNamedQuery(i,r))}(yield _a(n),e)}))}(Y(n=L(n,B)),e).then(t=>t?new me(n,null,t.query):null)}(this._delegate,e).then(t=>t?new _e(this,t):null)}}class Ms extends ka{constructor(e){super(),this.firestore=e}convertBytes(e){return new _r(new Ve(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return ke.forKey(t,this.firestore,null)}}class Ql{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Ms(e)}get(e){const t=Ut(e);return this._delegate.get(t).then(r=>new Tr(this._firestore,new We(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const s=Ut(e);return r?(La("Transaction.set",r),this._delegate.set(s,t,r)):this._delegate.set(s,t),this}update(e,t,r,...s){const i=Ut(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,r,...s),this}delete(e){const t=Ut(e);return this._delegate.delete(t),this}}class Wl{constructor(e){this._delegate=e}set(e,t,r){const s=Ut(e);return r?(La("WriteBatch.set",r),this._delegate.set(s,t,r)):this._delegate.set(s,t),this}update(e,t,r,...s){const i=Ut(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,r,...s),this}delete(e){const t=Ut(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Pt{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new vr(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Ir(this._firestore,r),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=Pt.INSTANCES;let s=r.get(e);s||(s=new WeakMap,r.set(e,s));let i=s.get(t);return i||(i=new Pt(e,new Ms(e),t),s.set(t,i)),i}}Pt.INSTANCES=new WeakMap;class ke{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ms(e)}static forPath(e,t,r){if(e.length%2!=0)throw new v("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new ke(t,new U(t._delegate,r,new E(e)))}static forKey(e,t,r){return new ke(t,new U(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Sn(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Sn(this.firestore,_l(this._delegate,e))}catch(t){throw we(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,M.m9)(e))instanceof U&&Tl(this._delegate,e)}set(e,t){t=La("DocumentReference.set",t);try{return t?Zl(this._delegate,e,t):Zl(this._delegate,e)}catch(r){throw we(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?Kl(this._delegate,e):Kl(this._delegate,e,t,...r)}catch(s){throw we(s,"updateDoc()","DocumentReference.update()")}}delete(){return function(n){return xn(L(n.firestore,B),[new nr(n._key,H.none())])}(this._delegate)}onSnapshot(...e){const t=Yl(e),r=Xl(e,s=>new Tr(this.firestore,new We(this.firestore._delegate,this._userDataWriter,s._key,s._document,s.metadata,this._delegate.converter)));return $l(this._delegate,t,r)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function(n){n=L(n,U);const e=L(n.firestore,B),t=Y(e),r=new Ot(e);return function(n,e){const t=new J;return n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return(r=(0,g.Z)(function*(s,i,o){try{const a=yield function(u,c){const l=T(u);return l.persistence.runTransaction("read document","readonly",d=>l.Qn.An(d,c))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new v(f.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const u=vn(a,`Failed to get document '${i} from cache`);o.reject(u)}}),function(s,i,o){return r.apply(this,arguments)})(yield _a(n),e,t);var r})),t.promise}(t,n._key).then(s=>new We(e,r,n._key,s,new Ft(null!==s&&s.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===(null==e?void 0:e.source)?function(n){n=L(n,U);const e=L(n.firestore,B);return dl(Y(e),n._key,{source:"server"}).then(t=>Ra(e,n,t))}(this._delegate):function(n){n=L(n,U);const e=L(n.firestore,B);return dl(Y(e),n._key).then(t=>Ra(e,n,t))}(this._delegate),t.then(r=>new Tr(this.firestore,new We(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new ke(this.firestore,this._delegate.withConverter(e?Pt.getInstance(this.firestore,e):null))}}function we(n,e,t){return n.message=n.message.replace(e,t),n}function Yl(n){for(const e of n)if("object"==typeof e&&!Ma(e))return e;return{}}function Xl(n,e){var t,r;let s;return s=Ma(n[0])?n[0]:Ma(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:i=>{s.next&&s.next(e(i))},error:null===(t=s.error)||void 0===t?void 0:t.bind(s),complete:null===(r=s.complete)||void 0===r?void 0:r.bind(s)}}class Tr{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new ke(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Ll(this._delegate,e._delegate)}}class Ir extends Tr{data(e){const t=this._delegate.data(e);return function(n,e){n||x()}(void 0!==t),t}}class _e{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Ms(e)}where(e,t,r){try{return new _e(this.firestore,dt(this._delegate,function(n,e,t){const r=e,s=Rs("where",n);return new Dp(s,r,t)}(e,t,r)))}catch(s){throw we(s,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new _e(this.firestore,dt(this._delegate,function(n,e="asc"){const t=e,r=Rs("orderBy",n);return new kp(r,t)}(e,t)))}catch(r){throw we(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new _e(this.firestore,dt(this._delegate,function(n){return vl("limit",n),new Fl("limit",n,"F")}(e)))}catch(t){throw we(t,"limit()","Query.limit()")}}limitToLast(e){try{return new _e(this.firestore,dt(this._delegate,function(n){return vl("limitToLast",n),new Fl("limitToLast",n,"L")}(e)))}catch(t){throw we(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new _e(this.firestore,dt(this._delegate,function(...n){return new Ol("startAt",n,!0)}(...e)))}catch(t){throw we(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new _e(this.firestore,dt(this._delegate,function(...n){return new Ol("startAfter",n,!1)}(...e)))}catch(t){throw we(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new _e(this.firestore,dt(this._delegate,function(...n){return new Pl("endBefore",n,!0)}(...e)))}catch(t){throw we(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new _e(this.firestore,dt(this._delegate,function(...n){return new Pl("endAt",n,!1)}(...e)))}catch(t){throw we(t,"endAt()","Query.endAt()")}}isEqual(e){return Il(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function(n){n=L(n,me);const e=L(n.firestore,B),t=Y(e),r=new Ot(e);return function(n,e){const t=new J;return n.asyncQueue.enqueueAndForget((0,g.Z)(function*(){return(r=(0,g.Z)(function*(s,i,o){try{const a=yield vs(s,i,!0),u=new Jh(i,a.Gn),c=u.bo(a.documents),l=u.applyChanges(c,!1);o.resolve(l.snapshot)}catch(a){const u=vn(a,`Failed to execute query '${i} against cache`);o.reject(u)}}),function(s,i,o){return r.apply(this,arguments)})(yield _a(n),e,t);var r})),t.promise}(t,n._query).then(s=>new lt(e,r,n,s))}(this._delegate):"server"===(null==e?void 0:e.source)?function(n){n=L(n,me);const e=L(n.firestore,B),t=Y(e),r=new Ot(e);return fl(t,n._query,{source:"server"}).then(s=>new lt(e,r,n,s))}(this._delegate):function(n){n=L(n,me);const e=L(n.firestore,B),t=Y(e),r=new Ot(e);return Ml(n._query),fl(t,n._query).then(s=>new lt(e,r,n,s))}(this._delegate),t.then(r=>new Fa(this.firestore,new lt(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=Yl(e),r=Xl(e,s=>new Fa(this.firestore,new lt(this.firestore._delegate,this._userDataWriter,this._delegate,s._snapshot)));return $l(this._delegate,t,r)}withConverter(e){return new _e(this.firestore,this._delegate.withConverter(e?Pt.getInstance(this.firestore,e):null))}}class ay{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Ir(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Fa{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new _e(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Ir(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new ay(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Ir(this._firestore,r))})}isEqual(e){return Ll(this._delegate,e._delegate)}}class Sn extends _e{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new ke(this.firestore,e):null}doc(e){try{return new ke(this.firestore,void 0===e?As(this._delegate):As(this._delegate,e))}catch(t){throw we(t,"doc()","CollectionReference.doc()")}}add(e){return function(n,e){const t=L(n.firestore,B),r=As(n),s=Ls(n.converter,e);return xn(t,[Cs(Lt(n.firestore),"addDoc",r._key,s,null!==n.converter,{}).toMutation(r._key,H.exists(!1))]).then(()=>r)}(this._delegate,e).then(t=>new ke(this.firestore,t))}isEqual(e){return Tl(this._delegate,e._delegate)}withConverter(e){return new Sn(this.firestore,this._delegate.withConverter(e?Pt.getInstance(this.firestore,e):null))}}function Ut(n){return L(n,U)}class Oa{constructor(...e){this._delegate=new Qe(...e)}static documentId(){return new Oa(ue.keyField().canonicalString())}isEqual(e){return(e=(0,M.m9)(e))instanceof Qe&&this._delegate._internalPath.isEqual(e._internalPath)}}class qt{constructor(e){this._delegate=e}static serverTimestamp(){const e=new Sa("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new qt(e)}static delete(){const e=new pr("deleteField");return e._methodName="FieldValue.delete",new qt(e)}static arrayUnion(...e){const t=function(...n){return new Ep("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new qt(t)}static arrayRemove(...e){const t=function(...n){return new xp("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new qt(t)}static increment(e){const t=function(n){return new Sp("increment",n)}(e);return t._methodName="FieldValue.increment",new qt(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const uy={Firestore:Hl,GeoPoint:Ns,Timestamp:ee,Blob:_r,Transaction:Ql,WriteBatch:Wl,DocumentReference:ke,DocumentSnapshot:Tr,Query:_e,QueryDocumentSnapshot:Ir,QuerySnapshot:Fa,CollectionReference:Sn,FieldPath:Oa,FieldValue:qt,setLogLevel:function(n){!function(n){tt.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};!function(n){(function(n,e){n.INTERNAL.registerComponent(new Ka.wA("firestore-compat",t=>((e,t)=>new Hl(e,t,new iy))(t.getProvider("app-compat").getImmediate(),t.getProvider("firestore").getImmediate()),"PUBLIC").setServiceProps(Object.assign({},uy)))})(n),n.registerVersion("@firebase/firestore-compat","0.1.5")}(wd.Z);var mt=k(3820),ly=k(2965);function Jl(n,e){return function(n,e=dd.z){return new fd.y(t=>{let r;return null!=e?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{null!=r&&r()}})}(n,e)}function Pa(n,e){return Jl(n,e).pipe((0,Fe.U)(t=>({payload:t,type:"query"})))}function Fs(n,e){return Pa(n,e).pipe((0,Us.O)(void 0),qs(),(0,Fe.U)(([t,r])=>{const s=r.payload.docChanges(),i=s.map(o=>({type:o.type,payload:o}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(r.payload.metadata)&&r.payload.docs.forEach((o,a)=>{const u=s.find(l=>l.doc.ref.isEqual(o.ref)),c=null==t?void 0:t.payload.docs.find(l=>l.ref.isEqual(o.ref));u&&JSON.stringify(u.doc.metadata)===JSON.stringify(o.metadata)||!u&&c&&JSON.stringify(c.metadata)===JSON.stringify(o.metadata)||i.push({type:"modified",payload:{oldIndex:a,newIndex:a,type:"modified",doc:o}})}),i}))}function ed(n,e,t){return Fs(n,t).pipe((0,Vs.R)((r,s)=>function(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=function(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return Ua(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return Ua(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Ua(n,e.oldIndex,1)}return n}(n,r))}),n}(r,s.map(i=>i.payload),e),[]),t=>t.lift(new yd(void 0,void 0)),(0,Fe.U)(r=>r.map(s=>({type:s.type,payload:s}))))}function Ua(n,e,t,...r){const s=n.slice();return s.splice(e,t,...r),s}function td(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}k(7841);class nd{constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=Fs(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,Fe.U)(r=>r.filter(s=>e.indexOf(s.type)>-1)))),t.pipe((0,Us.O)(void 0),qs(),(0,Er.h)(([r,s])=>s.length>0||!r),(0,Fe.U)(([r,s])=>s),Ne.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,Vs.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=td(e);return ed(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ne.iC)}valueChanges(e={}){return Pa(this.query,this.afs.schedulers.outsideAngular).pipe((0,Fe.U)(t=>t.payload.docs.map(r=>e.idField?Object.assign(Object.assign({},r.data()),{[e.idField]:r.id}):r.data())),Ne.iC)}get(e){return(0,bn.D)(this.query.get(e)).pipe(Ne.iC)}add(e){return this.ref.add(e)}doc(e){return new rd(this.ref.doc(e),this.afs)}}class rd{constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const r=this.ref.collection(e),{ref:s,query:i}=sd(r,t);return new nd(s,i,this.afs)}snapshotChanges(){return function(n,e){return Jl(n,e).pipe((0,Us.O)(void 0),qs(),(0,Fe.U)(([t,r])=>r.exists?(null==t?void 0:t.exists)?{payload:r,type:"modified"}:{payload:r,type:"added"}:{payload:r,type:"removed"}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(Ne.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,Fe.U)(({payload:t})=>e.idField?Object.assign(Object.assign({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return(0,bn.D)(this.ref.get(e)).pipe(Ne.iC)}}class py{constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?Fs(this.query,this.afs.schedulers.outsideAngular).pipe((0,Fe.U)(t=>t.filter(r=>e.indexOf(r.type)>-1)),(0,Er.h)(t=>t.length>0),Ne.iC):Fs(this.query,this.afs.schedulers.outsideAngular).pipe(Ne.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,Vs.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=td(e);return ed(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ne.iC)}valueChanges(e={}){return Pa(this.query,this.afs.schedulers.outsideAngular).pipe((0,Fe.U)(r=>r.payload.docs.map(s=>e.idField?Object.assign({[e.idField]:s.id},s.data()):s.data())),Ne.iC)}get(e){return(0,bn.D)(this.query.get(e)).pipe(Ne.iC)}}const yy=new h.OlP("angularfire2.enableFirestorePersistence"),vy=new h.OlP("angularfire2.firestore.persistenceSettings"),wy=new h.OlP("angularfire2.firestore.settings"),_y=new h.OlP("angularfire2.firestore.use-emulator");function sd(n,e=(t=>t)){return{query:e(n),ref:n}}let id=(()=>{class n{constructor(t,r,s,i,o,a,u,c,l,d,m,p,_,S,D,K,Me){this.schedulers=u;const Be=(0,xr.on)(t,a,r),Ye=l;d&&(0,mt.nw)(Be,a,m,_,S,D,p,K),[this.firestore,this.persistenceEnabled$]=(0,xr.cc)(`${Be.name}.firestore`,"AngularFirestore",Be.name,()=>{const Xe=a.runOutsideAngular(()=>Be.firestore());if(i&&Xe.settings(i),Ye&&Xe.useEmulator(...Ye),s&&!(0,Vt.PM)(o)){const Os=()=>{try{return(0,bn.D)(Xe.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(Ly){return"undefined"!=typeof console&&console.warn(Ly),(0,Ps.of)(!1)}};return[Xe,a.runOutsideAngular(Os)]}return[Xe,(0,Ps.of)(!1)]},[i,Ye,s])}collection(t,r){let s;s="string"==typeof t?this.firestore.collection(t):t;const{ref:i,query:o}=sd(s,r),a=this.schedulers.ngZone.run(()=>i);return new nd(a,o,this)}collectionGroup(t,r){const s=r||(o=>o),i=this.firestore.collectionGroup(t);return new py(s(i),this)}doc(t){let r;r="string"==typeof t?this.firestore.doc(t):t;const s=this.schedulers.ngZone.run(()=>r);return new rd(s,this)}createId(){return this.firestore.collection("_").doc().id}}return n.\u0275fac=function(t){return new(t||n)(h.LFG(xr.Dh),h.LFG(xr.xv,8),h.LFG(yy,8),h.LFG(wy,8),h.LFG(h.Lbi),h.LFG(h.R0b),h.LFG(Ne.HU),h.LFG(vy,8),h.LFG(_y,8),h.LFG(mt.zQ,8),h.LFG(mt.Qv,8),h.LFG(mt.L6,8),h.LFG(mt._Q,8),h.LFG(mt.rT,8),h.LFG(mt.lh,8),h.LFG(mt.f7,8),h.LFG(ly.nm,8))},n.\u0275prov=h.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})();var od=k(7556),ad=k(1841);const ud=new h.OlP("anime api token");let qa=(()=>{class n{constructor(t,r){this.baseUrl=t,this.http=r}getAnimeByName(t){return this.http.get(`${this.baseUrl}&t=${t}`)}}return n.\u0275fac=function(t){return new(t||n)(h.LFG(ud),h.LFG(ad.eN))},n.\u0275prov=h.Yz7({token:n,factory:n.\u0275fac}),n})();var Va=k(9068),cd=k(5469);function Ty(n,e){if(1&n){const t=h.EpF();h.ynx(0),h.TgZ(1,"div",11),h.TgZ(2,"div"),h.TgZ(3,"div",12),h._UZ(4,"img",13),h.TgZ(5,"div",14),h.TgZ(6,"h4",15),h._uU(7),h.qZA(),h.TgZ(8,"h6",16),h._uU(9),h.qZA(),h.TgZ(10,"h6",16),h._uU(11),h.qZA(),h.TgZ(12,"h6",16),h._uU(13),h.qZA(),h.TgZ(14,"p",16),h._uU(15),h.qZA(),h.TgZ(16,"div",17),h.TgZ(17,"div",18),h.TgZ(18,"button",19),h.NdJ("click",function(){return h.CHM(t),h.oxw().delete()}),h._uU(19,"Datails"),h.qZA(),h.qZA(),h.TgZ(20,"small",20),h._uU(21),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.BQk()}if(2&n){const t=e.$implicit;h.xp6(4),h.Q6J("src",t.poster,h.LSH),h.xp6(3),h.Oqu(t.title),h.xp6(2),h.hij("Year: ",t.year,""),h.xp6(2),h.hij("Genre: ",t.genre,""),h.xp6(2),h.hij("imdb: ",t.rating,""),h.xp6(2),h.Oqu(t.plot),h.xp6(6),h.Oqu(t.time)}}let Ba=(()=>{class n{constructor(t,r,s,i){this.store=t,this.auth=r,this.animeservice=s,this.http=i,this.Anime=this.getAnime()}addAnime(t){return(0,bn.D)(this.store.collection("catalogue").add(t))}getAnime(){return this.store.collection("catalogue",t=>t.where("uid","==",this.auth.userId)).valueChanges()}deleteAll(){this.store.collection("catalogue").get().toPromise().then(t=>{t.forEach(r=>{r.ref.delete()})})}delete(){return this.store.collection("catalogue").doc().delete()}ngOnInit(){this.getAnime().subscribe(t=>console.log(t))}}return n.\u0275fac=function(t){return new(t||n)(h.Y36(id),h.Y36(od.e),h.Y36(qa),h.Y36(ad.eN))},n.\u0275cmp=h.Xpm({type:n,selectors:[["app-catalogue"]],decls:22,vars:12,consts:[[1,"py-5","text-center","middle"],[1,"col-lg-6","col-md-8","mx-auto"],[1,"fw-light","text-white"],[1,"lead","text-white"],["routerLink","add",1,"btn","btn-outline-light"],[1,"album","py-5","bg-light"],[1,"container"],[1,"row","row-cols-1","row-cols-sm-2","row-cols-md-3","g-3"],[4,"ngFor","ngForOf"],[1,"btndl"],["type","button",1,"btn","btn-danger",3,"click"],[1,"col"],[1,"card",2,"width","18rem"],["alt","Card image cap",1,"card-img-top",3,"src"],[1,"card-body"],[1,"card-title"],[1,"card-text"],[1,"d-flex","justify-content-between","align-items-center"],[1,"btn-group"],["type","button",1,"btn","btn-sm","btn-outline-secondary",3,"click"],[1,"text-muted"]],template:function(t,r){1&t&&(h.TgZ(0,"main"),h.TgZ(1,"section",0),h.TgZ(2,"div",1),h.TgZ(3,"h1",2),h._uU(4),h.ALo(5,"translate"),h.qZA(),h.TgZ(6,"p",3),h._uU(7),h.ALo(8,"translate"),h.qZA(),h.TgZ(9,"p"),h.TgZ(10,"button",4),h._uU(11),h.ALo(12,"translate"),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(13,"div",5),h.TgZ(14,"div",6),h.TgZ(15,"div",7),h.YNc(16,Ty,22,7,"ng-container",8),h.ALo(17,"async"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(18,"div",5),h.TgZ(19,"div",9),h.TgZ(20,"button",10),h.NdJ("click",function(){return r.deleteAll()}),h._uU(21,"Delete All"),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(4),h.Oqu(h.lcZ(5,4,"ANIME_CATALOGUE")),h.xp6(3),h.Oqu(h.lcZ(8,6,"YOU_CAN_ADD")),h.xp6(4),h.Oqu(h.lcZ(12,8,"ADD_ANIME")),h.xp6(5),h.Q6J("ngForOf",h.lcZ(17,10,r.Anime)))},directives:[Va.rH,Vt.sg],pipes:[cd.X$,Vt.Ov],styles:[".middle[_ngcontent-%COMP%]{background-image:url(n.a87fd5ac062512c86a8f.png);background-size:cover}.btndl[_ngcontent-%COMP%]{text-align:center}"]}),n})();var hd=k(8939),Iy=k(3190),gt=k(3679),Ey=k(9344);function xy(n,e){1&n&&(h.TgZ(0,"div",14),h._uU(1),h.ALo(2,"translate"),h.qZA()),2&n&&(h.xp6(1),h.hij(" ",h.lcZ(2,1,"MUST_ENTER_ANIME")," "))}function Sy(n,e){1&n&&(h.TgZ(0,"div",14),h._uU(1),h.ALo(2,"translate"),h.qZA()),2&n&&(h.xp6(1),h.hij(" ",h.lcZ(2,1,"MUST_ENTER_ANIME")," "))}function by(n,e){if(1&n&&(h.TgZ(0,"span",15),h._uU(1),h.qZA()),2&n){const t=e.$implicit;h.xp6(1),h.Oqu(t)}}function Ay(n,e){if(1&n){const t=h.EpF();h.TgZ(0,"div",16),h.TgZ(1,"div",17),h._UZ(2,"img",18),h.TgZ(3,"div",19),h.TgZ(4,"h4",20),h._uU(5),h.qZA(),h.TgZ(6,"h6",21),h._uU(7),h.qZA(),h.TgZ(8,"h6",21),h._uU(9),h.qZA(),h.TgZ(10,"h6",21),h._uU(11),h.qZA(),h.TgZ(12,"p",21),h._uU(13),h.qZA(),h.TgZ(14,"button",22),h.NdJ("click",function(){return h.CHM(t),h.oxw().sumbit()}),h._uU(15,"Add"),h.qZA(),h.qZA(),h.qZA(),h.qZA()}if(2&n){const t=h.oxw();h.xp6(1),h.Q6J("formGroup",t.form),h.xp6(1),h.Q6J("src",t.selectAnime.Poster,h.LSH),h.xp6(3),h.Oqu(t.selectAnime.Title),h.xp6(2),h.hij("Year: ",t.selectAnime.Year,""),h.xp6(2),h.hij("Genre: ",t.selectAnime.Genre,""),h.xp6(2),h.hij("imdb: ",t.selectAnime.imdbRating,""),h.xp6(2),h.Oqu(t.selectAnime.Plot)}}let ld=(()=>{class n{constructor(t,r,s,i,o){this.animeApiServices=t,this.store=r,this.auth=s,this.toastr=i,this.catalog=o,this.submitted=!1,this.form=new gt.cw({}),this.lastThreeSearches=[]}get selectAnime(){return this._selectAnime}addLastSearches(t){this.lastThreeSearches=this.lastThreeSearches.length<3?[t,...this.lastThreeSearches]:[t,...this.lastThreeSearches.slice(0,2)]}fetchAnime(t){this.animeApiServices.getAnimeByName(t).pipe((0,Er.h)(r=>r.Genre.includes("Animation")),(0,hd.x)(()=>this.searchKey=""),(0,Iy.w)(r=>(0,Ps.of)(r))).subscribe(r=>this._selectAnime=r)}search(){this.searchKey?(this.hasError=!1,this.animeApiServices.getAnimeByName(this.searchKey).pipe((0,Er.h)(t=>t.Genre.includes("Animation")),(0,hd.x)(()=>this.searchKey="")).subscribe(t=>console.log(t)),this.addLastSearches(this.searchKey),this.fetchAnime(this.searchKey)):this.hasError=!0}sumbit(){this.submitted=!0,this.catalog.addAnime({title:this._selectAnime.Title,rating:this._selectAnime.imdbRating,uid:this.auth.userId,year:this._selectAnime.Year,plot:this._selectAnime.Plot,genre:this._selectAnime.Genre,poster:this._selectAnime.Poster,time:this._selectAnime.Runtime}).subscribe(()=>this.reset())}reset(){this._selectAnime=null,this.form.reset(),this.toastr.success("Anime has been added")}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)(h.Y36(qa),h.Y36(id),h.Y36(od.e),h.Y36(Ey._W),h.Y36(Ba))},n.\u0275cmp=h.Xpm({type:n,selectors:[["app-add-movie"]],decls:21,vars:14,consts:[[1,"py-3","text-center","middle"],[1,"col-lg-6","col-md-8","mx-auto"],[1,"fw-light","text-white"],[1,"py-5"],[1,"container","d-flex","justify-content-center","flex-column","w-100"],[1,"row","d-flex","justify-content-center"],[1,"search-form","d-flex","justify-content-center","flex-column"],["type","text",1,"form-control",3,"ngModel","placeholder","ngModelChange"],[1,"btn","btn-outline-secondary","mt-2",3,"click"],["class","alert alert-danger mt-2",4,"ngIf"],[1,"row","d-flex","justify-content-center","mt-2","flex-row"],[1,"d-flex","justify-content-center"],["class","badge rounded-pill bg-success ms-1",4,"ngFor","ngForOf"],["class","row d-flex justify-content-center mt-4",4,"ngIf"],[1,"alert","alert-danger","mt-2"],[1,"badge","rounded-pill","bg-success","ms-1"],[1,"row","d-flex","justify-content-center","mt-4"],[1,"card",2,"width","18rem",3,"formGroup"],["alt","Card image cap",1,"card-img-top","mt-2",3,"src"],[1,"card-body"],[1,"card-title"],[1,"card-text"],[1,"btn","btn-primary",3,"click"]],template:function(t,r){1&t&&(h.TgZ(0,"main"),h.TgZ(1,"section",0),h.TgZ(2,"div",1),h.TgZ(3,"h1",2),h._uU(4),h.ALo(5,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(6,"div",3),h.TgZ(7,"div",4),h.TgZ(8,"div",5),h.TgZ(9,"div",6),h.TgZ(10,"input",7),h.NdJ("ngModelChange",function(i){return r.searchKey=i}),h.ALo(11,"translate"),h.qZA(),h.TgZ(12,"button",8),h.NdJ("click",function(){return r.search()}),h._uU(13),h.ALo(14,"translate"),h.qZA(),h.YNc(15,xy,3,3,"div",9),h.YNc(16,Sy,3,3,"div",9),h.qZA(),h.qZA(),h.TgZ(17,"div",10),h.TgZ(18,"div",11),h.YNc(19,by,2,1,"span",12),h.qZA(),h.qZA(),h.YNc(20,Ay,16,7,"div",13),h.qZA(),h.qZA(),h.qZA()),2&t&&(h.xp6(4),h.Oqu(h.lcZ(5,8,"ADD_ANIMATION")),h.xp6(6),h.s9C("placeholder",h.lcZ(11,10,"ENTER_ANIME_NAME")),h.Q6J("ngModel",r.searchKey),h.xp6(3),h.Oqu(h.lcZ(14,12,"SEARCH")),h.xp6(2),h.Q6J("ngIf",r.hasError),h.xp6(1),h.Q6J("ngIf",r.animeErr),h.xp6(3),h.Q6J("ngForOf",r.lastThreeSearches),h.xp6(1),h.Q6J("ngIf",r.selectAnime))},directives:[gt.Fj,gt.JJ,gt.On,Vt.O5,Vt.sg,gt.JL,gt.sg],pipes:[cd.X$],styles:[".middle[_ngcontent-%COMP%]{background-image:url(n.a87fd5ac062512c86a8f.png);background-size:cover}main[_ngcontent-%COMP%]{height:calc(100% -60px)}.search-form[_ngcontent-%COMP%]{max-width:400px}"]}),n})();const Ny=[{path:"",component:Ba},{path:"add",component:ld}];let Dy=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=h.oAB({type:n}),n.\u0275inj=h.cJS({imports:[[Va.Bz.forChild(Ny)],Va.Bz]}),n})();var Cy=k(4466),ky=k(2340);let Ry=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=h.oAB({type:n}),n.\u0275inj=h.cJS({providers:[qa,{provide:ud,useValue:ky.N.animeApiBase},Ba,ld],imports:[[Vt.ez,Dy,Cy.m,gt.u5,gt.UX]]}),n})()}}]);